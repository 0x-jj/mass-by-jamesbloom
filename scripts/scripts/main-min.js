///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const LIVE_MODE=true;if(!LIVE_MODE){tokenHash=(new Date).getTime();traitsPalette=undefined;traitsObjects=undefined}const placeholderSalePrice=3e17;const placeholderRoyaltyReceived=5e14;{var MersenneTwister=function(e){if(e==undefined){e=(new Date).getTime()}this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=new Array(this.N);this.mti=this.N+1;if(e.constructor==Array){this.init_by_array(e,e.length)}else{this.init_seed(e)}};MersenneTwister.prototype.init_seed=function(e){this.mt[0]=e>>>0;for(this.mti=1;this.mti<this.N;this.mti++){var e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti;this.mt[this.mti]>>>=0}};MersenneTwister.prototype.init_by_array=function(e,t){var a,i,r;this.init_seed(19650218);a=1;i=0;r=this.N>t?this.N:t;for(;r;r--){var n=this.mt[a-1]^this.mt[a-1]>>>30;this.mt[a]=(this.mt[a]^(((n&4294901760)>>>16)*1664525<<16)+(n&65535)*1664525)+e[i]+i;this.mt[a]>>>=0;a++;i++;if(a>=this.N){this.mt[0]=this.mt[this.N-1];a=1}if(i>=t)i=0}for(r=this.N-1;r;r--){var n=this.mt[a-1]^this.mt[a-1]>>>30;this.mt[a]=(this.mt[a]^(((n&4294901760)>>>16)*1566083941<<16)+(n&65535)*1566083941)-a;this.mt[a]>>>=0;a++;if(a>=this.N){this.mt[0]=this.mt[this.N-1];a=1}}this.mt[0]=2147483648};MersenneTwister.prototype.random_int=function(){var e;var t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var a;if(this.mti==this.N+1)this.init_seed(5489);for(a=0;a<this.N-this.M;a++){e=this.mt[a]&this.UPPER_MASK|this.mt[a+1]&this.LOWER_MASK;this.mt[a]=this.mt[a+this.M]^e>>>1^t[e&1]}for(;a<this.N-1;a++){e=this.mt[a]&this.UPPER_MASK|this.mt[a+1]&this.LOWER_MASK;this.mt[a]=this.mt[a+(this.M-this.N)]^e>>>1^t[e&1]}e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1];this.mti=0}e=this.mt[this.mti++];e^=e>>>11;e^=e<<7&2636928640;e^=e<<15&4022730752;e^=e>>>18;return e>>>0};MersenneTwister.prototype.random_int31=function(){return this.random_int()>>>1};MersenneTwister.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};MersenneTwister.prototype.random=function(){return this.random_int()*(1/4294967296)};MersenneTwister.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};MersenneTwister.prototype.random_long=function(){var e=this.random_int()>>>5,t=this.random_int()>>>6;return(e*67108864+t)*(1/9007199254740992)}}(function(e){var t=e.noise={};function a(e,t,a){this.x=e;this.y=t;this.z=a}a.prototype.dot2=function(e,t){return this.x*e+this.y*t};a.prototype.dot3=function(e,t,a){return this.x*e+this.y*t+this.z*a};var i=[new a(1,1,0),new a(-1,1,0),new a(1,-1,0),new a(-1,-1,0),new a(1,0,1),new a(-1,0,1),new a(1,0,-1),new a(-1,0,-1),new a(0,1,1),new a(0,-1,1),new a(0,1,-1),new a(0,-1,-1)];var r=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var X=new Array(512);var Y=new Array(512);t.seed=function(e){if(e>0&&e<1){e*=65536}e=Math.floor(e);if(e<256){e|=e<<8}for(var t=0;t<256;t++){var a;if(t&1){a=r[t]^e&255}else{a=r[t]^e>>8&255}X[t]=X[t+256]=a;Y[t]=Y[t+256]=i[a%12]}};t.seed(0);var y=.5*(Math.sqrt(3)-1);var A=(3-Math.sqrt(3))/6;var j=1/3;var Z=1/6;t.simplex2=function(e,t){var a,i,r;var n=(e+t)*y;var o=Math.floor(e+n);var s=Math.floor(t+n);var l=(o+s)*A;var c=e-o+l;var p=t-s+l;var f,d;if(c>p){f=1;d=0}else{f=0;d=1}var u=c-f+A;var m=p-d+A;var g=c-1+2*A;var h=p-1+2*A;o&=255;s&=255;var E=Y[o+X[s]];var S=Y[o+f+X[s+d]];var b=Y[o+1+X[s+1]];var v=.5-c*c-p*p;if(v<0){a=0}else{v*=v;a=v*v*E.dot2(c,p)}var x=.5-u*u-m*m;if(x<0){i=0}else{x*=x;i=x*x*S.dot2(u,m)}var T=.5-g*g-h*h;if(T<0){r=0}else{T*=T;r=T*T*b.dot2(g,h)}return 70*(a+i+r)};t.simplex3=function(e,t,a){var i,r,n,o;var s=(e+t+a)*j;var l=Math.floor(e+s);var c=Math.floor(t+s);var p=Math.floor(a+s);var f=(l+c+p)*Z;var d=e-l+f;var u=t-c+f;var m=a-p+f;var g,h,E;var S,b,v;if(d>=u){if(u>=m){g=1;h=0;E=0;S=1;b=1;v=0}else if(d>=m){g=1;h=0;E=0;S=1;b=0;v=1}else{g=0;h=0;E=1;S=1;b=0;v=1}}else{if(u<m){g=0;h=0;E=1;S=0;b=1;v=1}else if(d<m){g=0;h=1;E=0;S=0;b=1;v=1}else{g=0;h=1;E=0;S=1;b=1;v=0}}var x=d-g+Z;var T=u-h+Z;var y=m-E+Z;var A=d-S+2*Z;var R=u-b+2*Z;var C=m-v+2*Z;var w=d-1+3*Z;var D=u-1+3*Z;var N=m-1+3*Z;l&=255;c&=255;p&=255;var M=Y[l+X[c+X[p]]];var P=Y[l+g+X[c+h+X[p+E]]];var _=Y[l+S+X[c+b+X[p+v]]];var H=Y[l+1+X[c+1+X[p+1]]];var O=.6-d*d-u*u-m*m;if(O<0){i=0}else{O*=O;i=O*O*M.dot3(d,u,m)}var F=.6-x*x-T*T-y*y;if(F<0){r=0}else{F*=F;r=F*F*P.dot3(x,T,y)}var U=.6-A*A-R*R-C*C;if(U<0){n=0}else{U*=U;n=U*U*_.dot3(A,R,C)}var k=.6-w*w-D*D-N*N;if(k<0){o=0}else{k*=k;o=k*k*H.dot3(w,D,N)}return 32*(i+r+n+o)};function E(e){return e*e*e*(e*(e*6-15)+10)}function S(e,t,a){return(1-a)*e+a*t}t.perlin2=function(e,t){var a=Math.floor(e),i=Math.floor(t);e=e-a;t=t-i;a=a&255;i=i&255;var r=Y[a+X[i]].dot2(e,t);var n=Y[a+X[i+1]].dot2(e,t-1);var o=Y[a+1+X[i]].dot2(e-1,t);var s=Y[a+1+X[i+1]].dot2(e-1,t-1);var l=E(e);return S(S(r,o,l),S(n,s,l),E(t))};t.perlin3=function(e,t,a){var i=Math.floor(e),r=Math.floor(t),n=Math.floor(a);e=e-i;t=t-r;a=a-n;i=i&255;r=r&255;n=n&255;var o=Y[i+X[r+X[n]]].dot3(e,t,a);var s=Y[i+X[r+X[n+1]]].dot3(e,t,a-1);var l=Y[i+X[r+1+X[n]]].dot3(e,t-1,a);var c=Y[i+X[r+1+X[n+1]]].dot3(e,t-1,a-1);var p=Y[i+1+X[r+X[n]]].dot3(e-1,t,a);var f=Y[i+1+X[r+X[n+1]]].dot3(e-1,t,a-1);var d=Y[i+1+X[r+1+X[n]]].dot3(e-1,t-1,a);var u=Y[i+1+X[r+1+X[n+1]]].dot3(e-1,t-1,a-1);var m=E(e);var g=E(t);var h=E(a);return S(S(S(o,p,m),S(s,f,m),h),S(S(l,d,m),S(c,u,m),h),g)}})(this);function average_delta_array(t){let a=0;for(let e=1;e<t.length;e++){a+=Math.abs(t[e]-t[e-1])}return a/(t.length-1)}function map_scale(t,a,i){if(i<=t[0]){return a[0]}if(i>=t[t.length-1]){return a[a.length-1]}for(let e=0;e<a.length-1;e++){if(i>=t[e]&i<t[e+1]){return a[e]}}}function delta_gap(e,t){let a=average_delta_array(t);let i=e-t[t.length-1];let r=i/a-1;if(r===undefined||r===null||isNaN(r)){return 0}else{return r}}let adjust_tier=(e,t)=>{if(t==0){return t}let a=t<0?-1:1;t=Math.abs(t);if(e>=0){t-=1}if(e>=1){t-=2}if(e>=2){t-=3}t=Math.max(0,t)*a;return t==-0?0:t};function calculateTiers(e){if(!e){console.warn("No data");return}let t={royalty:[[-.4,-.3,-.1,0,.1,.3,.6],[-3,-2,-1,0,1,2,3]],contract_activity:[[-1,-.5,-.25,0,.25,.5,.75],[-3,-2,-1,0,1,2,3]],clustering_mode:[[-1,-.5,-.25,0,.25,.5,.75],[-3,-2,-1,0,1,2,3]],approvals:[[-1,-.5,-.25,0,.25,.5,.75],[-3,-2,-1,0,1,2,3]]};let i=(new Date).getTime()/1e3;let r=e[1].filter((e,t)=>e>0);let n=e[3].filter((e,t)=>e>0);let a=e[5];let o=e[6];let s=a.concat(o);let l=s.filter((e,t)=>t%2===0&&e>0);let c=s.filter((e,t)=>t%2!==0&&e>0);n=[...new Set(n)];r=[...new Set(r)];l=[...new Set(l)];n.sort();r.sort();l.sort();if(SCENE.data.memory==undefined){try{let a=i-memoryLookbackPeriod;SCENE.data.memory=n.filter((e,t)=>e>=a).length+r.filter((e,t)=>e>=a).length+l.filter((e,t)=>e>=a).length;SCENE.data.memory=Math.min(SCENE.data.memory,11)}catch(w){console.warn(w)}}if(resetTimestamp){console.log("Resetting to",resetTimestamp);n=n.filter(e=>e>resetTimestamp);r=r.filter(e=>e>resetTimestamp);l=l.filter(e=>e>resetTimestamp)}let p=Array.from(r);let f=Array.from(l);let d=Array.from(n);let u=Array.from(c);if(n.length<=1){d=[contractMintTimestamp].concat(n)}if(r.length<=1){p=[contractMintTimestamp].concat(r)}if(l.length<=1){f=[contractMintTimestamp].concat(l)}if(c.length<=1){u=[placeholderRoyaltyReceived].concat(c)}try{n=n.slice(-4)}catch{}try{r=r.slice(-4)}catch{}try{l=l.slice(-4)}catch{}if(resetTimestamp){console.log("Resetting to",resetTimestamp);n=n.filter(e=>e>resetTimestamp);r=r.filter(e=>e>resetTimestamp);l=l.filter(e=>e>resetTimestamp)}let m=delta_gap(i,n.length>1?n:d);let g=delta_gap(i,r.length>1?r:p);let h=delta_gap(i,l.length>1?l:f);let E=0;if(u.length>1){E=u[u.length-1]/(u.slice(0,-1).reduce((e,t)=>e+t)/(u.length-1))-1}let S=delta_gap(i,n.concat(r).sort().slice(-4));let b=adjust_tier(h,map_scale(t.royalty[0],t.royalty[1],E));let v=adjust_tier(S,map_scale(t.contract_activity[0],t.contract_activity[1],S*-1));let x=adjust_tier(m,map_scale(t.clustering_mode[0],t.clustering_mode[1],m*-1));let T=adjust_tier(g,map_scale(t.approvals[0],t.approvals[1],g*-1));let y=b!=0;let A=v!=0;let R=x!=0;let C=T!=0;if(SCENE.data.contract.tiers&&Object.keys(SCENE.data.contract.tiers).length>0){y=SCENE.data.contract.tiers.royalty_received_tier.value!=b;A=SCENE.data.contract.tiers.contract_activity_tier.value!=v;R=SCENE.data.contract.tiers.sends_tier.value!=x;C=SCENE.data.contract.tiers.approvals_tier.value!=T}SCENE.data.contract.tiers={royalty_received_tier:{value:b,changed:y},contract_activity_tier:{value:v,changed:A},sends_tier:{value:x,changed:R},approvals_tier:{value:T,changed:C}}}function calculateContractDataUpdates(){if(!SCENE.data.contractUpdates){SCENE.data.contractUpdates={}}SCENE.data.firstContractDataUpdate=true;if(!SCENE.data.contractPrev||!(SCENE.data.contractPrev.length||SCENE.data.contractPrev.size)){SCENE.data.contractUpdates.approvalCount=true;SCENE.data.contractUpdates.transferCount=true;SCENE.data.contractUpdates.holderCount=true;SCENE.data.contractUpdates.royalty=true;return}SCENE.data.firstContractDataUpdate=false;SCENE.data.contractUpdates.approvalCount=SCENE.data.contractPrev[0][0]!=SCENE.data.contract[0][0];SCENE.data.contractUpdates.transferCount=SCENE.data.contractPrev[2][0]!=SCENE.data.contract[2][0];SCENE.data.contractUpdates.holderCount=SCENE.data.contractPrev[4][0]!=SCENE.data.contract[4][0];try{SCENE.data.contractUpdates.royalty=SCENE.data.contractPrev[5].slice(SCENE.data.contractPrev[5].length-2,SCENE.data.contractPrev[5].length-1).pop()!=SCENE.data.contract[5].slice(SCENE.data.contract[5].length-2,SCENE.data.contract[5].length-1).pop()||SCENE.data.contractPrev[6].slice(SCENE.data.contractPrev[6].length-2,SCENE.data.contractPrev[6].length-1).pop()!=SCENE.data.contract[5].slice(SCENE.data.contract[6].length-2,SCENE.data.contract[6].length-1).pop()}catch{}}function tierToValue(e,t){let a=[-3,-2,-1,0,1,2,3];let i=a.indexOf(t);return e[i]}var randomNumberGenerator=new MersenneTwister((new Date).getTime());var randomNumberGeneratorSeeded=new MersenneTwister(hashString(`${tokenHash}`));traitsSeed=Math.floor(123456789*randomNumberGeneratorSeeded.random());traitsIncrement=Math.floor(12345*randomNumberGeneratorSeeded.random());function sizeOfMapping(e){return Object.keys(e).length}function makeGradientPlane(e,t,a,i,r){const n=document.createElement("canvas");n.width=256;n.height=256;const o=n.getContext("2d");if(a=="linear"){var s=o.createLinearGradient(0,0,0,n.height)}else if(a=="radial"){var s=o.createRadialGradient(n.width/2,n.height/2,0,n.width/2,n.height/2,n.width/2)}for(let e of i){s.addColorStop(e[0],e[1])}o.fillStyle=s;o.fillRect(0,0,n.width,n.height);const l=new THREE.CanvasTexture(n);const c=new THREE.PlaneGeometry(e,t);const p=new THREE.MeshBasicMaterial({map:l,fog:r});const f=new THREE.Mesh(c,p);return f}function makePerlinTexture(e,t,i,r,n,o,s,l,c="perlin3"){const a=document.createElement("canvas");a.setAttribute("id","canvas1");a.width=e;a.height=t;const p=a.getContext("2d");if(s){var f=document.createElement("canvas");f.width=e;f.height=t;var d=f.getContext("2d")}noise.seed(Math.random());let u=0;for(var m=0;m<a.width;m++){for(var g=0;g<a.height;g++){u++;if(c=="perlin3"){var h=noise.perlin3(m/i,g/r,m^g%150);var E=Math.abs(h*o)*256+n}else if(c=="simplex3"){var h=noise.simplex3(m/i,g/r,m^g%150);var E=Math.abs(h*o)*256+n}else if(c=="simple"){var E=Math.random()*255*o+n}let e=E;let t=E;let a=E;p.fillStyle="rgb("+e+","+t+","+a+")";p.fillRect(m,g,1,1);if(s){a=E/l;d.fillStyle="rgb("+a+","+a+","+a+")";d.fillRect(m,g,1,1)}}}const S=new THREE.CanvasTexture(a);S.wrapS=S.wrapT=THREE.RepeatWrapping;if(s){const b=new THREE.CanvasTexture(f);b.wrapS=b.wrapT=THREE.RepeatWrapping;return[S,b]}else{return S}}function makeLight(e,t=true){if(e.type=="point"){e.light=new THREE.PointLight(e.color,e.power,e.size);if(t){e.light.position.set(e.positionX,e.positionY,e.positionZ)}if(enableShadows){e.light.castShadow=true;e.light.shadow.mapSize.width=512;e.light.shadow.mapSize.height=512;e.light.shadow.camera.near=.5;e.light.shadow.camera.far=500;e.light.shadow.normalBias=.5}}else if(e.type=="hemisphere"){e.light=new THREE.HemisphereLight(e.color1,e.color2,e.power)}else if(e.type=="ambient"){e.light=new THREE.AmbientLight(e.color)}else if(e.type=="directional"){e.light=new THREE.DirectionalLight(e.color,e.power);e.light.position.set(e.positionX,e.positionY,e.positionZ);e.light.rotation.set(e.rotationX,e.rotationY,e.rotationZ);if(enableShadows){e.light.castShadow=true;e.light.shadow.mapSize.width=512;e.light.shadow.mapSize.height=512;e.light.shadow.camera.near=.5;e.light.shadow.camera.far=500;e.light.shadow.normalBias=.5}}}function animateAxisNegativeSpace(t,e){if(t.userData==undefined){t.userData={};t.userData.negativeSpaceTargetX=rand(t.negativeSpaceAnimationX[0],t.negativeSpaceAnimationX[1],t.negativeSpaceAnimationX[2]);t.userData.negativeSpaceTargetY=rand(t.negativeSpaceAnimationY[0],t.negativeSpaceAnimationY[1],t.negativeSpaceAnimationY[2]);t.userData.negativeSpaceCurrentX=0;t.userData.negativeSpaceCurrentY=0}let a=0;let i=0;let r=t.negativeSpaceAnimationSpeedX*e;let n=t.negativeSpaceAnimationSpeedY*e;if(t.userData.negativeSpaceCurrentX<t.userData.negativeSpaceTargetX){a=r;t.userData.negativeSpaceCurrentX+=r}else if(t.userData.negativeSpaceCurrentX>t.userData.negativeSpaceTargetX){a=-r;t.userData.negativeSpaceCurrentX-=r}if(t.userData.negativeSpaceCurrentY<t.userData.negativeSpaceTargetY){i=n;t.userData.negativeSpaceCurrentY+=n}else if(t.userData.negativeSpaceCurrentY>t.userData.negativeSpaceTargetY){i=-n;t.userData.negativeSpaceCurrentY-=n}if(t.userData.negativeSpaceTargetX>=0&&t.userData.negativeSpaceCurrentX>t.userData.negativeSpaceTargetX||t.userData.negativeSpaceTargetX<=0&&t.userData.negativeSpaceCurrentX<t.userData.negativeSpaceTargetX){t.userData.negativeSpaceTargetX=rand(t.negativeSpaceAnimationX[0],t.negativeSpaceAnimationX[1],t.negativeSpaceAnimationX[2])}if(t.userData.negativeSpaceTargetY>=0&&t.userData.negativeSpaceCurrentY>t.userData.negativeSpaceTargetY||t.userData.negativeSpaceTargetY<=0&&t.userData.negativeSpaceCurrentY<t.userData.negativeSpaceTargetY){t.userData.negativeSpaceTargetY=rand(t.negativeSpaceAnimationY[0],t.negativeSpaceAnimationX[1],t.negativeSpaceAnimationY[2])}if(a!=0||i!=0){for(let e in t.clipPlanes){t.clipPlanes[e].translate(new THREE.Vector3(a,i,0))}}}function makeCamera(){if(cameraType=="perspective"){var e=new THREE.PerspectiveCamera(fieldOfView,cameraAspect,cameraNear,cameraFar);e.aspect=rendererWidth/rendererHeight}else{var e=new THREE.OrthographicCamera(rendererWidth/-orthographicCameraScale,rendererWidth/orthographicCameraScale,rendererHeight/orthographicCameraScale,rendererHeight/-orthographicCameraScale,cameraNear,cameraFar)}cameraZ=randFromRange(cameraZ);e.position.x=cameraX;e.position.y=cameraY;e.position.z=cameraZ;e.updateProjectionMatrix();e.userData.animationQueue=[];e.userData.originalFocalLength=e.getFocalLength();return e}function makeScene(){const e=new THREE.Scene;e.fog=new THREE.Fog(fogColor,fogNear,fogFar);e.fog.userData={animationQueue:[]};e.fog.enabled=enableFog;if(!enableFog){e.fog.near=150;e.fog.far=155;e.fog.enabled=false}e.background=new THREE.Color(worldGradientColors[worldGradientColors.length-1][1]);return e}function makeRenderer(){const e=new THREE.WebGLRenderer({antialias:rendererAntialias,premultipliedAlpha:true});e.setSize(rendererWidth,rendererHeight,false);e.setPixelRatio(window.devicePixelRatio);e.toneMapping=THREE[rendererToneMapping];e.localClippingEnabled=true;if(enableShadows){e.shadowMap.enabled=true;e.shadowMap.type=THREE.PCFShadowMap}document.body.appendChild(e.domElement);return e}function loadOBJ(e,t,a,i,r){const n=new THREE.OBJLoader;object=n.parse(atob(e));object.traverse(function(e){e.material=t});object.scale.set(a[0],a[1],a[2]);object.position.set(i[0],i[1],i[2]);object.rotation.set(THREE.MathUtils.degToRad(r[0]),THREE.MathUtils.degToRad(r[1]),THREE.MathUtils.degToRad(r[2]));return object}function addPivotToAxis(e,t,a,i=undefined,r=undefined){let n=new THREE.Object3D;n.userData.name=a;n.userData.shapeType=t.userData.shapeType;var o=rand(e.axisX[0],e.axisX[1],e.axisX[2]);if(i){var s=randFromRange(i)}else{var s=rand(e.axisY[0],e.axisY[1],e.axisY[2])}var l=rand(e.axisZ[0],e.axisZ[1],e.axisZ[2]);n.userData.rotationSpeed=rand(e.coneRotationSpeed[0],e.coneRotationSpeed[1],e.coneRotationSpeed[2]);n.userData.originalRotationSpeed=n.userData.rotationSpeed;n.rotation.z=THREE.MathUtils.degToRad(rand(e.axisAngle[0],e.axisAngle[1],e.axisAngle[2]));n.userData.originalPosition=[o,s,l];n.position.set(o,s,l);n.add(t);e.pivots.push(n);e.mainPivot.add(n);if(r==undefined){return}if(n.userData.name.includes("terrain")){r*=terrainsAppearAndDisappearMultiplier}if(n.userData.name.includes("knot")){r*=knotsAppearAndDisappearMultiplier}n.children[0].userData.originalScale=JSON.parse(JSON.stringify(n.children[0].scale));n.userData.growUp=r;n.children[0].scale.set(0,0,0)}function addConeToAxis(e,t,a,i=undefined,r=undefined){let n=rand(a.radius[0],a.radius[1],a.radius[2]);let o=rand(a.height[0],a.height[1],a.height[2]);let s=rand(a.scale[0],a.scale[1],a.scale[2]);let l=s+rand(a.scaleX[0],a.scaleX[1],a.scaleX[2]);let c=s+rand(a.scaleY[0],a.scaleY[1],a.scaleY[2]);let p=s+rand(a.scaleZ[0],a.scaleZ[1],a.scaleZ[2]);let f=rand(a.positionX[0],a.positionX[1],a.positionX[2]);let d=rand(a.positionY[0],a.positionY[1],a.positionY[2]);let u=rand(a.positionZ[0],a.positionZ[1],a.positionZ[2]);let m=rand(a.rotationX[0],a.rotationX[1],a.rotationX[2]);let g=rand(a.rotationY[0],a.rotationY[1],a.rotationY[2]);let h=rand(a.rotationZ[0],a.rotationZ[1],a.rotationZ[2]);let E=a.numberOfRadialSegments;let S=a.numberOfHeightSegments;let b=a.openEnded;if(e.ellipseMode){f*=Math.pow(20-Math.abs(d),e.ellipseModePowerOf)*e.ellipseModeMultiplier;u*=Math.pow(20-Math.abs(d),e.ellipseModePowerOf)*e.ellipseModeMultiplier}if(e.enableScaleEllipseMode){l*=Math.pow(e.scaleEllipseModeBaseX-Math.abs(d),e.scaleEllipseModePowerOfX)*e.scaleEllipseModeMultiplierX;c*=Math.pow(e.scaleEllipseModeBaseY-Math.abs(d),e.scaleEllipseModePowerOfY)*e.scaleEllipseModeMultiplierY;p*=Math.pow(e.scaleEllipseModeBaseZ-Math.abs(d),e.scaleEllipseModePowerOfZ)*e.scaleEllipseModeMultiplierZ}let v={};for(let e=0;e<100;e++){let e=a.types[randS(0,a.types.length-1,1)];if(randS(0,1,.1)>1-e.probability){v=e;break}}try{var x=materialTemplates[a.material].clone()}catch(y){console.warn(a);var x=materialTemplates[pick(a.material)[1]].clone()}if(a.wireframeProbability&&randS(0,1,.01)>1-a.wireframeProbability){x.wireframe=true;E=5;S=5;b=true}else{x.wireframe=false}if(e.clipPlanes&&e.clipPlanes.length>0){x.clippingPlanes=e.clipPlanes}let T=makeCone(x,n,o,E,S,b,[l,c,p],[f,d,u],[m,g,m],v);if(i){let e=Math.max(l,c,p);let t=e/100*i;t=Math.max(t,1e-7);T.scale.set(0,0,0);T.userData.animationQueue=[makeAnimationForQueue("scale",0,e,e,t)]}if(e.enableNegativeSpace){T.material.clippingPlanes=e.clipPlanes;T.material.clipIntersection=true}T.userData.name=t;T.userData.shapeType=r;addPivotToAxis(e,T,t)}function animateWorldPlane(){if(!SCENE.worldPlane.userData.animationQueue){if(SCENE.worldPlane.scale.x>1+SCENE.worldPlane.userData.scaleAmount&&SCENE.worldPlane.userData.scaleFactor>0||SCENE.worldPlane.scale.x<1&&SCENE.worldPlane.userData.scaleFactor<0){SCENE.worldPlane.userData.scaleFactor*=-1}SCENE.worldPlane.scale.set(SCENE.worldPlane.scale.x+SCENE.worldPlane.userData.scaleFactor,SCENE.worldPlane.scale.y+SCENE.worldPlane.userData.scaleFactor,1)}}function makeWorldPlane(){worldPlane=makeGradientPlane(rendererWidth*3,rendererWidth*3,worldGradientType,worldGradientColors,false);worldPlane.userData.name="worldPlane";worldPlane.position.z=-rendererWidth;worldPlane.z=-100;worldPlane.userData.scaleFactor=rand(worldGradientAnimationSpeed[0],worldGradientAnimationSpeed[1],worldGradientAnimationSpeed[2]);worldPlane.userData.scaleAmount=rand(worldGradientAnimationScale[0],worldGradientAnimationScale[1],worldGradientAnimationScale[2]);worldPlane.userData.animationQueue=[];SCENE.worldPlane=worldPlane;SCENE.scene.add(SCENE.worldPlane)}function addExtraShapeToAxis(e,t,a,o,i=undefined){let r=a;let n=randFromRange(o.scale);let s=n+randFromRange(o.scaleX);let l=n+randFromRange(o.scaleY);let c=n+randFromRange(o.scaleZ);let p=randFromRangeS2(o.positionX);let f=randFromRangeS2(o.positionY);let d=randFromRangeS2(o.positionZ);let u=randFromRange(o.rotationX);let m=randFromRange(o.rotationY);let g=randFromRange(o.rotationZ);if(o.material){if(!materialTemplates[o.material]){console.warn("Object has no material",o)}else{var h=materialTemplates[o.material].clone()}}else{var h=e.coneMaterial.clone();if(e.coneMaterial.map){if(o.textureScale){h.map.repeat.x=o.textureScale[0];h.map.repeat.y=o.textureScale[1]}if(o.textureRotation){h.map.rotation=THREE.MathUtils.degToRad(o.textureRotation);h.map.rotation=true}}if(o.color){h.color=new THREE.Color(o.color);h.color.needsUpdate=true}}if(e.clipPlanes&&e.clipPlanes.length>0){h.clippingPlanes=e.clipPlanes}if(r=="flower1"){h.map=undefined;h.bumpMap=undefined;let t=h.clone();if(SCENE.palette.special){h.color=new THREE.Color(SCENE.palette.special.flower[0]);t.color=new THREE.Color(SCENE.palette.special.flower[1])}else{let e=pickS2(SCENE.palette.colors);h.color=new THREE.Color(e[0]);t.color=new THREE.Color(e[1])}h=[h,t]}let E=undefined;if(r=="terrain"){let e=randFromRange(o.heightScale);E=makeTerrain(h,o.worldSizeX,o.worldSizeY,e,[s,l,c],[p,f,d],[u,m,g])}if(r=="smallterrain"){let e=randFromRange(o.heightScale);E=makeTerrain(h,o.worldSizeX,o.worldSizeY,e,[s,l,c],[p,f,d],[u,m,g],1,o.bumpsRange,o.depth)}else if(r=="cloud"){let e=randFromRange(o.sizeX);let t=randFromRange(o.sizeY);let a=randFromRange(o.sizeZ);let i=randFromRange(o.nSpheres);E=makeCloud(h,e,t,a,i,o.spheresScale,[s,l,c],[p,f,d],[u,m,g])}else if(r=="frame"){let e=randFromRange(o.height);let t=randFromRange(o.width);let a=randFromRange(o.thickness);let i=randFromRange(o.depth);E=makeFrame(h,e,t,a,i,[s,l,c],[p,f,d],[u,m,g])}else if(r=="rectangle"){let e=randFromRange(o.height);let t=randFromRange(o.width);let a=randFromRange(o.depth);E=makeRectangle(h,e,t,a,[s,l,c],[p,f,d],[u,m,g])}else if(r=="arrow"){let e=randFromRange(o.depth);let t=randFromRange(o.bevelThickness);let a=randFromRange(o.bevelSize);let i=randFromRange(o.bevelSegments);let r=o.type||0;E=makeArrow(h,e,t,a,i,[s,l,c],[p,f,d],[u,m,g],r)}else if(r=="knot"){let e=randFromRange(o.radius);let t=randFromRange(o.tube);let a=randFromRange(o.tubularSegments);let i=randFromRange(o.radialSegments);let r=randFromRange(o.p);let n=randFromRange(o.q);E=makeKnot(h,e,t,a,i,r,n,[s,l,c],[p,f,d],[u,m,g])}else if(r in base64Objects){E=loadOBJ(base64Objects[r],h,[s,l,c],[p,f,d],[u,m,g])}E.userData.name=t;E.name=t;E.userData.shapeType=r;if(e.enableNegativeSpace){E.material.clippingPlanes=e.clipPlanes;E.material.clipIntersection=true}addPivotToAxis(e,E,t,o.yAxisRangeOverwrite,i)}function updateObjectRotationSpeed(t,a,i,r=1,n=.1){for(let e of Axis){if(e.name==a){for(let a of e.pivots){if(a.userData.name==t){let e=a.userData.rotationSpeed;if(e===undefined){e=0}let t=makeAnimationForQueue("rotationSpeed",e,i,i,r,n);if(a.userData.animationQueue===undefined){a.userData.animationQueue=[]}a.userData.animationQueue.push(t);return}}}}}function switchObjectRotationDirection(t,a,i=1,r=.1){for(let e of Axis){if(e.name==a){for(let a of e.pivots){if(a.userData.name==t){let e=a.userData.rotationSpeed;if(e===undefined){e=0}let t=makeAnimationForQueue("rotationSpeed",e,e*-1,e*-1,i,r);if(a.userData.animationQueue===undefined){a.userData.animationQueue=[]}a.userData.animationQueue.push(t);return}}}}}function updateObjectDistanceFromAxis(i,e,r,n=1,o=.1){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==i){for(let a of e.children){if(a.userData.name==i){let e=a.position.x;let t=makeAnimationForQueue("distance",e,r,r,n,o);if(a.userData.animationQueue===undefined){a.userData.animationQueue=[]}a.userData.animationQueue.push(t)}}}}}}}function updateBackgroundGradientScale(e,t=1,a=.1){let i=Math.max(SCENE.worldPlane.scale.x,SCENE.worldPlane.scale.y);SCENE.worldPlane.userData.animationQueue.push(makeAnimationForQueue("scale",i,e,e,t,a))}function updateCameraPosition(e,t,a,i=1,r=.1){if(e!==undefined){SCENE.camera.userData.animationQueue.push(makeAnimationForQueue("x",SCENE.camera.position.x,e,e,i,r))}if(t!==undefined){SCENE.camera.userData.animationQueue.push(makeAnimationForQueue("y",SCENE.camera.position.y,t,t,i,r))}if(a!==undefined){SCENE.camera.userData.animationQueue.push(makeAnimationForQueue("z",SCENE.camera.position.z,a,a,i,r))}}function updateObjectScale2(e,t,a=1,i=.1){let r=makeAnimationForQueue("scale",[e.scale.x,e.scale.y,e.scale.z],[t,t,t],[t,t,t],a,i);if(e.userData.animationQueue==undefined){e.userData.animationQueue=[]}e.userData.animationQueue.push(r)}function addNewShape(e,t,a,i,r=false){for(ax of Axis){shapeParams=extraShapes[a];if(ax.name==e){if(r){let t=false;for(let e of ax.pivots){if(e.userData.name.slice(0,a.length)==a){t=true;break}}if(!t){continue}}if(shapeParams.cone){addConeToAxis(ax,t,shapeParams,i,a);return}else{if(a.includes("terrain")){i*=terrainsAppearAndDisappearMultiplier}if(a.includes("knot")){i*=knotsAppearAndDisappearMultiplier}addExtraShapeToAxis(ax,t,a,shapeParams,i)}}}}function rotateAxis(t,a,i,r,n=1,o=.1){for(let e of Axis){if(e.name==t){if(e.mainPivot.userData.animationQueue==undefined){e.mainPivot.userData.animationQueue=[]}if(a!==undefined){a=THREE.MathUtils.degToRad(a);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("angleX",e.mainPivot.rotation.x,a,a,n,o))}if(i!==undefined){i=THREE.MathUtils.degToRad(i);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("angleY",e.mainPivot.rotation.y,i,i,n,o))}if(r!==undefined){r=THREE.MathUtils.degToRad(r);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("angleZ",e.mainPivot.rotation.z,r,r,n,o))}}}}function moveAxis(t,a,i,r,n=1,o=.1){for(let e of Axis){if(e.name==t){if(e.mainPivot.userData.animationQueue==undefined){e.mainPivot.userData.animationQueue=[]}if(a!==undefined){a=THREE.MathUtils.degToRad(a);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("x",e.mainPivot.position.x,a,a,n,o))}if(i!==undefined){i=THREE.MathUtils.degToRad(i);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("y",e.mainPivot.position.y,i,i,n,.1))}if(r!==undefined){r=THREE.MathUtils.degToRad(r);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("z",e.mainPivot.position.z,r,r,n,.1))}}}}function getObjectVertexXYZ(e,a,i){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==a){for(child of e.children){let e=child.geometry.getAttribute("position");if(i==undefined){i=rand(0,e.count,1)}let t=new THREE.Vector3(e.getX(i),e.getY(i),e.getZ(i));t.applyMatrix4(child.matrixWorld);return t}}}}}}function addRotationLoop(a,e,r,n){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==a){for(let i of e.children){if(i.userData.name==a){let e;let t;if(r=="X"){e="angleX";t=i.rotation.x}else if(r=="Y"){e="angleY";t=i.rotation.y}else if(r=="Z"){e="angleZ";t=i.rotation.z}let a=makeAnimationForQueue(e,t,t+1,t+1,n,undefined);if(i.userData.animationLoop===undefined){i.userData.animationLoop=[]}i.userData.animationLoop.push(a)}}}}}}}function removeRotationLoop(i,e,r){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==i){for(let a of e.children){if(a.userData.name==i){if(a.userData.animationLoop){let t;if(r=="X"){t="angleX"}else if(r=="Y"){t="angleY"}else if(r=="Z"){t="angleZ"}for(let e=0;e<a.userData.animationLoop.length;e++){if(a.userData.animationLoop[e].attribute==t){a.userData.animationLoop.splice(e,1);return}}}}}}}}}}function logDebugMessage(){let t=`Hash: ${tokenHash} Randomness:`;for(let e=0;e<5;e++){t+=" "+randS(1,100,1)}t+=`\nPalette: ${JSON.stringify(SCENE.palette)}`;t+="\nAxis shapes:";for(let e of Axis){t+="\n"+e.name+":";for(shape in e.extraShapes){t+=" "+shape+` [${e.extraShapes[shape].numberOfShapes} ${e.extraShapes[shape].material}]`}}console.log(t)}async function walletActivityUpdates(e){try{return await getLastBlockReceipts(e)}catch(t){console.error(t)}}function disableAxis(t,a=.01){t.enabled=false;for(let e of t.pivots){if(!e.userData.originalScale){e.userData.originalScale=e.scale.x}updateObjectScale2(e,0,a)}}function enableAxis(e,a=.01){e.enabled=true;for(let t of e.pivots){t.scale.set(0,0,0);updateObjectScale2(t,t.userData.originalScale,a);for(let e of t.children){e.visible=true}}}function axisHasAnimatingPivots(t){for(let e of t.pivots){if(e.userData.animationQueue&&e.userData.animationQueue.length>0){return true}}return false}function setAxisInvisibleAndDisabled(e){e.enabled=false;for(let t of e.pivots){t.userData.originalScale=t.scale.x;t.scale.set(0,0,0);for(let e of t.children){e.visible=false}}}function disappearPivot(e,t=.01,a=false,i=undefined,r=undefined){e.userData.disabled=true;if(a){e.userData.toBeRemovedAfterShrink=true}if(!e.children[0].userData.originalScale){e.children[0].userData.originalScale=JSON.parse(JSON.stringify(e.children[0].scale))}if(e.userData.name.includes("terrain")){t*=terrainsAppearAndDisappearMultiplier}if(e.userData.name.includes("knot")){t*=knotsAppearAndDisappearMultiplier}if(i){e.userData.delayedDisappear=true;setTimeout(()=>{e.userData.shrinkDown=t;e.userData.delayedDisappear=false;e.userData.disappearCallback=r},rand(i[0],i[1],1))}else{e.userData.shrinkDown=t;e.userData.disappearCallback=r}}function disappearObjects(i,r=.01,n=false,o=undefined,s=undefined,l=undefined){let c=0;for(let e=0;e<500;e++){let e=Axis[rand(0,Axis.length-1,1)];if(!e.enabled||!e.pivots||e.pivots.length==0){continue}let t=rand(0,e.pivots.length-1,1);let a=e.pivots[t];if(a.userData.shrinkDown||a.userData.growUp){if(o!="E"){continue}}if(s&&a.userData.shapeType!=s){continue}if(o&&a.userData.name.slice(0,o.length)!=o){continue}if(a.userData.disabled){if(o!="E"&&!n){continue}}if(a.userData.delayedDisappear||a.userData.delayedAppear){continue}disappearPivot(a,r,n,l);c++;if(c>=i){return c}}return c}function disappearObjectsByType(e,t=.01,a=false,i=undefined,r=undefined,n=undefined){let o=0;for(ax of Axis){for(pivot of ax.pivots){if(r&&pivot.userData.shapeType!=r){continue}if(i&&pivot.userData.name.slice(0,i.length)!=i){continue}disappearPivot(pivot,t,a,n);o++;if(e){if(o>=e){return o}}}}return o}function appearObjects(a,i=.01,r=.3,n=undefined){let o=0;for(let e=0;e<500;e++){let e=Axis[rand(0,Axis.length-1,1)];if(!e.enabled||!e.pivots||e.pivots.length==0){continue}let t=e.pivots[rand(0,e.pivots.length-1,1)];if(t.userData.shrinkDown||t.userData.growUp){continue}if(t.userData.delayedDisappear||t.userData.delayedAppear){continue}if(!t.userData.disabled){continue}t.userData.disabled=false;if(t.userData.name.includes("terrain")){i*=terrainsAppearAndDisappearMultiplier}if(t.userData.name.includes("knot")){i*=knotsAppearAndDisappearMultiplier}if(n){t.userData.delayedAppear=true;setTimeout(()=>{t.userData.growUp=i;t.userData.delayedAppear=false},rand(n[0],n[1],1))}else{t.userData.growUp=i}o++;if(o>=a){break}continue;if(t.children[0].userData.animationQueue&&t.children[0].userData.animationQueue.length>0){continue}if(t.userData.animationQueue&&t.userData.animationQueue.length>0){continue}if(t.userData.disabledWithTimeout){continue}if(t.children[0].userData.name.includes("terrain")){i*=terrainsAppearAndDisappearMultiplier}if(t.children[0].userData.name.includes("knot")){i*=knotsAppearAndDisappearMultiplier}if(t.userData.disabled){updateObjectScale2(t.children[0],t.children[0].userData.originalScale,i,r);t.visible=true;t.userData.disabled=false;o++;if(o>=a){break}}}return o}function randomContractData(){let e=[rand(0,1e3,1)];let t=[];let a=[rand(0,1e3,1)];let i=[];let r=[rand(20,300,1)];let n=[];let o=[];let s=[300];let l=1681510366;let c=1681510366;let p=1681510366;let f=1681510366;for(let e=0;e<200;e++){l+=rand(1e3,1e6,1);c+=rand(1e3,1e6,1);p+=rand(1e3,1e6,1);f+=rand(1e3,1e6,1);t.push(l);i.push(c);n.push(p);n.push(rand(3e15,6e15,1));o.push(f);o.push(rand(3e15,6e15,1))}return[e,t,a,i,r,n,o,s]}function pickAxis(t,a=[],i=false,r=false){for(let e=0;e<100;e++){let e=rand(0,Axis.length-1,1);if(!Axis[e].pivots||Axis[e].pivots.length==0){continue}if(r&&Axis[e].extraShapes.size==0){continue}if(a.indexOf(e)!=-1||i&&Axis[e].extremeAngle){continue}if(Axis[e].enabled==t){return Axis[e]}}}function getLoopingObjects(){let a=[];for(let t of Axis){if(t.enabled){for(let e of t.pivots){if(e.children[0].userData.animationLoop||e.userData.animationLoop){a.push([t.name,e])}}}}return a}function getNotLoopingObjects(){let a=[];for(let t of Axis){if(t.enabled){for(let e of t.pivots){if(!e.children[0].animationLoop){a.push([t.name,e])}}}}return a}function animateFog(){if(SCENE.scene.fog.userData){if(SCENE.scene.fog.userData.nearTo){if(SCENE.scene.fog.near<SCENE.scene.fog.userData.nearTo){SCENE.scene.fog.near+=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.near=parseFloat(SCENE.scene.fog.near.toFixed(5))}else if(SCENE.scene.fog.near>SCENE.scene.fog.userData.nearTo){SCENE.scene.fog.near-=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.near=parseFloat(SCENE.scene.fog.near.toFixed(5))}else{SCENE.scene.fog.userData.nearTo=undefined}}if(SCENE.scene.fog.userData.farTo){if(SCENE.scene.fog.far<SCENE.scene.fog.userData.farTo){SCENE.scene.fog.far+=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.far=parseFloat(SCENE.scene.fog.far.toFixed(5))}else if(SCENE.scene.fog.far>SCENE.scene.fog.userData.farTo){SCENE.scene.fog.far-=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.far=parseFloat(SCENE.scene.fog.far.toFixed(5))}else{SCENE.scene.fog.userData.farTo=undefined}}if(SCENE.scene.fog.near>SCENE.scene.fog.far){SCENE.scene.fog.far=SCENE.scene.fog.near+1}else if(SCENE.scene.fog.far-SCENE.scene.fog.near<1){SCENE.scene.fog.far=SCENE.scene.fog.near+1}}}function getNShapesWithTypes(){let t=Object.keys(extraShapes);let a={};for(let e of t){a[e]=0}for(let e of Axis){if(e.enabled){for(pivot of e.pivots){if(!pivot.userData.disabled){for(let e of t){if(pivot.userData.shapeType==e){if(a[e]){a[e]++}else{a[e]=1}}}}}}}return a}function pickAxisForShape(t){let a=[];for(let e=0;e<Axis.length;e++){if(Axis[e].enabled&&extraShapes[t].axis.indexOf(e+1)>-1){a.push(e)}}if(a.length>0){return Axis[pick(a)]}}function pivotNotAnimating(e){for(child of e.children){if(child.userData.animationQueue&&child.userData.animationQueue.length>0){return false}}return e.userData.animationQueue&&e.userData.animationQueue.length==0}function pivotIsAppearingOrDisappearing(e){return Boolean(e.userData.shrinkDown||e.userData.growUp||e.userData.delayedDisappear||e.userData.delayedAppear)}function processUpdateTimers(){let t=getCurrentTs();for(let e=0;e<Axis.length;e++){ax=Axis[e];if(e==5||e==6){if(ax.enabled&&ax.TS_ENABLED&&t>ax.TS_ENABLED){disableAxis(ax,dynamicUpdateAnimationSpeeds.axisAppearAndDisappear.speed);ax.TS_ENABLED=undefined;console.log("Normalized number of axis")}}if(ax.TS_ROTATED&&t>ax.TS_ROTATED){rotateAxis(ax.name,undefined,undefined,ax.originalAngle,dynamicUpdateAnimationSpeeds.axisAngle.speed,dynamicUpdateAnimationSpeeds.axisAngle.curve);ax.TS_ROTATED=undefined;console.log("Normalized axis rotation")}if(ax.TS_ROTATED_EXTREME&&t>ax.TS_ROTATED_EXTREME){rotateAxis(ax.name,undefined,undefined,ax.originalAngle,dynamicUpdateAnimationSpeeds.axisExtremeAngle.speed,dynamicUpdateAnimationSpeeds.axisExtremeAngle.curve);ax.TS_ROTATED_EXTREME=undefined;console.log("Normalized axis extreme rotation")}if(ax.TS_POSITION&&t>ax.TS_POSITION){moveAxis(ax.name,ax.originalPosition[0],ax.originalPosition[1],ax.originalPosition[2],dynamicUpdateAnimationSpeeds.axisPosition.speed,dynamicUpdateAnimationSpeeds.axisPosition.curve);ax.TS_POSITION=undefined;console.log("Normalized axis position")}if(ax.TS_NEGATIVESPACE&&t>ax.TS_NEGATIVESPACE){removeNegativeSpace(ax);ax.TS_NEGATIVESPACE=undefined;console.log("Normalized negative space")}if(ax.TS_NUMBEROFKNOTS&&t>ax.TS_NUMBEROFKNOTS){let e=0;for(p of ax.pivots){if(p.userData.shapeType=="knot"){e++}}let t=e-ax.originalNumberOfKnots;if(t>0){disappearObjectsByType(t,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,"E","knot")}ax.TS_NUMBEROFKNOTS=undefined;console.log("Normalized number of knots")}for(let e of ax.pivots){if(e.userData.TS_SPINNING&&t>e.userData.TS_SPINNING){removeRotationLoop(e.userData.name,ax.name,e.userData.spinningAxis);e.userData.TS_SPINNING=undefined;console.log("Normalized spinning obj")}if(ax.TS_KNOTSPQ&&t>ax.TS_KNOTSPQ&&e.userData.name[0]=="E"){extraShapes.knot.p=extraShapes.knot.originalP;extraShapes.knot.q=extraShapes.knot.originalQ;disappearPivot(e,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,()=>{addNewShape(ax.name,`knot_1`,"knot",dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed)});setTimeout(e=>{e.TS_KNOTSPQ=undefined},5e3,ax);console.log("Normalized knot p q")}if(e.userData.TS_ROTATIONDIRECTION&&t>e.userData.TS_ROTATIONDIRECTION){switchObjectRotationDirection(e.userData.name,ax.name,dynamicUpdateAnimationSpeeds.axisRotationDirection.speed,dynamicUpdateAnimationSpeeds.axisRotationDirection.curve);e.userData.TS_ROTATIONDIRECTION=undefined;console.log("Normalized axis rotation")}}if(ax.TS_EXTRAOBJECTCLASS&&t>ax.TS_EXTRAOBJECTCLASS){for(pivot of ax.pivots){if(pivot.userData.name.includes("update17")){disappearPivot(pivot,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true)}}ax.TS_EXTRAOBJECTCLASS=undefined;console.log("Normalized extra obj class")}}if(SCENE.camera.userData.TS_POSITION&&t>SCENE.camera.userData.TS_POSITION){updateCameraPosition(undefined,undefined,SCENE.camera.userData.originalPositionZ,dynamicUpdateAnimationSpeeds.cameraPosition.speed,dynamicUpdateAnimationSpeeds.cameraPosition.curve);SCENE.camera.userData.TS_POSITION=undefined;console.log("Normalized camera position")}if(SCENE.scene.fog.userData.TS_ENABLED&&t>SCENE.scene.fog.userData.TS_ENABLED){if(SCENE.scene.fog.userData.nearTo){console.log("Fog is already animating")}else{SCENE.scene.fog.userData={nearTo:100,farTo:100};SCENE.scene.fog.enabled=false;SCENE.scene.fog.userData.TS_ENABLED=undefined;console.log("Normalized fog")}}}function updateScene(){try{processUpdateTimers()}catch(s){console.error(s)}for(let t of Axis){for(let e of t.pivots){if(e.userData.toBeRemoved&&!(e.userData.growUp||e.userData.shrinkDown)){console.log(`Removed pivots: ${t.name} - ${e.userData.name}`);SCENE.scene.remove(e);e.userData.alreadyRemoved=true}}t.pivots=t.pivots.filter(e=>!e.userData.alreadyRemoved)}let l="";if(l){console.log(l)}var e=SCENE.data.contract.tiers.royalty_received_tier;var t=SCENE.data.contract.tiers.contract_activity_tier;var a=SCENE.data.contract.tiers.sends_tier;var i=SCENE.data.contract.tiers.approvals_tier;console.log(`Tiers: royalty: ${e.value} contract: ${t.value} sends: ${a.value} approvals: ${i.value}`);l="";let r=shuffle([1,2,3,4,8,9,10,11,14,15,16]);let n=[];if(SCENE.data.memory){if(!SCENE.data.memoryPossibleUpdatesRandom){SCENE.data.memoryPossibleUpdatesRandom=r}for(let t=0;t<SCENE.data.memory;t++){SCENE.data.memory--;let e=SCENE.data.memoryPossibleUpdatesRandom.pop();console.log("Update",e,"recreated from memory");n.push(e);if(t>=1){break}}}else{if(SCENE.data.wallets&&r.length>0){n.push(r.pop())}}if(e.changed){console.log("royalty_received_tier triggered");n.push(5)}if(t.changed){console.log("contract_activity_tier triggered");n.push(13)}if(a.changed){console.log("sends_tier triggered");n.push(6)}if(i.changed){console.log("approvals_tier triggered");n.push(7)}if(n.length==0){n.push(0)}if(DEBUG_UPDATE_SOURCE=="random"){n=[rand(0,16,1)]}if(DEBUG_UPDATE_SOURCE!=undefined&&DEBUG_UPDATE_SOURCE!="random"){n=Array.isArray(DEBUG_UPDATE_SOURCE)?DEBUG_UPDATE_SOURCE:[DEBUG_UPDATE_SOURCE]}console.log("updateType",n);try{if(DEBUG_STOP_UPDATES){console.warn("Updates are stopped");return}}catch{}if(n.indexOf(0)!=-1){let a=0;let i=0;for(let t of Axis){for(let e of t.pivots){if(e.userData.disabled){i++}else{a++}}}let e=rand(10,20,1);let t=rand(1,10,1);try{if(a/i<3){t=0}}catch{t=0}console.log("nObjectsToAppear",e,"nObjectsToDisappear",t);let r=appearObjects(e,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);let n=disappearObjects(t,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);l+=`Appeared objects:${r} Dissapeared objects:${n} (${a},${i})\n`}if(n.indexOf(1)!=-1){let e=Axis[pick([5,6])];if(e.enabled){disableAxis(e,dynamicUpdateAnimationSpeeds.axisAppearAndDisappear.speed);l+=`Disabled axis:${e.name}\n`}else{enableAxis(e,dynamicUpdateAnimationSpeeds.axisAppearAndDisappear.speed);l+=`Enabled axis:${e.name}\n`;e.TS_ENABLED=getCurrentTs()+addOrRemoveAxisUpdateTimeout}}if(n.indexOf(2)!=-1){let e=pickAxis(true,[],true);if(e==undefined){console.log("No axis for angle change found");return}let t=randFromRange(hashOverwrites.axisAngle);let a=THREE.MathUtils.radToDeg(e.mainPivot.rotation.z);if(!e.originalAngle){e.originalAngle=a}rotateAxis(e.name,undefined,undefined,t,dynamicUpdateAnimationSpeeds.axisAngle.speed,dynamicUpdateAnimationSpeeds.axisAngle.curve);l+=`Changed ${e.name} angle from ${a} to ${t}\n`;e.TS_ROTATED=getCurrentTs()+axisAngleUpdateTimeout}if(n.indexOf(3)!=-1){let e=pickAxis(true,[],true);if(e==undefined){console.log("No axis for extreme angle change found");return}let t=THREE.MathUtils.radToDeg(e.centralRodRotation[2]);let a=rand(0,1,.001)>.5?rand(-90,-30,1):rand(30,90,1);let i=THREE.MathUtils.radToDeg(e.mainPivot.rotation.z);if(e.originalAngle==undefined){e.originalAngle=i}e.extremeAngle=a;e.axisAngle=[a,a,1];e.extremeAngleEnabledTimestamp=getCurrentTs();rotateAxis(e.name,undefined,undefined,a,dynamicUpdateAnimationSpeeds.axisExtremeAngle.speed,dynamicUpdateAnimationSpeeds.axisExtremeAngle.curve);l+=`Changed ${e.name} extreme angle from ${t} to ${a}\n`;e.TS_ROTATED_EXTREME=getCurrentTs()+axisExtremeAngleUpdateTimeout}if(n.indexOf(4)!=-1){let e=pickAxis(true,[],false);let t=`${e.centraRodPosition[0]} ${e.centraRodPosition[1]} ${e.centraRodPosition[2]}`;if(!e.originalPosition){e.originalPosition=JSON.parse(JSON.stringify(e.centraRodPosition))}let a=undefined;let i=undefined;let r=undefined;let n=rand(0,2,1);if(n==0){a=randFromRange(hashOverwrites.axisX)}else if(n==1){i=randFromRange(hashOverwrites.axisY)}else{r=randFromRange(hashOverwrites.axisZ)}let o=`${a/20} ${i/20} ${r/20}`;moveAxis(e.name,a,i,r,dynamicUpdateAnimationSpeeds.axisPosition.speed,dynamicUpdateAnimationSpeeds.axisPosition.curve);l+=`Changed ${e.name} position from ${t} to ${o}\n`;e.TS_POSITION=getCurrentTs()+axisPositionUpdateTimeout}if(n.indexOf(5)!=-1){console.log("royalty tier triggered");let a=tierToValue(tiersStructure.royalty,e.value);let i=pickAxis(true,[],false);for(let t of i.pivots){let e=t.userData.originalRotationSpeed*a;updateObjectRotationSpeed(t.userData.name,i.name,e,dynamicUpdateAnimationSpeeds.objectRotationSpeed.speed,dynamicUpdateAnimationSpeeds.objectRotationSpeed.curve);l+=`Changed ${i.name} ${t.userData.name} rotation speed from ${t.userData.originalRotationSpeed} to ${e}\n`}}if(n.indexOf(6)!=-1){console.log("sends tier triggered");let i=tierToValue(tiersStructure.sends,a.value);for(ax of Axis){if(ax.enabled){for(let a of ax.pivots){let e=a.userData.originalPosition[0];let t=e*i;updateObjectDistanceFromAxis(a.userData.name,ax.name,t,dynamicUpdateAnimationSpeeds.objectPosition.speed,dynamicUpdateAnimationSpeeds.objectPosition.curve);l+=`Changed ${ax.name} ${a.userData.name} distance from axis from ${e} to ${t}\n`}}}}if(n.indexOf(7)!=-1){console.log("sends approvals triggered");let e=tierToValue(tiersStructure.approvals,i.value);if(!SCENE.worldPlane.userData.originalScaleX){SCENE.worldPlane.userData.originalScaleX=SCENE.worldPlane.scale.x}let t=SCENE.worldPlane.userData.originalScaleX*e;updateBackgroundGradientScale(t,dynamicUpdateAnimationSpeeds.gradientScale.speed,dynamicUpdateAnimationSpeeds.gradientScale.curve);l+=`Changed gradient scale from ${SCENE.worldPlane.scale.x} to ${t}\n`}if(n.indexOf(8)!=-1){let n=getLoopingObjects().length;let t=getNotLoopingObjects();shuffle(t);console.log(t);let o=randFromRange(spinningObjectsRange);l+=`N spinning objects: ${n} Desired N spinning objects: ${o}\n`;let s=false;for(let e=0;e<500;e++){for(let r of t){let e=r[0];let t=r[1];if(t.userData.name.includes("terrain")){continue}let a=randFromRange(dynamicUpdateAnimationSpeeds.objectRotationSpeed2.speed);let i="Y";if(t.userData.name.includes("cone")){i="Z";a*=conesSpinningSpeedMultiplier}else if(t.userData.name.includes("knot")){a*=knotsSpinningSpeedMultiplier}if(t.children[0].userData.animationLoop==undefined||t.children[0].userData.animationLoop.length==0){addRotationLoop(t.userData.name,e,i,a);l+=`Adding rotation loop to ${e} ${t.userData.name} speed: ${a}\n`;t.userData.spinningAxis=i;t.userData.TS_SPINNING=getCurrentTs()+objectSpinningUpdateTimeout;n++;if(n>=o){s=true;break}break}}if(s){break}}}if(n.indexOf(9)!=-1){if(SCENE.camera.userData.animationQueue&&SCENE.camera.userData.animationQueue.length>0){console.log("Camera is already animating",SCENE.camera.userData.animationQueue)}else{if(!SCENE.camera.userData.originalPositionZ){SCENE.camera.userData.originalPositionZ=SCENE.camera.position.z}SCENE.camera.userData.positionUpdateTimestamp=getCurrentTs();let e=rand(30,cameraZ-5,1);if(rand(0,1,.01)>.5){e=rand(cameraZ+5,150,1)}updateCameraPosition(undefined,undefined,e,dynamicUpdateAnimationSpeeds.cameraPosition.speed,dynamicUpdateAnimationSpeeds.cameraPosition.curve);l+=`Changed camera position to ${e}\n`;SCENE.camera.userData.TS_POSITION=getCurrentTs()+cameraPositionUpdateTimeout}}if(n.indexOf(10)!=-1){if(!SCENE.scene.fog.enabled){if(SCENE.scene.fog.userData.nearTo){console.log("Fog is already animating")}else{SCENE.scene.fog.userData={nearTo:fogNear,farTo:fogFar};SCENE.scene.fog.enabled=true;l+=`Enabled fog\n`;SCENE.scene.fog.userData.TS_ENABLED=getCurrentTs()+fogUpdateTimeout}}else{if(SCENE.scene.fog.userData.nearTo){console.log("Fog is already animating")}else{SCENE.scene.fog.userData={nearTo:250,farTo:260};SCENE.scene.fog.enabled=false;l+=`Disabled fog\n`}}}if(n.indexOf(11)!=-1){let t=pickAxis(true,[],false);for(let e of t.pivots){t.rotationDirectionSwitchTimestamp=getCurrentTs();switchObjectRotationDirection(e.userData.name,t.name,dynamicUpdateAnimationSpeeds.axisRotationDirection.speed,dynamicUpdateAnimationSpeeds.axisRotationDirection.curve);e.userData.TS_ROTATIONDIRECTION=getCurrentTs()+axisRotationDirectionUpdateTimeout}l+=`Changed axis rotation direction ${t.name} \n`}if(n.indexOf(13)!=-1){console.log("sends activity triggered");let a=0;for(let e of Axis){if(e.enabled){a+=e.pivots.map(e=>!e.userData.disabled).length}}let i=getNShapesWithTypes();console.log("nShapesByType:",i);if(!SCENE.originalNumberOfShapes){SCENE.originalNumberOfShapes=a;SCENE.originalNumberOfShapesByType=i}let e=tierToValue(tiersStructure.contract,t.value);for(let t of Object.keys(SCENE.originalNumberOfShapesByType)){if(t=="terrain"||t=="clouds"||t=="knot"){continue}if(SCENE.originalNumberOfShapesByType[t]){var o=SCENE.originalNumberOfShapesByType[t]*e}else{var o=i[t]*e}if(i[t]!=o){l+=`${t} current: ${i[t]} desired: ${o}\n`}if(a<300&&o>i[t]){for(let e=0;e<o-i[t];e++){let e=pickAxisForShape(t);if(!e){console.warn("No axis picked for",t);continue}setTimeout(()=>{addNewShape(e.name,`E_${t}_${generateUUID()}`,t,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);l+=`Added shape ${t} to ${e.name} \n`},randFromRange(addOrRemoveObjectsTieredTimeSpreadRange))}}else if(a>20&&o<i[t]){let e=disappearObjects(Math.abs(i[t]-o),dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,t,addOrRemoveObjectsTieredTimeSpreadRange);l+=`Removed ${e}\n`}else{console.debug("Can't add or remove shapes")}}}if(n.indexOf(17)!=-1){let a={};let i=[];for(let t of Axis){if(t.enabled){for(let e of t.pivots){if(a[e.userData.shapeType]){a[e.userData.shapeType]++}else{a[e.userData.shapeType]=1}if(e.userData.name.includes("update17")&&i.indexOf(e.userData.shapeType)==-1){i.push(e.userData.shapeType)}}}}if(!SCENE.originalNumberOfShapeTypes){SCENE.originalNumberOfShapeTypes=sizeOfMapping(a)}let e=pick([0,1]);if(e==1&&i.length<=2||i.length==0){for(let i of shuffle(Object.keys(extraShapes))){if(!a[i]){let t=pickAxis(true,[],false);let a=extraShapes[i].numberOfShapes;console.log("Adding",a,i,"to",t.name);for(let e=0;e<a;e++){addNewShape(t.name,`E_${i}_update17_${generateUUID()}`,i,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);t.TS_EXTRAOBJECTCLASS=getCurrentTs()+objectClassUpdateTimeout}break}}}else if(e==0&&i.length>0){let e=pick(i);console.log("Removing existing shape type",e);let t=disappearObjectsByType(undefined,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,e);console.log("nDisappeared",t)}}if(n.indexOf(14)!=-1){let t=pick(["triangle","diamond"]);let a=randFromRange(nObjectsLeftOutsideOfNegativeSpace);let i=pick(diamondNegativeSpaceAngles);for(let e of Axis){if(e.clipPlanes==undefined||e.clipPlanes.length==0){createNegativeSpace(e,t,true,a,i);l+=`Added ${t} negative space to ${e.name}\n`;e.TS_NEGATIVESPACE=getCurrentTs()+negativeSpaceUpdateTimeout}else{if(e.removingNegativeSpace||e.creatingNegativeSpace){console.log(`Negative space for ${e.name} already being animated.`)}else{removeNegativeSpace(e);l+=`Removed negative space from ${e.name}\n`}}}}if(n.indexOf(15)!=-1){let e=rand(5,40,1);let t=0;for(ax of Axis){let e=0;for(p of ax.pivots){if(p.userData.shapeType=="knot"){e++}}t+=e;if(!ax.originalNumberOfKnots){ax.originalNumberOfKnots=e}}console.log(`Number of knots ${t} desired number of knots ${e}`);let i=e-t;if(i==0){console.log("Nothing to do")}else{if(i>0){for(let a=0;a<Math.abs(i);a++){let e=pick(extraShapes["knot"].axis);let t=Axis[e-1];addNewShape(t.name,`E_knot_${a}`,"knot",dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);if(!SCENE.knotUpdateTimestamp){SCENE.knotUpdateTimestamp=getCurrentTs()}t.TS_NUMBEROFKNOTS=getCurrentTs()+numberOfKnotsUpdateTimeout;l+=`Added knot to ${t.name}\n`}}else{disappearObjects(Math.abs(i),dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,"E","knot");l+=`Removed knots\n`}}}if(n.indexOf(16)!=-1){if(extraShapes.knot.originalP==undefined){extraShapes.knot.originalP=extraShapes.knot.p}extraShapes.knot.p=knotsDynamicPRange;if(extraShapes.knot.originalQ==undefined){extraShapes.knot.originalQ=extraShapes.knot.q}extraShapes.knot.q=knotsDynamicQRange;for(let t of Axis){if(!t.addingKnots){for(let e of t.pivots){if(e.userData.name.includes("knot")&&e.userData.name[0]!="E"){if(!pivotIsAppearingOrDisappearing(e)){l+=`Changing q and p of ${t.name} ${e.userData.name}\n`;t.addingKnots=true;disappearPivot(e,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,()=>{addNewShape(t.name,`E_knot_${generateUUID()}`,"knot",dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed)});t.TS_KNOTSPQ=getCurrentTs()+knotsPQUpdateTimeout;setTimeout(()=>{t.addingKnots=false},6e4)}}}}}}console.log(l)}function getPivotsWithSmallShapes(i){for(let a of Axis){if(a.enabled){for(let t=0;t<a.pivots.length;t++){let e=a.pivots[t];if(e.children[0].scale.x<i&&e.children[0].scale.x!=0){console.log(a.name,t,e.userData.name)}}}}}function processShrinkAndGrow(a){let i=.005;if(a.userData.shapeType=="terrain"||a.userData.shapeType=="smallterrain"){i=.01}if(a.userData.shrinkDown){if(a.userData.shrinkDown<1e-6){a.userData.shrinkDown=1e-6}if(a.userData.shrinkDown>.1){a.userData.shrinkDown=.1}let t=true;for(let e of["x","y","z"]){if(a.children[0].scale[e]>i){a.children[0].scale[e]-=a.userData.shrinkDown;if(a.children[0].scale[e]<i){a.children[0].scale[e]=i}t=false}else{a.children[0].scale[e]=i;a.userData.toBeRemoved=a.userData.toBeRemovedAfterShrink}}if(t){a.userData.shrinkDown=undefined;a.visible=false;if(a.userData.disappearCallback){a.userData.disappearCallback()}}}if(a.userData.growUp){if(a.userData.growUp<1e-6){a.userData.growUp=1e-6}if(a.userData.growUp>.1){a.userData.growUp=.1}let t=true;a.visible=true;for(let e of["x","y","z"]){if(a.children[0].scale[e]<a.children[0].userData.originalScale[e]){a.children[0].scale[e]+=a.userData.growUp;t=false}else{a.children[0].scale[e]=a.children[0].userData.originalScale[e]}}if(t){a.userData.growUp=undefined}}}async function getThreeJS(){for(let t=0;t<NODE_PROVIDER_URLS.length;t++){try{var a=await fetch(NODE_PROVIDER_URLS[t],{method:"POST",body:JSON.stringify({method:"eth_call",params:[{to:"0x16cc845d144A283D1b0687FBAC8B0601cC47A6C3",data:"0x43920d7d0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001074687265652e6a7320302e3134342e3000000000000000000000000000000000"},"latest"],id:2,jsonrpc:"2.0"})});let e=await a.json();return hexToString(e.result)}catch(e){console.log("Node failed.",NODE_PROVIDER_URLS[t])}}}function hexToString(t){if(t.startsWith("0x")){t=t.slice(2)}let a="";for(let e=0;e<t.length;e+=2){const i=parseInt(t.substr(e,2),16);a+=String.fromCharCode(i)}return a}async function dataUpdate(){if(document.hidden){console.log("Tab is not on focus, no data updates");try{SCENE.data.contract.tiers.royalty_received_tier.changed=false;SCENE.data.contract.tiers.contract_activity_tier.changed=false;SCENE.data.contract.tiers.sends_tier.changed=false;SCENE.data.contract.tiers.approvals_tier.changed=false}catch(e){}return}NODE_PROVIDER_URLS=shuffle(NODE_PROVIDER_URLS);SCENE.data.contractPrev=SCENE.data.contract;SCENE.data.contract=await getContractData();if(getCurrentTs()>contractMintTimestamp+receiptsFetchingOffset){NODE_PROVIDER_URLS=shuffle(NODE_PROVIDER_URLS);SCENE.data.wallets=await walletActivityUpdates(SCENE.data.contract[SCENE.data.contract.length-1])}else{console.log("Receipts fetching will start at",contractMintTimestamp+receiptsFetchingOffset)}SCENE.data.contract.tiers=SCENE.data.contractPrev.tiers;calculateTiers(SCENE.data.contract);calculateContractDataUpdates();console.debug("Tiers:",SCENE.data.contract.tiers);console.debug("Data updates:",[SCENE.data.contractUpdates.approvalCount,SCENE.data.contractUpdates.transferCount,SCENE.data.contractUpdates.holderCount,SCENE.data.contractUpdates.royalty]);if(!LIVE_MODE){SCENE.data.contract=randomContractData();calculateContractDataUpdates();SCENE.data.contract.tiers={royalty_received_tier:{changed:pick([true,false]),value:rand(-3,3,1)},contract_activity_tier:{changed:pick([true,false]),value:rand(-3,3,1)},sends_tier:{changed:pick([true,false]),value:rand(-3,3,1)},approvals_tier:{changed:pick([true,false]),value:rand(-3,3,1)}};console.debug("Random Tiers:",SCENE.data.contract.tiers);console.debug("Random data updates:",[SCENE.data.contractUpdates.approvalCount,SCENE.data.contractUpdates.transferCount,SCENE.data.contractUpdates.holderCount,SCENE.data.contractUpdates.royalty])}}function init(){SCENE={data:{wallet:{},contract:{}},specialObjects:{},updateStartTimesAndValues:{}};if(tokenHash){populatePalette();populateAbstractMaterials();populateAxisExtraShapes();overwriteAxis();logDebugMessage()}SCENE.camera=makeCamera();SCENE.scene=makeScene();SCENE.renderer=makeRenderer();for(let r of Axis){r.mainPivot=new THREE.Object3D;r.mainPivot.name=r.name;var a=[];for(let e in r.coneTypes){r.coneTypes[e][e]=true;a.push(r.coneTypes[e])}shuffle(a);r.axisArrayConeTypes=a;if(r.enableNegativeSpace){createNegativeSpace(r,undefined,true)}r.pivots=[];let i=r.growShapes.onStartup?r.growShapes.speed:undefined;for(let a in r.extraShapes){let t=r.extraShapes[a];for(let e=0;e<t.numberOfShapes;e++){if(t.cone){addConeToAxis(r,`cone${e}`,t,i,a)}else{addExtraShapeToAxis(r,`${a}${e}`,a,t,i)}}}let e=meanPositionOfPivots(r.pivots);let t=meanRotationOfPivots(r.pivots);r.centraRodPosition=e;r.centralRodRotation=t;if(r.addCentralRod){r.rodMaterial=new THREE.MeshBasicMaterial({color:r.centralRodColor,side:THREE.FrontSide,wireframe:false});const s=new THREE.BoxGeometry(r.centralRodWidth,r.centralRodLength,r.centralRodWidth);r.rod=new THREE.Mesh(s,r.rodMaterial);r.rod.position.set(e[0],e[1],e[2]);r.rod.rotation.z=t[2];r.mainPivot.add(r.rod)}SCENE.scene.add(r.mainPivot);if(!r.enabled){setAxisInvisibleAndDisabled(r)}}for(let e of Lights){makeLight(e);SCENE.scene.add(e.light)}if(enableWorldGradient){makeWorldPlane()}SCENE.renderer.render(SCENE.scene,SCENE.camera);if(enableShadows){SCENE.renderer.shadowMap.enabled=true;SCENE.renderer.shadowMap.type=THREE.PCFShadowMap}let i=new THREE.Clock;let r=0;let n=1/animationFPS;SCENE.cameraMovementSpeed={x:0,y:0,z:0};const o=e=>{requestAnimationFrame(o);r+=i.getDelta();animateFog();for(let a of Axis){if(a.mainPivot.userData.animationQueue&&a.mainPivot.userData.animationQueue.length>0){processAnimationQueue(a.mainPivot)}for(let t of a.pivots){processShrinkAndGrow(t);t.rotateY(THREE.MathUtils.degToRad(t.userData.rotationSpeed*r));if(t.userData.animationQueue&&t.userData.animationQueue.length>0){processAnimationQueue(t)}if(t.userData.animationLoop){processAnimationLoop(t)}for(let e of t.children){if(e.userData.animationQueue&&e.userData.animationQueue.length>0){processAnimationQueue(e)}if(e.userData.animationLoop){processAnimationLoop(e)}}}if(a.enableNegativeSpaceAnimation){animateAxisNegativeSpace(a,r)}try{if(a.clipPlanes){for(let e of a.clipPlanes){if(e.userData){if(e.userData.desiredConstant>e.constant){e.constant+=negativeSpaceAnimationSpeed}else if(e.userData.desiredConstant<e.constant){e.constant-=negativeSpaceAnimationSpeed}}}}}catch(t){console.error("Animating negative space failed")}}if(SCENE.worldPlane.userData.animationQueue&&SCENE.worldPlane.userData.animationQueue.length>0){processAnimationQueue(SCENE.worldPlane)}if(SCENE.camera.userData.animationQueue&&SCENE.camera.userData.animationQueue.length>0){processAnimationQueue(SCENE.camera)}if(enableWorldGradientAnimation){animateWorldPlane()}if(enableFog){processAnimationQueue(SCENE.scene.fog)}if(SCENE.cameraMovementSpeed.y!=0){SCENE.camera.position.y+=SCENE.cameraMovementSpeed.y;SCENE.cameraMovementSpeed.y*=.98}if(SCENE.cameraMovementSpeed.x!=0){SCENE.camera.position.x+=SCENE.cameraMovementSpeed.x;SCENE.cameraMovementSpeed.x*=.98}if(SCENE.cameraMovementSpeed.z!=0){SCENE.camera.position.z+=SCENE.cameraMovementSpeed.z;SCENE.cameraMovementSpeed.z*=.98}SCENE.renderer.render(SCENE.scene,SCENE.camera);r=r%n};requestAnimationFrame(o);function e(){let e=window.innerWidth/window.innerHeight;SCENE.camera.aspect=e;SCENE.renderer.setSize(window.innerWidth,window.innerHeight);SCENE.camera.updateProjectionMatrix()}window.addEventListener("resize",e,false);e();document.addEventListener("keydown",function(e){if(e.key==="o"){if(SCENE.camera.zoom>.6){SCENE.camera.zoom-=.003;SCENE.camera.updateProjectionMatrix()}}if(e.key==="i"){if(SCENE.camera.zoom<2.5){SCENE.camera.zoom+=.003;SCENE.camera.updateProjectionMatrix()}}})}INITIALUPDATE=true;if(LIVE_MODE){getThreeJS().then(t=>{eval(t.slice(156,t.length-22));initImprovedNoise();initOBJLoader();init();setTimeout(2e3,dataUpdate());setInterval(dataUpdate,12e3);setInterval(updateScene,12e3)})}else{initImprovedNoise();initOBJLoader();init();dataUpdate();setInterval(dataUpdate,12e3);setInterval(updateScene,12e3)}window.onkeydown=function(e){if(e.keyCode===77){document.querySelector("body").insertAdjacentHTML("afterend",`<div id="prompt-container" class="prompt-container"><p>Change node URL:</p><input id="prompt" class="prompt" value="${NODE_PROVIDER_URLS[0]}"/></div>`)}else if(e.keyCode===13){p=document.getElementById("prompt");NODE_PROVIDER_URLS=[p.value];console.log(NODE_PROVIDER_URLS);pc=document.getElementById("prompt-container");pc.remove()}else if(e.keyCode===27){pc=document.getElementById("prompt-container");pc.remove()}};function hashString(t){let a=5381;for(let e=0;e<t.length;e++){a=a*33^t.charCodeAt(e)}return a>>>0}function rand(t,a,e=.001){if(t==a){return t}if(t>a){let e=t;t=a;a=e}const i=randomNumberGenerator.random();const r=(a-t)/e+e;const n=Math.floor(i*r)*e;return t+n}function randS(t,a,e=.001){if(t==a){return t}if(t>a){let e=t;t=a;a=e}const i=randomNumberGeneratorSeeded.random();const r=(a-t)/e+e;const n=Math.floor(i*r)*e;return t+n}function randFromRange(e){return rand(e[0],e[1],e[2])}function randFromRangeS(e){let t=randS(e[0],e[1],e[2]);return[t,t,1]}function randFromRangeS2(e){return randS(e[0],e[1],e[2])}function shuffle(t){for(let e=t.length-1;e>0;e--){const a=Math.floor(randomNumberGenerator.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t}function shuffleS(t){for(let e=t.length-1;e>0;e--){const a=Math.floor(randS(0,1,.01)*e);[t[e],t[a]]=[t[a],t[e]]}return t}function pick(e){return e[rand(0,e.length-1,1)]}function pickS(e){return e[randS(0,e.length-1,1)]}function pickS2(e){let t=JSON.parse(JSON.stringify(e));shuffleS(t);if(t.length==1){let e=t.pop();return[e,e]}v1=t.pop();v2=t.pop();v3=v2;while(v1==v2){if(t.length==0){v2=v3;break}v2=t.pop()}return[v1,v2]}function numberOfShapesMinMax(e){return Array.isArray(e)?randFromRangeS(e)[0]:e}function pickFromProbabilityArrayS(e){let t=JSON.parse(JSON.stringify(e));shuffleS(t);let a=0;let i=-1;let r=null;let n=randS(0,1,.01);for(let e=0;e<t.length;e++){a+=t[e][0];if(n<a){return t[e][1]}else if(t[e][0]>i){i=t[e][0];r=t[e]}}return r[1]}function pickFromProbabilityMapS(e){let t=JSON.parse(JSON.stringify(e));shuffleS(t);let a=0;let i=-1;let r=null;let n=randS(0,1,.01);for(let e=0;e<t.length;e++){a+=t[e].probability;if(n<a){return t[e]}else if(t[e].probability>i){i=t[e].probability;r=t[e]}}return r}function smallerRange(e,t){e=randFromRangeS(e);return[e[0]-t,e[0]+t,e[2]]}function overwriteAxis(){let e=randFromRangeS(hashOverwrites.axisAngle)[0];let t=randFromRangeS(hashOverwrites.axisAngle)[0];let i=shuffleS([[e-2,e+2,1],[e-2,e+2,1],[e-2,e+2,1],[t-2,t+2,1],[t-2,t+2,1],[t-2,t+2,1],[t-2,t+2,1]]);for(let a=0;a<Axis.length;a++){let e=Axis[a];let t=i.pop();e.name=`axis${a+1}`;e.axisAngle=t;e.originalAxisAngle=t;e.axisExtremeAngle=undefined;e.extremeAngleEnabledTimestamp=undefined;e.axisX=smallerRange(hashOverwrites.axisX,5);e.axisY=smallerRange(hashOverwrites.axisY,5);e.axisZ=smallerRange(hashOverwrites.axisZ,5)}}function populatePalette(){if(traitsPalette){SCENE.palette=palettes[traitsPalette[0]]}else{palettes=shuffleS(palettes);SCENE.palette=pickFromProbabilityMapS(palettes)}worldGradientColors=[[SCENE.palette.gradient[2],SCENE.palette.gradient[0]],[SCENE.palette.gradient[3],SCENE.palette.gradient[1]]];fogColor=pickS(SCENE.palette.colors.filter(e=>{return e!=SCENE.palette.gradient[0]&&e!=SCENE.palette.gradient[1]}));console.log(fogColor)}function populateAxisExtraShapes(){let t=Object.keys(materialTemplates);let a=-1;for(shapeType in extraShapes){a++;shapeParams=extraShapes[shapeType];shapeParams.originalNumberOfShapes=shapeParams.numberOfShapes;shapeParams.numberOfShapes=randS(shapeParams.numberOfShapes[0],shapeParams.numberOfShapes[1]||shapeParams.numberOfShapes[0],1);shapeParams.material=pickFromProbabilityArrayS(shapeParams.material);if(traitsObjects){for(let e=0;e<traitsObjects.length;e+=3){if(traitsObjects[e]==a){shapeParams.axisToBeAddedTo=[pick(shapeParams.axis)];shapeParams.material=t[traitsObjects[e+1]]}}}else{for(let e=0;e<Axis.length;e++){shapeParams.axisToBeAddedTo=[pick(shapeParams.axis)]}}if(shapeParams.extraAxis&&shapeParams.extraAxis.length>0){if(!shapeParams.axisToBeAddedTo){shapeParams.axisToBeAddedTo=[pick(shapeParams.extraAxis)]}else{shapeParams.axisToBeAddedTo.push(pick(shapeParams.extraAxis))}}if(shapeParams.secondColor){let e=pickS(SCENE.palette.colors);if(Array.isArray(e)){e=e[0]}shapeParams.secondColor=e}}for(shapeType in extraShapes){if(shapeType=="knot"){shapeParams=extraShapes[shapeType];if(Array.isArray(shapeParams.material)){shapeParams.material=pickFromProbabilityArrayS(shapeParams.material)}}}for(let e=0;e<Axis.length;e++){Axis[e].extraShapes={};for(shapeType in extraShapes){shapeParams=JSON.parse(JSON.stringify(extraShapes[shapeType]));if(shapeParams.axisToBeAddedTo&&shapeParams.axisToBeAddedTo.indexOf(e+1)>-1){if(!traitsObjects&&randS(0,1,.01)<1-shapeParams.probability){continue}Axis[e].extraShapes[shapeType]=shapeParams}}}}function populateAbstractMaterials(){for(let f in materialTemplates){let t=materialTemplates[f];t={color:t[0],wireframe:t[2],shininess:t[1],enableTexture:t[3],textureColorVariant:pickS(t[4]),textureSize:t[13],textureNoiseSize:t[14],textureBase:t[11],textureMultiplier:t[12],textureBumpAmount:t[16],enableTextureBump:t[15],textureOffset:t[10],textureScale:t[8],textureRecolor:t[7],textureRotation:t[9],useTextureTransparency:t[6],textureBumpVariant:t[5]};let e=pickS2(SCENE.palette.colors);let a=e[0];let i=e[1];t.color=a;t.textureRecolor=i;let r=[undefined,undefined];let n=t.color;let o=false;if(typeof t.wireframe=="boolean"){o=t.wireframe}else{o=randS(0,1,.01)>1-t.wireframe;console.log(t.wireframe,o)}let s=t.shininess;let l=undefined;if(typeof t.enableTexture=="number"){t.enableTexture=randS(0,1,.001)>1-t.enableTexture}if(t.enableTexture){if(["simple","perlin3","simplex3"].indexOf(t.textureColorVariant)>=0){let e=makePerlinTexture(t.textureSize[0],t.textureSize[1],t.textureNoiseSize[0],t.textureNoiseSize[1],t.textureBase,t.textureMultiplier,true,t.textureBumpAmount,t.textureColorVariant);r[0]=e[0];if(t.enableTextureBump){r[1]=e[1]}}else if(t.textureColorVariant in base64Textures){let e=loadTextureRecolor(t.textureColorVariant,t.textureOffset[0],t.textureOffset[1],t.textureScale[0],t.textureScale[1],t.textureRecolor,n,t.textureRotation);if(t.useTextureTransparency){l=loadTextureRecolor(t.textureColorVariant,t.textureOffset[0],t.textureOffset[1],t.textureScale[0],t.textureScale[1],"#FFFFFF","#000000",t.textureRotation)}r[0]=e;if(t.enableTextureBump){if(t.textureColorVariant==t.textureBumpVariant){r[1]=e}else{let e=makePerlinTexture(t.textureSize[0],t.textureSize[1],t.textureNoiseSize[0],t.textureNoiseSize[1],t.textureBase,t.textureMultiplier,true,t.textureBumpAmount,t.textureColorVariant);r[1]=e[0]}}}}let c={type:"phong",color:n,side:THREE.DoubleSide,wireframe:o,shininess:s,map:r[0],bumpMap:r[1],alphaMap:l};let p=makeMaterial(c);p.userData.name=f;materialTemplates[f]=p}}function vertexIndexSequence(r){r-=1;let n=[];for(let i=0;i<r;i++){let e=i;let t=i+1;let a=r-i;if(t==a){t++}n=n.concat(e,t,a)}return n}function makeExtrudeShapeMesh(e,t,a,i){function r(t){let a=new THREE.Shape;for(let e=0;e<t.length;e++){if(e==0){a.moveTo(t[e][0],t[e][1])}else{a.lineTo(t[e][0],t[e][1])}}return a}let n=r(e);if(t.length>0){let e=r(t);n.holes.push(e)}let o=new THREE.ExtrudeGeometry(n,a);let s=new THREE.Mesh(o,i);return s}function makeFrame(e,t,a,i,r,n,o,s){let l=[[t,a],[t,-a],[-t,-a],[-t,a]];let c={steps:2,depth:r,bevelEnabled:false};let p=[];for(let a of l){let e=a[0]<0?a[0]+i:a[0]-i;let t=a[1]<0?a[1]+i:a[1]-i;p.push([e,t])}let f=makeExtrudeShapeMesh(l,p,c,e);if(o){f.position.set(o[0],o[1],o[2])}if(n){f.scale.set(n[0],n[1],n[2])}if(s){f.rotation.set(THREE.MathUtils.degToRad(s[0]),THREE.MathUtils.degToRad(s[1]),THREE.MathUtils.degToRad(s[2]))}return f}function makeRectangle(e,t,a,i,r,n,o){let s=[[t,a],[t,-a],[-t,-a],[-t,a]];let l={steps:2,depth:i,bevelEnabled:false};let c=makeExtrudeShapeMesh(s,[],l,e);if(n){c.position.set(n[0],n[1],n[2])}if(r){c.scale.set(r[0],r[1],r[2])}if(o){c.rotation.set(THREE.MathUtils.degToRad(o[0]),THREE.MathUtils.degToRad(o[1]),THREE.MathUtils.degToRad(o[2]))}return c}function makeArrow(e,t,a,i,r,n,o,s,l=0){if(l==0){var c=[[4.23,.1],[.65,8.65],[-3.48,-.71],[-.4,.84],[-.97,-6.59],[.73,-6.52],[1.02,1.08]]}else if(l==1){var c=[[-4-.13,0-1],[.65,8.65],[-3.48,-.71],[-.4,-.84],[-.07,-.09],[.73,-.52],[1.02,1.08]]}else if(l==2){var c=[[-4-.13,0-1],[.65,1.55,8.65,3.56,.22],[-3.48,-.71],[-.4,-.84],[-.07,-.09],[.73,-.52],[1.02,1.08]]}else if(l==3){var c=[[-14-.13,10-1],[.65,-1.55,8.65,-3.56,.22],[-13.48,10.71],[-20.4,-.84],[-.07,-.09],[2.73,-.52],[1.02,1.08]]}let p={steps:2,depth:t,bevelEnabled:true,bevelThickness:a,bevelSize:i,bevelOffset:0,bevelSegments:r};let f=makeExtrudeShapeMesh(c,[],p,e);if(o){f.position.set(o[0],o[1],o[2])}if(n){f.scale.set(n[0],n[1],n[2])}if(s){f.rotation.set(THREE.MathUtils.degToRad(s[0]),THREE.MathUtils.degToRad(s[1]),THREE.MathUtils.degToRad(s[2]))}return f}function makeKnot(e,t,a,i,r,n,o,s,l,c){const p=new THREE.TorusKnotGeometry(t,a,i,r,n,o);p.computeVertexNormals();const f=new THREE.Mesh(p,e);if(l){f.position.set(l[0],l[1],l[2])}if(s){f.scale.set(s[0],s[1],s[2])}if(c){f.rotation.set(THREE.MathUtils.degToRad(c[0]),THREE.MathUtils.degToRad(c[1]),THREE.MathUtils.degToRad(c[2]))}return f}function makeMaterial(e={type:undefined,color:undefined,side:undefined,wireframe:undefined,shininess:undefined,map:undefined,bumpMap:undefined,alphaMap:undefined}){let t={color:e.color?e.color:"#FFFFFF",side:e.side,wireframe:e.wireframe,shininess:e.shininess};if(e.map){t.map=e.map;if(e.alphaMap){t.alphaMap=e.alphaMap;t.alphaTest=.8;t.premultipliedAlpha=true}}if(e.bumpMap){t.bumpMap=e.bumpMap}let a=new THREE.MeshPhongMaterial(t);a.userData.used=false;return a}function loadTextureRecolor(e,t,a,i,r,n=undefined,o=undefined,s=undefined){var l=document.createElement("canvas");l.width=128;l.height=128;var c=l.getContext("2d");var p=new THREE.Texture(l);var f=new Image;f.src=`data:image/png;base64,${base64Textures[e]}`;f.onload=function(){c.globalCompositeOperation="copy";c.drawImage(f,0,0,l.width,l.height);if(n){c.globalCompositeOperation="source-in";c.fillStyle=n;c.fillRect(0,0,l.width,l.height)}c.globalCompositeOperation="destination-atop";c.fillStyle=o;c.fillRect(0,0,l.width,l.height);p.wrapS=THREE.RepeatWrapping;p.wrapT=THREE.RepeatWrapping;if(t&&a){p.offset.set(t,a)}if(i&&r){p.repeat.set(i,r)}if(s){p.rotation=THREE.MathUtils.degToRad(s)}p.needsUpdate=true};return p}function generateHeight(t,e){let a=Math.PI/4;window.Math.random=function(){const e=Math.sin(a++)*1e4;return e-Math.floor(e)};const i=t*e,r=new Uint8Array(i);const n=new THREE.ImprovedNoise,o=Math.random()*100;let s=1;for(let e=0;e<4;e++){for(let e=0;e<i;e++){const l=e%t,c=~~(e/t);r[e]+=Math.abs(n.noise(l/s,c/s,o)*s*1.75)}s*=5}return r}function makeTerrain(e,t,i,r,a,n,o,s=0,l,c){const p=t,f=i;if(s==0){const g=generateHeight(p,f);var d=new THREE.PlaneGeometry(t,i,p-1,f-1);const h=d.attributes.position.array;d.rotateX(-Math.PI/2);for(let e=0,t=0,a=h.length;e<a;e++,t+=3){h[t+1]=g[e]*r}}else if(s==1){var d=new THREE.BoxGeometry(t,i,c,p-1,f-1,1);d.rotateX(-Math.PI/2);const h=d.attributes.position.array;let a={};for(let t=0;t<h.length-3;t++){let e=`${h[t]}_${h[t+1]}_${h[t+2]}`;if(a[e]){a[e].push(t)}else{a[e]=[t]}}let r=[];for(let e of Object.keys(a)){if(a[e].length>1){r.push(a[e])}}for(let e=0,i=0,t=h.length;e<t;e++,i+=3){let e=false;let a=randFromRange(l);for(let t=0;t<r.length;t++){if(r[t]&&r[t].indexOf(i)>-1){for(let e of r[t]){h[e+1]+=a}e=true}}if(!e){h[i+1]+=randFromRange(l)}}}let u=new THREE.Mesh(d,e);let m=r*100;if(n){u.position.set(n[0]-p/10,n[1]-m,n[2])}if(a){u.scale.set(a[0],a[1],a[2])}if(o){u.rotation.set(THREE.MathUtils.degToRad(o[0]),THREE.MathUtils.degToRad(o[1]),THREE.MathUtils.degToRad(o[2]))}return u}function makeCloud(t,a,i,r,n,o,e,s,l){let c=new THREE.Group;const p=new THREE.SphereGeometry(1,16,16);for(let e=0;e<n;e++){const f=new THREE.Mesh(p,t);const d=Math.random()*a;const u=Math.random()*i;const m=Math.random()*r;f.position.set(d,u,m);let e=randFromRange(o);f.scale.set(e,e,e);c.add(f)}if(s){c.position.set(s[0],s[1],s[2])}if(e){c.scale.set(e[0],e[1],e[2])}if(l){c.rotation.set(THREE.MathUtils.degToRad(l[0]),THREE.MathUtils.degToRad(l[1]),THREE.MathUtils.degToRad(l[2]))}return c}function makeAnimationForQueue(e,t,a,i,r,n=.3){r=r<0?r*-1:r;let o={attribute:e,from:t,current:t,to:a,"final":i,speed:r,counter:0,curve:n};if(e=="color"){t=typeof t==="string"?t:"#"+t.getHex().toString(16);a=Array.isArray(a)?a:[a];o.colorInterpolator=new ColorInterpolator([t].concat(a),r)}return o}function processAnimationQueue(t){if(t.userData.animationQueue==undefined||t.userData.animationQueue.length==0){return}if(!t.userData.animationQueue[0].direction){if(Array.isArray(t.userData.animationQueue[0].from)){t.userData.animationQueue[0].direction=[];for(let e=0;e<t.userData.animationQueue[0].from.length;e++){t.userData.animationQueue[0].direction.push(t.userData.animationQueue[0].from[e]>t.userData.animationQueue[0].to[e]?-1:1)}}else{t.userData.animationQueue[0].direction=t.userData.animationQueue[0].from>t.userData.animationQueue[0].to?-1:1}}let a=t.userData.animationQueue[0];if(a.counter>1e4){t.userData.animationQueue.splice(0,1);return}else{a.counter++}if(a.attribute=="color"){if(t.color){let e=new THREE.Color(a.colorInterpolator.nextColor());t.color=e;if(a.colorInterpolator.looped){t.userData.animationQueue.splice(0,1);return}}else{console.error("Shape has no color attribute")}return}if(Array.isArray(a.from)){for(let e=0;e<a.from.length;e++){if(a.direction[e]==-1&&a.current[e]<=a.to[e]||a.direction[e]==1&&a.current[e]>=a.to[e]){t.userData.animationQueue.splice(0,1);return}if(a.from[e]>a.to[e]){a.current[e]-=a.speed}else{a.current[e]+=a.speed}}}else{if(a.attribute=="scale"){a.current=Math.max(t.scale.x,t.scale.y,t.scale.z)}else if(a.attribute=="rotationSpeed"){a.current=t.userData.rotationSpeed}else if(a.attribute=="distance"){a.current=t.position.x}else if(a.attribute=="x"){a.current=t.position.x}else if(a.attribute=="y"){a.current=t.position.y}else if(a.attribute=="z"){a.current=t.position.z}else if(a.attribute=="near-far"){a.current[0]=t.near;a.current[1]=t.far}else if(a.attribute=="angleX"){a.current=t.rotation.x}else if(a.attribute=="angleY"){a.current=t.rotation.y}else if(a.attribute=="angleZ"){a.current=t.rotation.z}if(a.direction==-1&&a.current<=a.to||a.direction==1&&a.current>=a.to){t.userData.animationQueue.splice(0,1);return}if(a.from>=a.to){a.current-=a.speed}else{a.current+=a.speed}}if(t.userData.name=="camera"){a.current=Number(a.current.toFixed(5))}if(a.attribute=="scale"){if(Array.isArray(a.from)){t.scale.set(a.current[0],a.current[1],a.current[2])}else{t.scale.set(a.current,a.current,a.current)}if(Array.isArray(t.material)){for(let e=0;e<t.material.length;e++){if(t.material[e].map){t.material[e].map.needsUpdate=true}}}else{if(t.material&&t.material.map){t.material.map.needsUpdate=true}}}else if(a.attribute=="rotationSpeed"){t.userData.rotationSpeed=a.current}else if(a.attribute=="distance"){t.position.x=a.current}else if(a.attribute=="x"){t.position.x=a.current}else if(a.attribute=="y"){t.position.y=a.current}else if(a.attribute=="z"){t.position.z=a.current}else if(a.attribute=="near-far"){t.near=a.current[0];t.far=a.current[1]}else if(a.attribute=="angleX"){t.rotation.x=a.current}else if(a.attribute=="angleY"){t.rotation.y=a.current}else if(a.attribute=="angleZ"){t.rotation.z=a.current}}function processAnimationLoop(a){if(a.userData.animationLoop.length==0){return}for(let t of a.userData.animationLoop){if(t.attribute=="color"){if(a.color){let e=new THREE.Color(t.colorInterpolator.nextColor());a.color=e;if(t.colorInterpolator.looped){a.userData.animationQueue.splice(0,1);return}}else{console.error("Shape has no color attribute")}return}if(t.attribute=="scale"){t.current=Math.max(a.scale.x,a.scale.y,a.scale.z)}else if(t.attribute=="rotationSpeed"){t.current=a.userData.rotationSpeed}else if(t.attribute=="distance"){t.current=a.position.x}else if(t.attribute=="x"){t.current=a.position.x}else if(t.attribute=="y"){t.current=a.position.y}else if(t.attribute=="z"){t.current=a.position.z}else if(t.attribute=="near-far"){t.current[0]=a.near;t.current[1]=a.far}else if(t.attribute=="angleX"){t.current=a.rotation.x}else if(t.attribute=="angleY"){t.current=a.rotation.y}else if(t.attribute=="angleZ"){t.current=a.rotation.z}if(t.from>=t.to){t.current-=t.speed}else{t.current+=t.speed}if(t.attribute=="scale"){a.scale.set(t.current,t.current,t.current);if(Array.isArray(a.material)){for(let e=0;e<a.material.length;e++){if(a.material[e].map){a.material[e].map.needsUpdate=true}}}else{if(a.material.map){a.material.map.needsUpdate=true}}}else if(t.attribute=="rotationSpeed"){a.userData.rotationSpeed=t.current}else if(t.attribute=="distance"){a.position.x=t.current}else if(t.attribute=="x"){a.position.x=t.current}else if(t.attribute=="y"){a.position.y=t.current}else if(t.attribute=="z"){a.position.z=t.current}else if(t.attribute=="near-far"){a.near=t.current[0];a.far=t.current[1]}else if(t.attribute=="angleX"){a.rotation.x=t.current}else if(t.attribute=="angleY"){a.rotation.y=t.current}else if(t.attribute=="angleZ"){a.rotation.z=t.current}}}function interpolateColors(e,t,i){const a=e=>[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)];const r=e=>"#"+e.map(e=>Math.round(e).toString(16).padStart(2,"0")).join("");const n=a(e);const o=a(t);const s=n.map((e,t)=>{const a=o[t];return Math.round(e+(a-e)*i)});return r(s)}class ColorInterpolator{constructor(e,t){this.colorsArray=e;this.activePairIndex=[0,1];this.speed=t;this.state=0;this.looped=false}nextColor(){let e=interpolateColors(this.colorsArray[this.activePairIndex[0]],this.colorsArray[this.activePairIndex[1]],this.state);this.state+=this.speed;if(this.state>=1){this.state=0;if(this.activePairIndex[1]>=this.colorsArray.length){this.activePairIndex=this.activePairIndex.map(e=>e+1)}else{this.activePairIndex=[0,1];this.looped=true}}return e}}function createConeGeometry(e,t,o,s,l,a){if(!l){l={}}const i=new THREE.BufferGeometry;let c=[];let r=[];const p=0;const f=e;for(let n=0;n<=s;n++){const h=n/s*t;const E=f+h/t*(p-f);for(let r=0;r<=o;r++){let t=h;let e=r/o*Math.PI*2;let a=E*Math.cos(e);let i=E*Math.sin(e);if(l.curveBaseCone){let e=(s-n)*l.baseCurveFactor;t-=Math.abs(Math.pow(a,2))*e}c.push(a,t,i)}}for(let t=0;t<s;t++){for(let e=0;e<o;e++){const S=t*(o+1)+e;const b=S+o+1;if(e==0){var n=S;var d=b}if(e<o-1){r.push(S,b,S+1);r.push(b,b+1,S+1)}else{r.push(S,b,n);r.push(b,d,n)}}}let u=0;let m=100;let g=0;for(let e=2;e<o*3;e+=3){g++;if(c[e]<u){u=g;m=c[e]}}c.indexOf(Math.min(c.slice(0,o)));if(!a){c=c.slice(0,o*3).concat(c);r=r.map(e=>e+o);let t=Math.abs(o/2);if(l.curveBaseCone){r=r.concat(vertexIndexSequence(o))}else{for(let e=0;e<t;e+=1){r.push(e,e+1,t);r.push(e+t,e+t+1,t)}}}i.setAttribute("position",new THREE.Float32BufferAttribute(c,3));i.deleteAttribute("normal");i.deleteAttribute("uv");i.setIndex(r);i.computeVertexNormals();return i}function makeCone(e,t,a,i,r,n,o,s,l,c){const p=createConeGeometry(t,a,i,r,c,n);const f=new THREE.ConeGeometry(t,a,i,r);p.setAttribute("uv",f.getAttribute("uv"));p.uvsNeedUpdate=true;p.normalsNeedUpdate=true;const d=new THREE.Mesh(p,e);if(s){d.position.set(s[0],s[1],s[2])}if(o){d.scale.set(o[0],o[1],o[2])}if(l){d.rotation.set(THREE.MathUtils.degToRad(l[0]*2),THREE.MathUtils.degToRad(l[1]),THREE.MathUtils.degToRad(l[2]))}if(enableShadows){d.castShadow=true;d.receiveShadow=true}d.userData.material=e;return d}function meanPositionOfPivots(e){let t=e.map(e=>e.position.x);t=t.reduce((e,t)=>e+t,0)/t.length;let a=e.map(e=>e.position.y);a=a.reduce((e,t)=>e+t,0)/a.length;let i=e.map(e=>e.position.z);i=i.reduce((e,t)=>e+t,0)/i.length;return[t,a,i]}function meanRotationOfPivots(e){let t=e.map(e=>e.rotation.x);t=t.reduce((e,t)=>e+t,0)/t.length;let a=e.map(e=>e.rotation.y);a=a.reduce((e,t)=>e+t,0)/a.length;let i=e.map(e=>e.rotation.z);i=i.reduce((e,t)=>e+t,0)/i.length;return[t,a,i]}function createNegativeSpace(a,e=undefined,t=true,i=0,r=0){a.creatingNegativeSpace=true;setTimeout(()=>{a.creatingNegativeSpace=false},3e4);let n=randFromRange(a.negativeSpaceX);let o=randFromRange(a.negativeSpaceY);let s=randFromRange(a.negativeSpaceZ);let l=randFromRange(a.negativeSpaceSizeX);let c=randFromRange(a.negativeSpaceSizeY);let p=randFromRange(a.negativeSpaceSizeZ);if(e==undefined){e=pick(a.negativeSpaceType)}let f=undefined;if(e=="triangle"){f=[new THREE.Plane(new THREE.Vector3(1,.5,0),0),new THREE.Plane(new THREE.Vector3(-1,.5,0),0),new THREE.Plane(new THREE.Vector3(0,-1,0),0),new THREE.Plane(new THREE.Vector3(0,0,-1),0),new THREE.Plane(new THREE.Vector3(0,0,1),0)];f[0].translate(new THREE.Vector3(l+n,0,0));f[1].translate(new THREE.Vector3(-l+n,0,0));f[2].translate(new THREE.Vector3(0,-c+o,0));f[3].translate(new THREE.Vector3(0,0,-p+s));f[4].translate(new THREE.Vector3(0,0,p+s))}else if(e=="triangle_flip"){f=[new THREE.Plane(new THREE.Vector3(1,-.5,0),0),new THREE.Plane(new THREE.Vector3(-1,-.5,0),0),new THREE.Plane(new THREE.Vector3(0,1,0),0),new THREE.Plane(new THREE.Vector3(0,0,-1),0),new THREE.Plane(new THREE.Vector3(0,0,1),0)];f[0].translate(new THREE.Vector3(l+n,0,0));f[1].translate(new THREE.Vector3(-l+n,0,0));f[2].translate(new THREE.Vector3(0,c+o,0));f[3].translate(new THREE.Vector3(0,0,-p+s));f[4].translate(new THREE.Vector3(0,0,p+s))}else if(e=="diamond"){f=[new THREE.Plane(new THREE.Vector3(1,-.5,0),0),new THREE.Plane(new THREE.Vector3(-1,.5,0),0),new THREE.Plane(new THREE.Vector3(.5,-1,0),0),new THREE.Plane(new THREE.Vector3(-.5,1,0),0),new THREE.Plane(new THREE.Vector3(0,0,-1),0),new THREE.Plane(new THREE.Vector3(0,0,1),0)];f[0].translate(new THREE.Vector3(l+n,0,0));f[1].translate(new THREE.Vector3(-l+n,0,0));f[2].translate(new THREE.Vector3(0,-c+o,0));f[3].translate(new THREE.Vector3(0,c+o,0));f[4].translate(new THREE.Vector3(0,0,-p+s));f[5].translate(new THREE.Vector3(0,0,p+s));var d=new THREE.Quaternion;d.setFromAxisAngle(new THREE.Vector3(0,0,1),THREE.MathUtils.degToRad(r));f[0].normal.applyQuaternion(d);f[1].normal.applyQuaternion(d);f[2].normal.applyQuaternion(d);f[3].normal.applyQuaternion(d)}let u=e=="triangle"?3:4;for(let e=0;e<u;e++){f[e].userData={originalConstant:f[e].constant,currentConstrain:t?5:f[e].constant,desiredConstant:f[e].constant};if(t){f[e].constant=5}}a.clipPlanes=f;nShapesLeftOutside=0;if(a.pivots){for(let e of a.pivots){if(nShapesLeftOutside<i&&rand(0,1,.01)>.5){nShapesLeftOutside++;continue}for(let t of e.children){if(t.material){t.material.clippingPlanes=a.clipPlanes;t.material.clipIntersection=true}for(let e of t.children){if(e.material){e.material.clippingPlanes=a.clipPlanes;e.material.clipIntersection=true}}}}}console.log(nShapesLeftOutside,"objects left outside of negative space on axis",a.name)}function removeNegativeSpace(t){t.removingNegativeSpace=true;for(let e=0;e<t.clipPlanes.length;e++){if(t.clipPlanes[e].userData){t.clipPlanes[e].userData.desiredConstant=5}}setTimeout(()=>{if(t.pivots){for(let e of t.pivots){for(let t of e.children){if(t.material){t.material.clippingPlanes=[];t.material.needsUpdate=true}for(let e of t.children){if(e.material){e.material.clippingPlanes=[];e.material.needsUpdate=true}}}}}for(let e=0;e<t.clipPlanes.length;e++){SCENE.scene.remove(t.clipPlanes[e])}t.clipPlanes=undefined;delete t.clipPlanes;t.removingNegativeSpace=false},2e4)}function initOBJLoader(){const _=/^[og]\s*(.+)?/;const H=/^mtllib /;const X=/^usemtl /;const Y=/^usemap /;const j=/\s+/;const n=new THREE.Vector3;const o=new THREE.Vector3;const s=new THREE.Vector3;const l=new THREE.Vector3;const c=new THREE.Vector3;const Z=new THREE.Color;function z(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===false){this.object.name=e;this.object.fromDeclaration=t!==false;return}const a=this.object&&typeof this.object.currentMaterial==="function"?this.object.currentMaterial():undefined;if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}this.object={name:e||"",fromDeclaration:t!==false,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:false},materials:[],smooth:true,startMaterial:function(e,t){const a=this._finalize(false);if(a&&(a.inherited||a.groupCount<=0)){this.materials.splice(a.index,1)}const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:a!==undefined?a.smooth:this.smooth,groupStart:a!==undefined?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:false,clone:function(e){const t={index:typeof e==="number"?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:false};t.clone=this.clone.bind(t);return t}};this.materials.push(i);return i},currentMaterial:function(){if(this.materials.length>0){return this.materials[this.materials.length-1]}return undefined},_finalize:function(e){const t=this.currentMaterial();if(t&&t.groupEnd===-1){t.groupEnd=this.geometry.vertices.length/3;t.groupCount=t.groupEnd-t.groupStart;t.inherited=false}if(e&&this.materials.length>1){for(let e=this.materials.length-1;e>=0;e--){if(this.materials[e].groupCount<=0){this.materials.splice(e,1)}}}if(e&&this.materials.length===0){this.materials.push({name:"",smooth:this.smooth})}return t}};if(a&&a.name&&typeof a.clone==="function"){const i=a.clone(0);i.inherited=true;this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}},parseVertexIndex:function(e,t){const a=parseInt(e,10);return(a>=0?a-1:a+t/3)*3},parseNormalIndex:function(e,t){const a=parseInt(e,10);return(a>=0?a-1:a+t/3)*3},parseUVIndex:function(e,t){const a=parseInt(e,10);return(a>=0?a-1:a+t/2)*2},addVertex:function(e,t,a){const i=this.vertices;const r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]);r.push(i[t+0],i[t+1],i[t+2]);r.push(i[a+0],i[a+1],i[a+2])},addVertexPoint:function(e){const t=this.vertices;const a=this.object.geometry.vertices;a.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;const a=this.object.geometry.vertices;a.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,a){const i=this.normals;const r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]);r.push(i[t+0],i[t+1],i[t+2]);r.push(i[a+0],i[a+1],i[a+2])},addFaceNormal:function(e,t,a){const i=this.vertices;const r=this.object.geometry.normals;n.fromArray(i,e);o.fromArray(i,t);s.fromArray(i,a);c.subVectors(s,o);l.subVectors(n,o);c.cross(l);c.normalize();r.push(c.x,c.y,c.z);r.push(c.x,c.y,c.z);r.push(c.x,c.y,c.z)},addColor:function(e,t,a){const i=this.colors;const r=this.object.geometry.colors;if(i[e]!==undefined)r.push(i[e+0],i[e+1],i[e+2]);if(i[t]!==undefined)r.push(i[t+0],i[t+1],i[t+2]);if(i[a]!==undefined)r.push(i[a+0],i[a+1],i[a+2])},addUV:function(e,t,a){const i=this.uvs;const r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]);r.push(i[t+0],i[t+1]);r.push(i[a+0],i[a+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0);e.push(0,0);e.push(0,0)},addUVLine:function(e){const t=this.uvs;const a=this.object.geometry.uvs;a.push(t[e+0],t[e+1])},addFace:function(e,t,a,i,r,n,o,s,l){const c=this.vertices.length;let p=this.parseVertexIndex(e,c);let f=this.parseVertexIndex(t,c);let d=this.parseVertexIndex(a,c);this.addVertex(p,f,d);this.addColor(p,f,d);if(o!==undefined&&o!==""){const u=this.normals.length;p=this.parseNormalIndex(o,u);f=this.parseNormalIndex(s,u);d=this.parseNormalIndex(l,u);this.addNormal(p,f,d)}else{this.addFaceNormal(p,f,d)}if(i!==undefined&&i!==""){const m=this.uvs.length;p=this.parseUVIndex(i,m);f=this.parseUVIndex(r,m);d=this.parseUVIndex(n,m);this.addUV(p,f,d);this.object.geometry.hasUVIndices=true}else{this.addDefaultUV()}},addPointGeometry:function(a){this.object.geometry.type="Points";const i=this.vertices.length;for(let e=0,t=a.length;e<t;e++){const r=this.parseVertexIndex(a[e],i);this.addVertexPoint(r);this.addColor(r)}},addLineGeometry:function(a,i){this.object.geometry.type="Line";const r=this.vertices.length;const n=this.uvs.length;for(let e=0,t=a.length;e<t;e++){this.addVertexLine(this.parseVertexIndex(a[e],r))}for(let e=0,t=i.length;e<t;e++){this.addUVLine(this.parseUVIndex(i[e],n))}}};e.startObject("",false);return e}class e extends THREE.Loader{constructor(e){super(e);this.materials=null}load(a,i,e,r){const n=this;const t=new THREE.FileLoader(this.manager);t.setPath(this.path);t.setRequestHeader(this.requestHeader);t.setWithCredentials(this.withCredentials);t.load(a,function(e){try{i(n.parse(e))}catch(t){if(r){r(t)}else{console.error(t)}n.manager.itemError(a)}},e,r)}setMaterials(e){this.materials=e;return this}parse(e){const i=new z;if(e.indexOf("\r\n")!==-1){e=e.replace(/\r\n/g,"\n")}if(e.indexOf("\\\n")!==-1){e=e.replace(/\\\n/g,"")}const a=e.split("\n");let r=[];for(let e=0,t=a.length;e<t;e++){const o=a[e].trimStart();if(o.length===0)continue;const s=o.charAt(0);if(s==="#")continue;if(s==="v"){const l=o.split(j);switch(l[0]){case"v":i.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));if(l.length>=7){Z.setRGB(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6])).convertSRGBToLinear();i.colors.push(Z.r,Z.g,Z.b)}else{i.colors.push(undefined,undefined,undefined)}break;case"vn":i.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":i.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(s==="f"){const c=o.slice(1).trim();const p=c.split(j);const f=[];for(let e=0,t=p.length;e<t;e++){const u=p[e];if(u.length>0){const m=u.split("/");f.push(m)}}const d=f[0];for(let e=1,t=f.length-1;e<t;e++){const g=f[e];const h=f[e+1];i.addFace(d[0],g[0],h[0],d[1],g[1],h[1],d[2],g[2],h[2])}}else if(s==="l"){const E=o.substring(1).trim().split(" ");let a=[];const S=[];if(o.indexOf("/")===-1){a=E}else{for(let e=0,t=E.length;e<t;e++){const b=E[e].split("/");if(b[0]!=="")a.push(b[0]);if(b[1]!=="")S.push(b[1])}}i.addLineGeometry(a,S)}else if(s==="p"){const c=o.slice(1).trim();const v=c.split(" ");i.addPointGeometry(v)}else if((r=_.exec(o))!==null){const x=(" "+r[0].slice(1).trim()).slice(1);i.startObject(x)}else if(X.test(o)){i.object.startMaterial(o.substring(7).trim(),i.materialLibraries)}else if(H.test(o)){i.materialLibraries.push(o.substring(7).trim())}else if(Y.test(o)){console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.')}else if(s==="s"){r=o.split(" ");if(r.length>1){const y=r[1].trim().toLowerCase();i.object.smooth=y!=="0"&&y!=="off"}else{i.object.smooth=true}const T=i.object.currentMaterial();if(T)T.smooth=i.object.smooth}else{if(o==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+o+'"')}}i.finalize();const n=new THREE.Group;n.materialLibraries=[].concat(i.materialLibraries);const t=!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0);if(t===true){for(let t=0,e=i.objects.length;t<e;t++){const A=i.objects[t];const R=A.geometry;const C=A.materials;const w=R.type==="Line";const D=R.type==="Points";let a=false;if(R.vertices.length===0)continue;const N=new THREE.BufferGeometry;N.setAttribute("position",new THREE.Float32BufferAttribute(R.vertices,3));if(R.normals.length>0){N.setAttribute("normal",new THREE.Float32BufferAttribute(R.normals,3))}if(R.colors.length>0){a=true;N.setAttribute("color",new THREE.Float32BufferAttribute(R.colors,3))}if(R.hasUVIndices===true){N.setAttribute("uv",new THREE.Float32BufferAttribute(R.uvs,2))}const M=[];for(let t=0,e=C.length;t<e;t++){const P=C[t];const O=P.name+"_"+P.smooth+"_"+a;let e=i.materials[O];if(this.materials!==null){e=this.materials.create(P.name);if(w&&e&&!(e instanceof THREE.LineBasicMaterial)){const F=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(F,e);F.color.copy(e.color);e=F}else if(D&&e&&!(e instanceof THREE.PointsMaterial)){const U=new THREE.PointsMaterial({size:10,sizeAttenuation:false});THREE.Material.prototype.copy.call(U,e);U.color.copy(e.color);U.map=e.map;e=U}}if(e===undefined){if(w){e=new THREE.LineBasicMaterial}else if(D){e=new THREE.PointsMaterial({size:1,sizeAttenuation:false})}else{e=new THREE.MeshPhongMaterial({color:"#000000"})}e.name=P.name;e.flatShading=P.smooth?false:true;e.vertexColors=a;i.materials[O]=e}M.push(e)}let e;if(M.length>1){for(let e=0,t=C.length;e<t;e++){const P=C[e];N.addGroup(P.groupStart,P.groupCount,e)}if(w){e=new THREE.LineSegments(N,M)}else if(D){e=new THREE.Points(N,M)}else{e=new THREE.Mesh(N,M)}}else{if(w){e=new THREE.LineSegments(N,M[0])}else if(D){e=new THREE.Points(N,M[0])}else{e=new THREE.Mesh(N,M[0])}}e.name=A.name;n.add(e)}}else{if(i.vertices.length>0){const T=new THREE.PointsMaterial({size:1,sizeAttenuation:false});const N=new THREE.BufferGeometry;N.setAttribute("position",new THREE.Float32BufferAttribute(i.vertices,3));if(i.colors.length>0&&i.colors[0]!==undefined){N.setAttribute("color",new THREE.Float32BufferAttribute(i.colors,3));T.vertexColors=true}const k=new THREE.Points(N,T);n.add(k)}}return n}}THREE.OBJLoader=e}function initImprovedNoise(){const x=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let e=0;e<256;e++){x[256+e]=x[e]}function T(e){return e*e*e*(e*(e*6-15)+10)}function y(e,t,a){return t+e*(a-t)}function A(e,t,a,i){const r=e&15;const n=r<8?t:a,o=r<4?a:r==12||r==14?t:i;return((r&1)==0?n:-n)+((r&2)==0?o:-o)}class e{noise(e,t,a){const i=Math.floor(e),r=Math.floor(t),n=Math.floor(a);const o=i&255,s=r&255,l=n&255;e-=i;t-=r;a-=n;const c=e-1,p=t-1,f=a-1;const d=T(e),u=T(t),m=T(a);const g=x[o]+s,h=x[g]+l,E=x[g+1]+l,S=x[o+1]+s,b=x[S]+l,v=x[S+1]+l;return y(m,y(u,y(d,A(x[h],e,t,a),A(x[b],c,t,a)),y(d,A(x[E],e,p,a),A(x[v],c,p,a))),y(u,y(d,A(x[h+1],e,t,f),A(x[b+1],c,t,f)),y(d,A(x[E+1],e,p,f),A(x[v+1],c,p,f))))}}THREE.ImprovedNoise=e}function stringToHexadecimal(t){let a="";for(let e=0;e<t.length;e++){const i=t.charCodeAt(e).toString(16);a+=("00"+i).slice(-2)}return a}async function callProvider(e){callPayload={method:"POST",body:JSON.stringify(e)};let a;for(let t=0;t<NODE_PROVIDER_URLS.length;t++){for(let e=0;e<2;e++){try{a=await fetch(NODE_PROVIDER_URLS[t],callPayload);if(a.ok){let e=await a.json();return e}else{console.error(a)}}catch(i){console.warn("Failed node provider URL:",NODE_PROVIDER_URLS[t]);await new Promise(e=>setTimeout(e,2e3));console.log("Retrying")}}}}async function getLastBlockReceipts(t){let e=await callProvider({method:"eth_blockNumber",params:[],id:2,jsonrpc:"2.0"});let a=await callProvider({method:"eth_getBlockReceipts",params:[e.result],id:2,jsonrpc:"2.0"});for(let e of a.result){if(t=="ANYWALLET"){const i=JSON.stringify(e,null,2);return i}if(t.indexOf(e.from)>-1||t.indexOf(e.to)>-1){const i=JSON.stringify(e,null,2);return i}}}async function receiptsWrapper(){try{await getLastBlockReceipts()}catch(e){console.error(e)}}async function getContractData(){for(let t=0;t<NODE_PROVIDER_URLS.length;t++){for(let e=0;e<2;e++){try{var a=await fetch(NODE_PROVIDER_URLS[t],{method:"POST",body:JSON.stringify({method:"eth_call",params:[{to:contractAddress,data:jsonRpcCallDataContract},"latest"],id:2,jsonrpc:"2.0"})});if(a.ok){let e=await a.json();let t=hexToArray(e.result);try{t=splitArray(t,[1,200,1,200,1,400,400,1,300])}catch(i){console.error(i);t=splitArray(t,[1,200,1,200,1,400,400,1])}console.debug("contract_data:",t);return t}else{console.error(a)}}catch(i){console.log("Node failed:",NODE_PROVIDER_URLS[t]);await new Promise(e=>setTimeout(e,2e3));console.log("Retrying...")}}}}function hexToUnicode(e){let t=e.match(/.{1,2}/g)||[];let a=t.map(e=>String.fromCharCode(parseInt(e,16)));let i=a.join("");return i.replace(/\u0000/g,"")}function hexToArray(e){const t=e.slice(2);const a=[];for(let e=0;e<t.length;e+=64){if(e>=77200){const i=hexToUnicode(t.slice(e,e+128),16);if(i.length>=37&&i[0]==0){a.push(i)}}else{const r=parseInt(t.slice(e,e+64),16);a.push(r)}}return a}function splitArray(t,a){const i=[];let r=0;for(let e=0;e<a.length;e++){const n=a[e];const o=t.slice(r,r+n);i.push(o);r+=n}if(r<t.length){const e=t.slice(r);i.push(e)}return i}function getCurrentTs(){return(new Date).getTime()/1e3}function generateUUID(){return"xyxxyxxxyxxyxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e=="x"?t:t&3|8;return a.toString(16)})}