////////////////////////////////////////////////////////////////////////////////////////
const LIVE_MODE=true;if(!LIVE_MODE){tokenHash=(new Date).getTime();traitsPalette=undefined;traitsObjects=undefined}const placeholderSalePrice=3e17;const placeholderRoyaltyReceived=5e14;{var MersenneTwister=function(e){if(e==undefined){e=(new Date).getTime()}this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=new Array(this.N);this.mti=this.N+1;if(e.constructor==Array){this.init_by_array(e,e.length)}else{this.init_seed(e)}};MersenneTwister.prototype.init_seed=function(e){this.mt[0]=e>>>0;for(this.mti=1;this.mti<this.N;this.mti++){var e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti;this.mt[this.mti]>>>=0}};MersenneTwister.prototype.init_by_array=function(e,t){var a,n,i;this.init_seed(19650218);a=1;n=0;i=this.N>t?this.N:t;for(;i;i--){var r=this.mt[a-1]^this.mt[a-1]>>>30;this.mt[a]=(this.mt[a]^(((r&4294901760)>>>16)*1664525<<16)+(r&65535)*1664525)+e[n]+n;this.mt[a]>>>=0;a++;n++;if(a>=this.N){this.mt[0]=this.mt[this.N-1];a=1}if(n>=t)n=0}for(i=this.N-1;i;i--){var r=this.mt[a-1]^this.mt[a-1]>>>30;this.mt[a]=(this.mt[a]^(((r&4294901760)>>>16)*1566083941<<16)+(r&65535)*1566083941)-a;this.mt[a]>>>=0;a++;if(a>=this.N){this.mt[0]=this.mt[this.N-1];a=1}}this.mt[0]=2147483648};MersenneTwister.prototype.random_int=function(){var e;var t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var a;if(this.mti==this.N+1)this.init_seed(5489);for(a=0;a<this.N-this.M;a++){e=this.mt[a]&this.UPPER_MASK|this.mt[a+1]&this.LOWER_MASK;this.mt[a]=this.mt[a+this.M]^e>>>1^t[e&1]}for(;a<this.N-1;a++){e=this.mt[a]&this.UPPER_MASK|this.mt[a+1]&this.LOWER_MASK;this.mt[a]=this.mt[a+(this.M-this.N)]^e>>>1^t[e&1]}e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1];this.mti=0}e=this.mt[this.mti++];e^=e>>>11;e^=e<<7&2636928640;e^=e<<15&4022730752;e^=e>>>18;return e>>>0};MersenneTwister.prototype.random_int31=function(){return this.random_int()>>>1};MersenneTwister.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};MersenneTwister.prototype.random=function(){return this.random_int()*(1/4294967296)};MersenneTwister.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};MersenneTwister.prototype.random_long=function(){var e=this.random_int()>>>5,t=this.random_int()>>>6;return(e*67108864+t)*(1/9007199254740992)}}(function(e){var t=e.noise={};function a(e,t,a){this.x=e;this.y=t;this.z=a}a.prototype.dot2=function(e,t){return this.x*e+this.y*t};a.prototype.dot3=function(e,t,a){return this.x*e+this.y*t+this.z*a};var n=[new a(1,1,0),new a(-1,1,0),new a(1,-1,0),new a(-1,-1,0),new a(1,0,1),new a(-1,0,1),new a(1,0,-1),new a(-1,0,-1),new a(0,1,1),new a(0,-1,1),new a(0,1,-1),new a(0,-1,-1)];var i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var j=new Array(512);var I=new Array(512);t.seed=function(e){if(e>0&&e<1){e*=65536}e=Math.floor(e);if(e<256){e|=e<<8}for(var t=0;t<256;t++){var a;if(t&1){a=i[t]^e&255}else{a=i[t]^e>>8&255}j[t]=j[t+256]=a;I[t]=I[t+256]=n[a%12]}};t.seed(0);var A=.5*(Math.sqrt(3)-1);var R=(3-Math.sqrt(3))/6;var L=1/3;var Q=1/6;t.simplex2=function(e,t){var a,n,i;var r=(e+t)*A;var o=Math.floor(e+r);var s=Math.floor(t+r);var l=(o+s)*R;var c=e-o+l;var d=t-s+l;var u,p;if(c>d){u=1;p=0}else{u=0;p=1}var f=c-u+R;var m=d-p+R;var h=c-1+2*R;var E=d-1+2*R;o&=255;s&=255;var g=I[o+j[s]];var S=I[o+u+j[s+p]];var T=I[o+1+j[s+1]];var v=.5-c*c-d*d;if(v<0){a=0}else{v*=v;a=v*v*g.dot2(c,d)}var x=.5-f*f-m*m;if(x<0){n=0}else{x*=x;n=x*x*S.dot2(f,m)}var D=.5-h*h-E*E;if(D<0){i=0}else{D*=D;i=D*D*T.dot2(h,E)}return 70*(a+n+i)};t.simplex3=function(e,t,a){var n,i,r,o;var s=(e+t+a)*L;var l=Math.floor(e+s);var c=Math.floor(t+s);var d=Math.floor(a+s);var u=(l+c+d)*Q;var p=e-l+u;var f=t-c+u;var m=a-d+u;var h,E,g;var S,T,v;if(p>=f){if(f>=m){h=1;E=0;g=0;S=1;T=1;v=0}else if(p>=m){h=1;E=0;g=0;S=1;T=0;v=1}else{h=0;E=0;g=1;S=1;T=0;v=1}}else{if(f<m){h=0;E=0;g=1;S=0;T=1;v=1}else if(p<m){h=0;E=1;g=0;S=0;T=1;v=1}else{h=0;E=1;g=0;S=1;T=1;v=0}}var x=p-h+Q;var D=f-E+Q;var A=m-g+Q;var R=p-S+2*Q;var b=f-T+2*Q;var N=m-v+2*Q;var C=p-1+3*Q;var y=f-1+3*Q;var w=m-1+3*Q;l&=255;c&=255;d&=255;var P=I[l+j[c+j[d]]];var M=I[l+h+j[c+E+j[d+g]]];var _=I[l+S+j[c+T+j[d+v]]];var F=I[l+1+j[c+1+j[d+1]]];var O=.6-p*p-f*f-m*m;if(O<0){n=0}else{O*=O;n=O*O*P.dot3(p,f,m)}var U=.6-x*x-D*D-A*A;if(U<0){i=0}else{U*=U;i=U*U*M.dot3(x,D,A)}var k=.6-R*R-b*b-N*N;if(k<0){r=0}else{k*=k;r=k*k*_.dot3(R,b,N)}var H=.6-C*C-y*y-w*w;if(H<0){o=0}else{H*=H;o=H*H*F.dot3(C,y,w)}return 32*(n+i+r+o)};function g(e){return e*e*e*(e*(e*6-15)+10)}function S(e,t,a){return(1-a)*e+a*t}t.perlin2=function(e,t){var a=Math.floor(e),n=Math.floor(t);e=e-a;t=t-n;a=a&255;n=n&255;var i=I[a+j[n]].dot2(e,t);var r=I[a+j[n+1]].dot2(e,t-1);var o=I[a+1+j[n]].dot2(e-1,t);var s=I[a+1+j[n+1]].dot2(e-1,t-1);var l=g(e);return S(S(i,o,l),S(r,s,l),g(t))};t.perlin3=function(e,t,a){var n=Math.floor(e),i=Math.floor(t),r=Math.floor(a);e=e-n;t=t-i;a=a-r;n=n&255;i=i&255;r=r&255;var o=I[n+j[i+j[r]]].dot3(e,t,a);var s=I[n+j[i+j[r+1]]].dot3(e,t,a-1);var l=I[n+j[i+1+j[r]]].dot3(e,t-1,a);var c=I[n+j[i+1+j[r+1]]].dot3(e,t-1,a-1);var d=I[n+1+j[i+j[r]]].dot3(e-1,t,a);var u=I[n+1+j[i+j[r+1]]].dot3(e-1,t,a-1);var p=I[n+1+j[i+1+j[r]]].dot3(e-1,t-1,a);var f=I[n+1+j[i+1+j[r+1]]].dot3(e-1,t-1,a-1);var m=g(e);var h=g(t);var E=g(a);return S(S(S(o,d,m),S(s,u,m),E),S(S(l,p,m),S(c,f,m),E),h)}})(this);function average_delta_array(t){let a=0;for(let e=1;e<t.length;e++){a+=Math.abs(t[e]-t[e-1])}return a/(t.length-1)}function map_scale(t,a,n){if(n<=t[0]){return a[0]}if(n>=t[t.length-1]){return a[a.length-1]}for(let e=0;e<a.length-1;e++){if(n>=t[e]&n<t[e+1]){return a[e]}}}function delta_gap(e,t){let a=average_delta_array(t);let n=e-t[t.length-1];let i=a/n-1;if(i===undefined||i===null||isNaN(i)){return 0}else{return i}}let adjust_tier=(e,t)=>{if(t==0){return t}let a=t<0?-1:1;t=Math.abs(t);if(e>=0){t-=1}if(e>=1){t-=2}if(e>=2){t-=3}t=Math.max(0,t)*a;return t==-0?0:t};function getTier(e,t,a=undefined){if(e.length==0){return 0}if(e.length==1){e=[t].concat(e)}let n=e.sort();let i=0;for(let e=1;e<n.length;e++){i+=Math.abs(n[e]-n[e-1])}let=avgGap=i/(n.length-1);let r=t-n[n.length-1];let o=r/avgGap;let s=Math.ceil(3-o);if(a!=undefined){if(s<0){s=0}else if(a<0){s*=-1}else if(a==0){s=0}}if(s==-4){s=-2}else if(s==-5){s=-1}else if(s<-5){s=0}if(s==-0){s=0}console.log("avgGap:",avgGap,"currentGap:",r,"ratio:",o,"tier:",s);return s}function calculateTiers(e){if(!e){console.warn("No data");return}let t={royalty:[[-.4,-.3,-.1,0,.1,.3,.6],[-3,-2,-1,0,1,2,3]],contract_activity:[[-1,-.5,-.25,0,.25,.5,.75],[-3,-2,-1,0,1,2,3]],clustering_mode:[[-1,-.5,-.25,0,.25,.5,.75],[-3,-2,-1,0,1,2,3]],approvals:[[-1,-.5,-.25,0,.25,.5,.75],[-3,-2,-1,0,1,2,3]]};let n=(new Date).getTime()/1e3;let i=e[1].filter((e,t)=>e>0);let r=e[3].filter((e,t)=>e>0);let a=e[5];let o=e[6];let s=a.concat(o);let l=s.filter((e,t)=>t%2===0&&e>0);let c=s.filter((e,t)=>t%2!==0&&e>0);r=[...new Set(r)];i=[...new Set(i)];l=[...new Set(l)];r.sort();i.sort();l.sort();if(SCENE.data.memory==undefined){try{let a=n-memoryLookbackPeriod;SCENE.data.memory=r.filter((e,t)=>e>=a).length+i.filter((e,t)=>e>=a).length+l.filter((e,t)=>e>=a).length;SCENE.data.memory=Math.min(SCENE.data.memory,11)}catch(A){console.warn(A)}}if(resetTimestamp){console.log("Resetting to",resetTimestamp);r=r.filter(e=>e>resetTimestamp);i=i.filter(e=>e>resetTimestamp);l=l.filter(e=>e>resetTimestamp)}let d=Array.from(i);let u=Array.from(l);let p=Array.from(r);let f=Array.from(c);if(r.length<=1){p=[contractMintTimestamp].concat(r)}if(i.length<=1){d=[contractMintTimestamp].concat(i)}if(l.length<=1){u=[contractMintTimestamp].concat(l)}if(c.length<=1){f=[placeholderRoyaltyReceived].concat(c)}try{r=r.slice(-4)}catch{}try{i=i.slice(-4)}catch{}try{l=l.slice(-4)}catch{}if(resetTimestamp){console.log("Resetting to",resetTimestamp);r=r.filter(e=>e>resetTimestamp);i=i.filter(e=>e>resetTimestamp);l=l.filter(e=>e>resetTimestamp)}let m=0;if(f.length>1){m=f[f.length-1]/(f.slice(0,-1).reduce((e,t)=>e+t)/(f.length-1))-1}let h=getTier(r,n);let E=getTier(i,n);let g=getTier(r.concat(i).sort().slice(-4),n);let S=getTier(l,n,m);let T=S!=0;let v=g!=0;let x=h!=0;let D=E!=0;if(SCENE.data.contract.tiers&&Object.keys(SCENE.data.contract.tiers).length>0){T=SCENE.data.contract.tiers.royalty_received_tier.value!=S;v=SCENE.data.contract.tiers.contract_activity_tier.value!=g;x=SCENE.data.contract.tiers.sends_tier.value!=h;D=SCENE.data.contract.tiers.approvals_tier.value!=E}SCENE.data.contract.tiers={royalty_received_tier:{value:S,changed:T},contract_activity_tier:{value:g,changed:v},sends_tier:{value:h,changed:x},approvals_tier:{value:E,changed:D}}}function calculateContractDataUpdates(){if(!SCENE.data.contractUpdates){SCENE.data.contractUpdates={}}SCENE.data.firstContractDataUpdate=true;if(!SCENE.data.contractPrev||!(SCENE.data.contractPrev.length||SCENE.data.contractPrev.size)){SCENE.data.contractUpdates.approvalCount=true;SCENE.data.contractUpdates.transferCount=true;SCENE.data.contractUpdates.holderCount=true;SCENE.data.contractUpdates.royalty=true;return}SCENE.data.firstContractDataUpdate=false;SCENE.data.contractUpdates.approvalCount=SCENE.data.contractPrev[0][0]!=SCENE.data.contract[0][0];SCENE.data.contractUpdates.transferCount=SCENE.data.contractPrev[2][0]!=SCENE.data.contract[2][0];SCENE.data.contractUpdates.holderCount=SCENE.data.contractPrev[4][0]!=SCENE.data.contract[4][0];try{SCENE.data.contractUpdates.royalty=SCENE.data.contractPrev[5].slice(SCENE.data.contractPrev[5].length-2,SCENE.data.contractPrev[5].length-1).pop()!=SCENE.data.contract[5].slice(SCENE.data.contract[5].length-2,SCENE.data.contract[5].length-1).pop()||SCENE.data.contractPrev[6].slice(SCENE.data.contractPrev[6].length-2,SCENE.data.contractPrev[6].length-1).pop()!=SCENE.data.contract[5].slice(SCENE.data.contract[6].length-2,SCENE.data.contract[6].length-1).pop()}catch{}}function tierToValue(e,t){let a=[-3,-2,-1,0,1,2,3];let n=a.indexOf(t);return e[n]}var randomNumberGenerator=new MersenneTwister((new Date).getTime());var randomNumberGeneratorSeeded=new MersenneTwister(hashString(`${tokenHash}`));traitsSeed=Math.floor(123456789*randomNumberGeneratorSeeded.random());traitsIncrement=Math.floor(12345*randomNumberGeneratorSeeded.random());function sizeOfMapping(e){return Object.keys(e).length}function makeGradientPlane(e,t,a,n,i){const r=document.createElement("canvas");r.width=256;r.height=256;const o=r.getContext("2d");if(a=="linear"){var s=o.createLinearGradient(0,0,0,r.height)}else if(a=="radial"){var s=o.createRadialGradient(r.width/2,r.height/2,0,r.width/2,r.height/2,r.width/2)}for(let e of n){s.addColorStop(e[0],e[1])}o.fillStyle=s;o.fillRect(0,0,r.width,r.height);const l=new THREE.CanvasTexture(r);const c=new THREE.PlaneGeometry(e,t);const d=new THREE.MeshBasicMaterial({map:l,fog:i});const u=new THREE.Mesh(c,d);return u}function makePerlinTexture(e,t,n,i,r,o,s,l,c="perlin3"){const a=document.createElement("canvas");a.setAttribute("id","canvas1");a.width=e;a.height=t;const d=a.getContext("2d");if(s){var u=document.createElement("canvas");u.width=e;u.height=t;var p=u.getContext("2d")}noise.seed(Math.random());let f=0;for(var m=0;m<a.width;m++){for(var h=0;h<a.height;h++){f++;if(c=="perlin3"){var E=noise.perlin3(m/n,h/i,m^h%150);var g=Math.abs(E*o)*256+r}else if(c=="simplex3"){var E=noise.simplex3(m/n,h/i,m^h%150);var g=Math.abs(E*o)*256+r}else if(c=="simple"){var g=Math.random()*255*o+r}let e=g;let t=g;let a=g;d.fillStyle="rgb("+e+","+t+","+a+")";d.fillRect(m,h,1,1);if(s){a=g/l;p.fillStyle="rgb("+a+","+a+","+a+")";p.fillRect(m,h,1,1)}}}const S=new THREE.CanvasTexture(a);S.wrapS=S.wrapT=THREE.RepeatWrapping;if(s){const T=new THREE.CanvasTexture(u);T.wrapS=T.wrapT=THREE.RepeatWrapping;return[S,T]}else{return S}}function makeLight(e,t=true){if(e.type=="point"){e.light=new THREE.PointLight(e.color,e.power,e.size);if(t){e.light.position.set(e.positionX,e.positionY,e.positionZ)}if(enableShadows){e.light.castShadow=true;e.light.shadow.mapSize.width=512;e.light.shadow.mapSize.height=512;e.light.shadow.camera.near=.5;e.light.shadow.camera.far=500;e.light.shadow.normalBias=.5}}else if(e.type=="hemisphere"){e.light=new THREE.HemisphereLight(e.color1,e.color2,e.power)}else if(e.type=="ambient"){e.light=new THREE.AmbientLight(e.color)}else if(e.type=="directional"){e.light=new THREE.DirectionalLight(e.color,e.power);e.light.position.set(e.positionX,e.positionY,e.positionZ);e.light.rotation.set(e.rotationX,e.rotationY,e.rotationZ);if(enableShadows){e.light.castShadow=true;e.light.shadow.mapSize.width=512;e.light.shadow.mapSize.height=512;e.light.shadow.camera.near=.5;e.light.shadow.camera.far=500;e.light.shadow.normalBias=.5}}}function animateAxisNegativeSpace(t,e){if(t.userData==undefined){t.userData={};t.userData.negativeSpaceTargetX=rand(t.negativeSpaceAnimationX[0],t.negativeSpaceAnimationX[1],t.negativeSpaceAnimationX[2]);t.userData.negativeSpaceTargetY=rand(t.negativeSpaceAnimationY[0],t.negativeSpaceAnimationY[1],t.negativeSpaceAnimationY[2]);t.userData.negativeSpaceCurrentX=0;t.userData.negativeSpaceCurrentY=0}let a=0;let n=0;let i=t.negativeSpaceAnimationSpeedX*e;let r=t.negativeSpaceAnimationSpeedY*e;if(t.userData.negativeSpaceCurrentX<t.userData.negativeSpaceTargetX){a=i;t.userData.negativeSpaceCurrentX+=i}else if(t.userData.negativeSpaceCurrentX>t.userData.negativeSpaceTargetX){a=-i;t.userData.negativeSpaceCurrentX-=i}if(t.userData.negativeSpaceCurrentY<t.userData.negativeSpaceTargetY){n=r;t.userData.negativeSpaceCurrentY+=r}else if(t.userData.negativeSpaceCurrentY>t.userData.negativeSpaceTargetY){n=-r;t.userData.negativeSpaceCurrentY-=r}if(t.userData.negativeSpaceTargetX>=0&&t.userData.negativeSpaceCurrentX>t.userData.negativeSpaceTargetX||t.userData.negativeSpaceTargetX<=0&&t.userData.negativeSpaceCurrentX<t.userData.negativeSpaceTargetX){t.userData.negativeSpaceTargetX=rand(t.negativeSpaceAnimationX[0],t.negativeSpaceAnimationX[1],t.negativeSpaceAnimationX[2])}if(t.userData.negativeSpaceTargetY>=0&&t.userData.negativeSpaceCurrentY>t.userData.negativeSpaceTargetY||t.userData.negativeSpaceTargetY<=0&&t.userData.negativeSpaceCurrentY<t.userData.negativeSpaceTargetY){t.userData.negativeSpaceTargetY=rand(t.negativeSpaceAnimationY[0],t.negativeSpaceAnimationX[1],t.negativeSpaceAnimationY[2])}if(a!=0||n!=0){for(let e in t.clipPlanes){t.clipPlanes[e].translate(new THREE.Vector3(a,n,0))}}}function makeCamera(){if(cameraType=="perspective"){var e=new THREE.PerspectiveCamera(fieldOfView,cameraAspect,cameraNear,cameraFar);e.aspect=rendererWidth/rendererHeight}else{var e=new THREE.OrthographicCamera(rendererWidth/-orthographicCameraScale,rendererWidth/orthographicCameraScale,rendererHeight/orthographicCameraScale,rendererHeight/-orthographicCameraScale,cameraNear,cameraFar)}cameraZ=randFromRange(cameraZ);e.position.x=cameraX;e.position.y=cameraY;e.position.z=cameraZ;e.updateProjectionMatrix();e.userData.animationQueue=[];e.userData.originalFocalLength=e.getFocalLength();return e}function makeScene(){const e=new THREE.Scene;e.fog=new THREE.Fog(fogColor,fogNear,fogFar);e.fog.userData={animationQueue:[]};e.fog.enabled=enableFog;if(!enableFog){e.fog.near=150;e.fog.far=155;e.fog.enabled=false}e.background=new THREE.Color(worldGradientColors[worldGradientColors.length-1][1]);return e}function makeRenderer(){const e=new THREE.WebGLRenderer({antialias:rendererAntialias,premultipliedAlpha:true});e.setSize(rendererWidth,rendererHeight,false);e.setPixelRatio(window.devicePixelRatio);e.toneMapping=THREE[rendererToneMapping];e.localClippingEnabled=true;if(enableShadows){e.shadowMap.enabled=true;e.shadowMap.type=THREE.PCFShadowMap}document.body.appendChild(e.domElement);return e}function loadOBJ(e,t,a,n,i){const r=new THREE.OBJLoader;object=r.parse(atob(e));object.traverse(function(e){e.material=t});object.scale.set(a[0],a[1],a[2]);object.position.set(n[0],n[1],n[2]);object.rotation.set(THREE.MathUtils.degToRad(i[0]),THREE.MathUtils.degToRad(i[1]),THREE.MathUtils.degToRad(i[2]));return object}function addPivotToAxis(e,t,a,n=undefined,i=undefined){let r=new THREE.Object3D;r.userData.name=a;r.userData.shapeType=t.userData.shapeType;var o=rand(e.axisX[0],e.axisX[1],e.axisX[2]);if(n){var s=randFromRange(n)}else{var s=rand(e.axisY[0],e.axisY[1],e.axisY[2])}var l=rand(e.axisZ[0],e.axisZ[1],e.axisZ[2]);r.userData.rotationSpeed=rand(e.coneRotationSpeed[0],e.coneRotationSpeed[1],e.coneRotationSpeed[2]);r.userData.originalRotationSpeed=r.userData.rotationSpeed;r.rotation.z=THREE.MathUtils.degToRad(rand(e.axisAngle[0],e.axisAngle[1],e.axisAngle[2]));r.userData.originalPosition=[o,s,l];r.position.set(o,s,l);r.add(t);e.pivots.push(r);e.mainPivot.add(r);if(i==undefined){return}if(r.userData.name.includes("terrain")){i*=terrainsAppearAndDisappearMultiplier}if(r.userData.name.includes("knot")){i*=knotsAppearAndDisappearMultiplier}r.children[0].userData.originalScale=JSON.parse(JSON.stringify(r.children[0].scale));r.userData.growUp=i;r.children[0].scale.set(0,0,0)}function addConeToAxis(e,t,a,n=undefined,i=undefined){let r=rand(a.radius[0],a.radius[1],a.radius[2]);let o=rand(a.height[0],a.height[1],a.height[2]);let s=rand(a.scale[0],a.scale[1],a.scale[2]);let l=s+rand(a.scaleX[0],a.scaleX[1],a.scaleX[2]);let c=s+rand(a.scaleY[0],a.scaleY[1],a.scaleY[2]);let d=s+rand(a.scaleZ[0],a.scaleZ[1],a.scaleZ[2]);let u=rand(a.positionX[0],a.positionX[1],a.positionX[2]);let p=rand(a.positionY[0],a.positionY[1],a.positionY[2]);let f=rand(a.positionZ[0],a.positionZ[1],a.positionZ[2]);let m=rand(a.rotationX[0],a.rotationX[1],a.rotationX[2]);let h=rand(a.rotationY[0],a.rotationY[1],a.rotationY[2]);let E=rand(a.rotationZ[0],a.rotationZ[1],a.rotationZ[2]);let g=a.numberOfRadialSegments;let S=a.numberOfHeightSegments;let T=a.openEnded;if(e.ellipseMode){u*=Math.pow(20-Math.abs(p),e.ellipseModePowerOf)*e.ellipseModeMultiplier;f*=Math.pow(20-Math.abs(p),e.ellipseModePowerOf)*e.ellipseModeMultiplier}if(e.enableScaleEllipseMode){l*=Math.pow(e.scaleEllipseModeBaseX-Math.abs(p),e.scaleEllipseModePowerOfX)*e.scaleEllipseModeMultiplierX;c*=Math.pow(e.scaleEllipseModeBaseY-Math.abs(p),e.scaleEllipseModePowerOfY)*e.scaleEllipseModeMultiplierY;d*=Math.pow(e.scaleEllipseModeBaseZ-Math.abs(p),e.scaleEllipseModePowerOfZ)*e.scaleEllipseModeMultiplierZ}let v={};for(let e=0;e<100;e++){let e=a.types[randS(0,a.types.length-1,1)];if(randS(0,1,.1)>1-e.probability){v=e;break}}try{var x=materialTemplates[a.material].clone()}catch(A){console.warn(a);var x=materialTemplates[pick(a.material)[1]].clone()}if(a.wireframeProbability&&randS(0,1,.01)>1-a.wireframeProbability){x.wireframe=true;g=5;S=5;T=true}else{x.wireframe=false}if(e.clipPlanes&&e.clipPlanes.length>0){x.clippingPlanes=e.clipPlanes}let D=makeCone(x,r,o,g,S,T,[l,c,d],[u,p,f],[m,h,m],v);if(n){let e=Math.max(l,c,d);let t=e/100*n;t=Math.max(t,1e-7);D.scale.set(0,0,0);D.userData.animationQueue=[makeAnimationForQueue("scale",0,e,e,t)]}if(e.enableNegativeSpace){D.material.clippingPlanes=e.clipPlanes;D.material.clipIntersection=true}D.userData.name=t;D.userData.shapeType=i;addPivotToAxis(e,D,t)}function animateWorldPlane(){if(!SCENE.worldPlane.userData.animationQueue){if(SCENE.worldPlane.scale.x>1+SCENE.worldPlane.userData.scaleAmount&&SCENE.worldPlane.userData.scaleFactor>0||SCENE.worldPlane.scale.x<1&&SCENE.worldPlane.userData.scaleFactor<0){SCENE.worldPlane.userData.scaleFactor*=-1}SCENE.worldPlane.scale.set(SCENE.worldPlane.scale.x+SCENE.worldPlane.userData.scaleFactor,SCENE.worldPlane.scale.y+SCENE.worldPlane.userData.scaleFactor,1)}}function makeWorldPlane(){worldPlane=makeGradientPlane(rendererWidth*3,rendererWidth*3,worldGradientType,worldGradientColors,false);worldPlane.userData.name="worldPlane";worldPlane.position.z=-rendererWidth;worldPlane.z=-100;worldPlane.userData.scaleFactor=rand(worldGradientAnimationSpeed[0],worldGradientAnimationSpeed[1],worldGradientAnimationSpeed[2]);worldPlane.userData.scaleAmount=rand(worldGradientAnimationScale[0],worldGradientAnimationScale[1],worldGradientAnimationScale[2]);worldPlane.userData.animationQueue=[];SCENE.worldPlane=worldPlane;SCENE.scene.add(SCENE.worldPlane)}function addExtraShapeToAxis(e,t,a,o,n=undefined){let i=a;let r=randFromRange(o.scale);let s=r+randFromRange(o.scaleX);let l=r+randFromRange(o.scaleY);let c=r+randFromRange(o.scaleZ);let d=randFromRangeS2(o.positionX);let u=randFromRangeS2(o.positionY);let p=randFromRangeS2(o.positionZ);let f=randFromRange(o.rotationX);let m=randFromRange(o.rotationY);let h=randFromRange(o.rotationZ);if(o.material){if(!materialTemplates[o.material]){console.warn("Object has no material",o)}else{var E=materialTemplates[o.material].clone()}}else{var E=e.coneMaterial.clone();if(e.coneMaterial.map){if(o.textureScale){E.map.repeat.x=o.textureScale[0];E.map.repeat.y=o.textureScale[1]}if(o.textureRotation){E.map.rotation=THREE.MathUtils.degToRad(o.textureRotation);E.map.rotation=true}}if(o.color){E.color=new THREE.Color(o.color);E.color.needsUpdate=true}}if(e.clipPlanes&&e.clipPlanes.length>0){E.clippingPlanes=e.clipPlanes}if(i=="flower1"){E.map=undefined;E.bumpMap=undefined;let t=E.clone();if(SCENE.palette.special){E.color=new THREE.Color(SCENE.palette.special.flower[0]);t.color=new THREE.Color(SCENE.palette.special.flower[1])}else{let e=pickS2(SCENE.palette.colors);E.color=new THREE.Color(e[0]);t.color=new THREE.Color(e[1])}E=[E,t]}let g=undefined;if(i=="terrain"){let e=randFromRange(o.heightScale);g=makeTerrain(E,o.worldSizeX,o.worldSizeY,e,[s,l,c],[d,u,p],[f,m,h])}if(i=="smallterrain"){let e=randFromRange(o.heightScale);g=makeTerrain(E,o.worldSizeX,o.worldSizeY,e,[s,l,c],[d,u,p],[f,m,h],1,o.bumpsRange,o.depth)}else if(i=="cloud"){let e=randFromRange(o.sizeX);let t=randFromRange(o.sizeY);let a=randFromRange(o.sizeZ);let n=randFromRange(o.nSpheres);g=makeCloud(E,e,t,a,n,o.spheresScale,[s,l,c],[d,u,p],[f,m,h])}else if(i=="frame"){let e=randFromRange(o.height);let t=randFromRange(o.width);let a=randFromRange(o.thickness);let n=randFromRange(o.depth);g=makeFrame(E,e,t,a,n,[s,l,c],[d,u,p],[f,m,h])}else if(i=="rectangle"){let e=randFromRange(o.height);let t=randFromRange(o.width);let a=randFromRange(o.depth);g=makeRectangle(E,e,t,a,[s,l,c],[d,u,p],[f,m,h])}else if(i=="arrow"){let e=randFromRange(o.depth);let t=randFromRange(o.bevelThickness);let a=randFromRange(o.bevelSize);let n=randFromRange(o.bevelSegments);let i=o.type||0;g=makeArrow(E,e,t,a,n,[s,l,c],[d,u,p],[f,m,h],i)}else if(i=="knot"){let e=randFromRange(o.radius);let t=randFromRange(o.tube);let a=randFromRange(o.tubularSegments);let n=randFromRange(o.radialSegments);let i=randFromRange(o.p);let r=randFromRange(o.q);g=makeKnot(E,e,t,a,n,i,r,[s,l,c],[d,u,p],[f,m,h])}else if(i in base64Objects){g=loadOBJ(base64Objects[i],E,[s,l,c],[d,u,p],[f,m,h])}g.userData.name=t;g.name=t;g.userData.shapeType=i;if(e.enableNegativeSpace){g.material.clippingPlanes=e.clipPlanes;g.material.clipIntersection=true}addPivotToAxis(e,g,t,o.yAxisRangeOverwrite,n)}function updateObjectRotationSpeed(t,a,n,i=1,r=.1){for(let e of Axis){if(e.name==a){for(let a of e.pivots){if(a.userData.name==t){let e=a.userData.rotationSpeed;if(e===undefined){e=0}let t=makeAnimationForQueue("rotationSpeed",e,n,n,i,r);if(a.userData.animationQueue===undefined){a.userData.animationQueue=[]}a.userData.animationQueue.push(t);return}}}}}function switchObjectRotationDirection(t,a,n=1,i=.1){for(let e of Axis){if(e.name==a){for(let a of e.pivots){if(a.userData.name==t){let e=a.userData.rotationSpeed;if(e===undefined){e=0}let t=makeAnimationForQueue("rotationSpeed",e,e*-1,e*-1,n,i);if(a.userData.animationQueue===undefined){a.userData.animationQueue=[]}a.userData.animationQueue.push(t);return}}}}}function updateObjectDistanceFromAxis(n,e,i,r=1,o=.1){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==n){for(let a of e.children){if(a.userData.name==n){let e=a.position.x;let t=makeAnimationForQueue("distance",e,i,i,r,o);if(a.userData.animationQueue===undefined){a.userData.animationQueue=[]}a.userData.animationQueue.push(t)}}}}}}}function updateBackgroundGradientScale(e,t=1,a=.1){let n=Math.max(SCENE.worldPlane.scale.x,SCENE.worldPlane.scale.y);SCENE.worldPlane.userData.animationQueue.push(makeAnimationForQueue("scale",n,e,e,t,a))}function updateCameraPosition(e,t,a,n=1,i=.1){if(e!==undefined){SCENE.camera.userData.animationQueue.push(makeAnimationForQueue("x",SCENE.camera.position.x,e,e,n,i))}if(t!==undefined){SCENE.camera.userData.animationQueue.push(makeAnimationForQueue("y",SCENE.camera.position.y,t,t,n,i))}if(a!==undefined){SCENE.camera.userData.animationQueue.push(makeAnimationForQueue("z",SCENE.camera.position.z,a,a,n,i))}}function updateObjectScale2(e,t,a=1,n=.1){let i=makeAnimationForQueue("scale",[e.scale.x,e.scale.y,e.scale.z],[t,t,t],[t,t,t],a,n);if(e.userData.animationQueue==undefined){e.userData.animationQueue=[]}e.userData.animationQueue.push(i)}function addNewShape(e,t,a,n,i=false){for(ax of Axis){shapeParams=extraShapes[a];if(ax.name==e){if(i){let t=false;for(let e of ax.pivots){if(e.userData.name.slice(0,a.length)==a){t=true;break}}if(!t){continue}}if(shapeParams.cone){addConeToAxis(ax,t,shapeParams,n,a);return}else{if(a.includes("terrain")){n*=terrainsAppearAndDisappearMultiplier}if(a.includes("knot")){n*=knotsAppearAndDisappearMultiplier}addExtraShapeToAxis(ax,t,a,shapeParams,n)}}}}function rotateAxis(t,a,n,i,r=1,o=.1){for(let e of Axis){if(e.name==t){if(e.mainPivot.userData.animationQueue==undefined){e.mainPivot.userData.animationQueue=[]}if(a!==undefined){a=THREE.MathUtils.degToRad(a);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("angleX",e.mainPivot.rotation.x,a,a,r,o))}if(n!==undefined){n=THREE.MathUtils.degToRad(n);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("angleY",e.mainPivot.rotation.y,n,n,r,o))}if(i!==undefined){i=THREE.MathUtils.degToRad(i);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("angleZ",e.mainPivot.rotation.z,i,i,r,o))}}}}function moveAxis(t,a,n,i,r=1,o=.1){for(let e of Axis){if(e.name==t){if(e.mainPivot.userData.animationQueue==undefined){e.mainPivot.userData.animationQueue=[]}if(a!==undefined){a=THREE.MathUtils.degToRad(a);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("x",e.mainPivot.position.x,a,a,r,o))}if(n!==undefined){n=THREE.MathUtils.degToRad(n);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("y",e.mainPivot.position.y,n,n,r,.1))}if(i!==undefined){i=THREE.MathUtils.degToRad(i);e.mainPivot.userData.animationQueue.push(makeAnimationForQueue("z",e.mainPivot.position.z,i,i,r,.1))}}}}function getObjectVertexXYZ(e,a,n){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==a){for(child of e.children){let e=child.geometry.getAttribute("position");if(n==undefined){n=rand(0,e.count,1)}let t=new THREE.Vector3(e.getX(n),e.getY(n),e.getZ(n));t.applyMatrix4(child.matrixWorld);return t}}}}}}function addRotationLoop(a,e,i,r){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==a){for(let n of e.children){if(n.userData.name==a){let e;let t;if(i=="X"){e="angleX";t=n.rotation.x}else if(i=="Y"){e="angleY";t=n.rotation.y}else if(i=="Z"){e="angleZ";t=n.rotation.z}let a=makeAnimationForQueue(e,t,t+1,t+1,r,undefined);if(n.userData.animationLoop===undefined){n.userData.animationLoop=[]}n.userData.animationLoop.push(a)}}}}}}}function removeRotationLoop(n,e,i){for(let t of Axis){if(t.name==e){for(let e of t.pivots){if(e.userData.name==n){for(let a of e.children){if(a.userData.name==n){if(a.userData.animationLoop){let t;if(i=="X"){t="angleX"}else if(i=="Y"){t="angleY"}else if(i=="Z"){t="angleZ"}for(let e=0;e<a.userData.animationLoop.length;e++){if(a.userData.animationLoop[e].attribute==t){a.userData.animationLoop.splice(e,1);return}}}}}}}}}}function logDebugMessage(){let t=`Hash: ${tokenHash} Randomness:`;for(let e=0;e<5;e++){t+=" "+randS(1,100,1)}t+=`\nPalette: ${JSON.stringify(SCENE.palette)}`;t+="\nAxis shapes:";for(let e of Axis){t+="\n"+e.name+":";for(shape in e.extraShapes){t+=" "+shape+` [${e.extraShapes[shape].numberOfShapes} ${e.extraShapes[shape].material}]`}}console.log(t)}async function walletActivityUpdates(e){try{return await getLastBlockReceipts(e)}catch(t){console.error(t)}}function disableAxis(t,a=.01){t.enabled=false;for(let e of t.pivots){if(!e.userData.originalScale){e.userData.originalScale=e.scale.x}updateObjectScale2(e,0,a)}}function enableAxis(e,a=.01){e.enabled=true;for(let t of e.pivots){t.scale.set(0,0,0);updateObjectScale2(t,t.userData.originalScale,a);for(let e of t.children){e.visible=true}}}function axisHasAnimatingPivots(t){for(let e of t.pivots){if(e.userData.animationQueue&&e.userData.animationQueue.length>0){return true}}return false}function setAxisInvisibleAndDisabled(e){e.enabled=false;for(let t of e.pivots){t.userData.originalScale=t.scale.x;t.scale.set(0,0,0);for(let e of t.children){e.visible=false}}}function disappearPivot(e,t=.01,a=false,n=undefined,i=undefined){e.userData.disabled=true;if(a){e.userData.toBeRemovedAfterShrink=true}if(!e.children[0].userData.originalScale){e.children[0].userData.originalScale=JSON.parse(JSON.stringify(e.children[0].scale))}if(e.userData.name.includes("terrain")){t*=terrainsAppearAndDisappearMultiplier}if(e.userData.name.includes("knot")){t*=knotsAppearAndDisappearMultiplier}if(n){e.userData.delayedDisappear=true;setTimeout(()=>{e.userData.shrinkDown=t;e.userData.delayedDisappear=false;e.userData.disappearCallback=i},rand(n[0],n[1],1))}else{e.userData.shrinkDown=t;e.userData.disappearCallback=i}}function disappearObjects(n,i=.01,r=false,o=undefined,s=undefined,l=undefined){let c=0;for(let e=0;e<500;e++){let e=Axis[rand(0,Axis.length-1,1)];if(!e.enabled||!e.pivots||e.pivots.length==0){continue}let t=rand(0,e.pivots.length-1,1);let a=e.pivots[t];if(a.userData.shrinkDown||a.userData.growUp){if(o!="E"){continue}}if(s&&a.userData.shapeType!=s){continue}if(o&&a.userData.name.slice(0,o.length)!=o){continue}if(a.userData.disabled){if(o!="E"&&!r){continue}}if(a.userData.delayedDisappear||a.userData.delayedAppear){continue}disappearPivot(a,i,r,l);c++;if(c>=n){return c}}return c}function disappearObjectsByType(e,t=.01,a=false,n=undefined,i=undefined,r=undefined){let o=0;for(ax of Axis){for(pivot of ax.pivots){if(i&&pivot.userData.shapeType!=i){continue}if(n&&pivot.userData.name.slice(0,n.length)!=n){continue}disappearPivot(pivot,t,a,r);o++;if(e){if(o>=e){return o}}}}return o}function appearObjects(a,n=.01,i=.3,r=undefined){let o=0;for(let e=0;e<500;e++){let e=Axis[rand(0,Axis.length-1,1)];if(!e.enabled||!e.pivots||e.pivots.length==0){continue}let t=e.pivots[rand(0,e.pivots.length-1,1)];if(t.userData.shrinkDown||t.userData.growUp){continue}if(t.userData.delayedDisappear||t.userData.delayedAppear){continue}if(!t.userData.disabled){continue}t.userData.disabled=false;if(t.userData.name.includes("terrain")){n*=terrainsAppearAndDisappearMultiplier}if(t.userData.name.includes("knot")){n*=knotsAppearAndDisappearMultiplier}if(r){t.userData.delayedAppear=true;setTimeout(()=>{t.userData.growUp=n;t.userData.delayedAppear=false},rand(r[0],r[1],1))}else{t.userData.growUp=n}o++;if(o>=a){break}continue;if(t.children[0].userData.animationQueue&&t.children[0].userData.animationQueue.length>0){continue}if(t.userData.animationQueue&&t.userData.animationQueue.length>0){continue}if(t.userData.disabledWithTimeout){continue}if(t.children[0].userData.name.includes("terrain")){n*=terrainsAppearAndDisappearMultiplier}if(t.children[0].userData.name.includes("knot")){n*=knotsAppearAndDisappearMultiplier}if(t.userData.disabled){updateObjectScale2(t.children[0],t.children[0].userData.originalScale,n,i);t.visible=true;t.userData.disabled=false;o++;if(o>=a){break}}}return o}function randomContractData(){let e=[rand(0,1e3,1)];let t=[];let a=[rand(0,1e3,1)];let n=[];let i=[rand(20,300,1)];let r=[];let o=[];let s=[300];let l=1681510366;let c=1681510366;let d=1681510366;let u=1681510366;for(let e=0;e<200;e++){l+=rand(1e3,1e6,1);c+=rand(1e3,1e6,1);d+=rand(1e3,1e6,1);u+=rand(1e3,1e6,1);t.push(l);n.push(c);r.push(d);r.push(rand(3e15,6e15,1));o.push(u);o.push(rand(3e15,6e15,1))}return[e,t,a,n,i,r,o,s]}function pickAxis(t,a=[],n=false,i=false){for(let e=0;e<100;e++){let e=rand(0,Axis.length-1,1);if(!Axis[e].pivots||Axis[e].pivots.length==0){continue}if(i&&Axis[e].extraShapes.size==0){continue}if(a.indexOf(e)!=-1||n&&Axis[e].extremeAngle){continue}if(Axis[e].enabled==t){return Axis[e]}}}function getLoopingObjects(){let a=[];for(let t of Axis){if(t.enabled){for(let e of t.pivots){if(e.children[0].userData.animationLoop||e.userData.animationLoop){a.push([t.name,e])}}}}return a}function getNotLoopingObjects(){let a=[];for(let t of Axis){if(t.enabled){for(let e of t.pivots){if(!e.children[0].animationLoop){a.push([t.name,e])}}}}return a}function animateFog(){if(SCENE.scene.fog.userData){if(SCENE.scene.fog.userData.nearTo){if(SCENE.scene.fog.near<SCENE.scene.fog.userData.nearTo){SCENE.scene.fog.near+=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.near=parseFloat(SCENE.scene.fog.near.toFixed(5))}else if(SCENE.scene.fog.near>SCENE.scene.fog.userData.nearTo){SCENE.scene.fog.near-=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.near=parseFloat(SCENE.scene.fog.near.toFixed(5))}else{SCENE.scene.fog.userData.nearTo=undefined}}if(SCENE.scene.fog.userData.farTo){if(SCENE.scene.fog.far<SCENE.scene.fog.userData.farTo){SCENE.scene.fog.far+=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.far=parseFloat(SCENE.scene.fog.far.toFixed(5))}else if(SCENE.scene.fog.far>SCENE.scene.fog.userData.farTo){SCENE.scene.fog.far-=dynamicUpdateAnimationSpeeds.fog.speed;SCENE.scene.fog.far=parseFloat(SCENE.scene.fog.far.toFixed(5))}else{SCENE.scene.fog.userData.farTo=undefined}}if(SCENE.scene.fog.near>SCENE.scene.fog.far){SCENE.scene.fog.far=SCENE.scene.fog.near+1}else if(SCENE.scene.fog.far-SCENE.scene.fog.near<1){SCENE.scene.fog.far=SCENE.scene.fog.near+1}}}function getNShapesWithTypes(){let t=Object.keys(extraShapes);let a={};for(let e of t){a[e]=0}for(let e of Axis){if(e.enabled){for(pivot of e.pivots){if(!pivot.userData.disabled){for(let e of t){if(pivot.userData.shapeType==e){if(a[e]){a[e]++}else{a[e]=1}}}}}}}return a}function pickAxisForShape(t){let a=[];for(let e=0;e<Axis.length;e++){if(Axis[e].enabled&&extraShapes[t].axis.indexOf(e+1)>-1){a.push(e)}}if(a.length>0){return Axis[pick(a)]}}function pivotNotAnimating(e){for(child of e.children){if(child.userData.animationQueue&&child.userData.animationQueue.length>0){return false}}return e.userData.animationQueue&&e.userData.animationQueue.length==0}function pivotIsAppearingOrDisappearing(e){return Boolean(e.userData.shrinkDown||e.userData.growUp||e.userData.delayedDisappear||e.userData.delayedAppear)}function processUpdateTimers(){let t=getCurrentTs();for(let e=0;e<Axis.length;e++){ax=Axis[e];if(e==5||e==6){if(ax.enabled&&ax.TS_ENABLED&&t>ax.TS_ENABLED){disableAxis(ax,dynamicUpdateAnimationSpeeds.axisAppearAndDisappear.speed);ax.TS_ENABLED=undefined;console.log("Normalized number of axis")}}if(ax.TS_ROTATED&&t>ax.TS_ROTATED){rotateAxis(ax.name,undefined,undefined,ax.originalAngle,dynamicUpdateAnimationSpeeds.axisAngle.speed,dynamicUpdateAnimationSpeeds.axisAngle.curve);ax.TS_ROTATED=undefined;console.log("Normalized axis rotation")}if(ax.TS_ROTATED_EXTREME&&t>ax.TS_ROTATED_EXTREME){rotateAxis(ax.name,undefined,undefined,ax.originalAngle,dynamicUpdateAnimationSpeeds.axisExtremeAngle.speed,dynamicUpdateAnimationSpeeds.axisExtremeAngle.curve);ax.TS_ROTATED_EXTREME=undefined;console.log("Normalized axis extreme rotation")}if(ax.TS_POSITION&&t>ax.TS_POSITION){moveAxis(ax.name,ax.originalPosition[0],ax.originalPosition[1],ax.originalPosition[2],dynamicUpdateAnimationSpeeds.axisPosition.speed,dynamicUpdateAnimationSpeeds.axisPosition.curve);ax.TS_POSITION=undefined;console.log("Normalized axis position")}if(ax.TS_NEGATIVESPACE&&t>ax.TS_NEGATIVESPACE){removeNegativeSpace(ax);ax.TS_NEGATIVESPACE=undefined;console.log("Normalized negative space")}if(ax.TS_NUMBEROFKNOTS&&t>ax.TS_NUMBEROFKNOTS){let e=0;for(p of ax.pivots){if(p.userData.shapeType=="knot"){e++}}let t=e-ax.originalNumberOfKnots;if(t>0){disappearObjectsByType(t,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,"E","knot")}ax.TS_NUMBEROFKNOTS=undefined;console.log("Normalized number of knots")}for(let e of ax.pivots){if(e.userData.TS_SPINNING&&t>e.userData.TS_SPINNING){removeRotationLoop(e.userData.name,ax.name,e.userData.spinningAxis);e.userData.TS_SPINNING=undefined;console.log("Normalized spinning obj")}if(ax.TS_KNOTSPQ&&t>ax.TS_KNOTSPQ&&e.userData.name[0]=="E"){extraShapes.knot.p=extraShapes.knot.originalP;extraShapes.knot.q=extraShapes.knot.originalQ;disappearPivot(e,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,()=>{addNewShape(ax.name,`knot_1`,"knot",dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed)});setTimeout(e=>{e.TS_KNOTSPQ=undefined},5e3,ax);console.log("Normalized knot p q")}if(e.userData.TS_ROTATIONDIRECTION&&t>e.userData.TS_ROTATIONDIRECTION){switchObjectRotationDirection(e.userData.name,ax.name,dynamicUpdateAnimationSpeeds.axisRotationDirection.speed,dynamicUpdateAnimationSpeeds.axisRotationDirection.curve);e.userData.TS_ROTATIONDIRECTION=undefined;console.log("Normalized axis rotation")}}if(ax.TS_EXTRAOBJECTCLASS&&t>ax.TS_EXTRAOBJECTCLASS){for(pivot of ax.pivots){if(pivot.userData.name.includes("update17")){disappearPivot(pivot,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true)}}ax.TS_EXTRAOBJECTCLASS=undefined;console.log("Normalized extra obj class")}}if(SCENE.camera.userData.TS_POSITION&&t>SCENE.camera.userData.TS_POSITION){updateCameraPosition(undefined,undefined,SCENE.camera.userData.originalPositionZ,dynamicUpdateAnimationSpeeds.cameraPosition.speed,dynamicUpdateAnimationSpeeds.cameraPosition.curve);SCENE.camera.userData.TS_POSITION=undefined;console.log("Normalized camera position")}if(SCENE.scene.fog.userData.TS_ENABLED&&t>SCENE.scene.fog.userData.TS_ENABLED){if(SCENE.scene.fog.userData.nearTo){console.log("Fog is already animating")}else{SCENE.scene.fog.userData={nearTo:100,farTo:100};SCENE.scene.fog.enabled=false;SCENE.scene.fog.userData.TS_ENABLED=undefined;console.log("Normalized fog")}}}function updateScene(){try{processUpdateTimers()}catch(s){console.error(s)}for(let t of Axis){for(let e of t.pivots){if(e.userData.toBeRemoved&&!(e.userData.growUp||e.userData.shrinkDown)){console.log(`Removed pivots: ${t.name} - ${e.userData.name}`);SCENE.scene.remove(e);e.userData.alreadyRemoved=true}}t.pivots=t.pivots.filter(e=>!e.userData.alreadyRemoved)}let l="";if(l){console.log(l)}var e=SCENE.data.contract.tiers.royalty_received_tier;var t=SCENE.data.contract.tiers.contract_activity_tier;var a=SCENE.data.contract.tiers.sends_tier;var n=SCENE.data.contract.tiers.approvals_tier;console.log(`Tiers: royalty: ${e.value} contract: ${t.value} sends: ${a.value} approvals: ${n.value}`);l="";let i=shuffle([1,2,3,4,8,9,10,11,14,15,16]);let r=[];if(SCENE.data.memory){if(!SCENE.data.memoryPossibleUpdatesRandom){SCENE.data.memoryPossibleUpdatesRandom=i}for(let t=0;t<SCENE.data.memory;t++){SCENE.data.memory--;let e=SCENE.data.memoryPossibleUpdatesRandom.pop();console.log("Update",e,"recreated from memory");r.push(e);if(t>=1){break}}}else{if(SCENE.data.wallets&&i.length>0){r.push(i.pop());SCENE.data.wallets=undefined}}if(e.changed){console.log("royalty_received_tier triggered");r.push(5)}if(t.changed){console.log("contract_activity_tier triggered");r.push(13)}if(a.changed){console.log("sends_tier triggered");r.push(6)}if(n.changed){console.log("approvals_tier triggered");r.push(7)}if(r.length==0){r.push(0)}if(DEBUG_UPDATE_SOURCE=="random"){r=[rand(0,16,1)]}if(DEBUG_UPDATE_SOURCE!=undefined&&DEBUG_UPDATE_SOURCE!="random"){r=Array.isArray(DEBUG_UPDATE_SOURCE)?DEBUG_UPDATE_SOURCE:[DEBUG_UPDATE_SOURCE]}console.log("updateType",r);try{if(DEBUG_STOP_UPDATES){console.warn("Updates are stopped");return}}catch{}if(r.indexOf(0)!=-1){let a=0;let n=0;for(let t of Axis){for(let e of t.pivots){if(e.userData.disabled){n++}else{a++}}}let e=rand(10,20,1);let t=rand(1,10,1);try{if(a/n<4){t=0}}catch{t=0}console.log("nObjectsToAppear",e,"nObjectsToDisappear",t);let i=0;let r=0;i=appearObjects(e,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);if(t){r=disappearObjects(t,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed)}l+=`Appeared objects:${i} Dissapeared objects:${r} (${a},${n})\n`}if(r.indexOf(1)!=-1){let e=Axis[pick([5,6])];if(e.enabled){disableAxis(e,dynamicUpdateAnimationSpeeds.axisAppearAndDisappear.speed);l+=`Disabled axis:${e.name}\n`}else{enableAxis(e,dynamicUpdateAnimationSpeeds.axisAppearAndDisappear.speed);l+=`Enabled axis:${e.name}\n`;e.TS_ENABLED=getCurrentTs()+addOrRemoveAxisUpdateTimeout}}if(r.indexOf(2)!=-1){let e=pickAxis(true,[],true);if(e==undefined){console.log("No axis for angle change found");return}let t=randFromRange(hashOverwrites.axisAngle);let a=THREE.MathUtils.radToDeg(e.mainPivot.rotation.z);if(!e.originalAngle){e.originalAngle=a}rotateAxis(e.name,undefined,undefined,t,dynamicUpdateAnimationSpeeds.axisAngle.speed,dynamicUpdateAnimationSpeeds.axisAngle.curve);l+=`Changed ${e.name} angle from ${a} to ${t}\n`;e.TS_ROTATED=getCurrentTs()+axisAngleUpdateTimeout}if(r.indexOf(3)!=-1){let e=pickAxis(true,[],true);if(e==undefined){console.log("No axis for extreme angle change found");return}let t=THREE.MathUtils.radToDeg(e.centralRodRotation[2]);let a=rand(0,1,.001)>.5?rand(-90,-30,1):rand(30,90,1);let n=THREE.MathUtils.radToDeg(e.mainPivot.rotation.z);if(e.originalAngle==undefined){e.originalAngle=n}e.extremeAngle=a;e.axisAngle=[a,a,1];e.extremeAngleEnabledTimestamp=getCurrentTs();rotateAxis(e.name,undefined,undefined,a,dynamicUpdateAnimationSpeeds.axisExtremeAngle.speed,dynamicUpdateAnimationSpeeds.axisExtremeAngle.curve);l+=`Changed ${e.name} extreme angle from ${t} to ${a}\n`;e.TS_ROTATED_EXTREME=getCurrentTs()+axisExtremeAngleUpdateTimeout}if(r.indexOf(4)!=-1){let e=pickAxis(true,[],false);let t=`${e.centraRodPosition[0]} ${e.centraRodPosition[1]} ${e.centraRodPosition[2]}`;if(!e.originalPosition){e.originalPosition=JSON.parse(JSON.stringify(e.centraRodPosition))}let a=undefined;let n=undefined;let i=undefined;let r=rand(0,2,1);if(r==0){a=randFromRange(hashOverwrites.axisX)}else if(r==1){n=randFromRange(hashOverwrites.axisY)}else{i=randFromRange(hashOverwrites.axisZ)}let o=`${a/20} ${n/20} ${i/20}`;moveAxis(e.name,a,n,i,dynamicUpdateAnimationSpeeds.axisPosition.speed,dynamicUpdateAnimationSpeeds.axisPosition.curve);l+=`Changed ${e.name} position from ${t} to ${o}\n`;e.TS_POSITION=getCurrentTs()+axisPositionUpdateTimeout}if(r.indexOf(5)!=-1){console.log("royalty tier triggered");let a=tierToValue(tiersStructure.royalty,e.value);let n=pickAxis(true,[],false);for(let t of n.pivots){let e=t.userData.originalRotationSpeed*a;updateObjectRotationSpeed(t.userData.name,n.name,e,dynamicUpdateAnimationSpeeds.objectRotationSpeed.speed,dynamicUpdateAnimationSpeeds.objectRotationSpeed.curve);l+=`Changed ${n.name} ${t.userData.name} rotation speed from ${t.userData.originalRotationSpeed} to ${e}\n`}}if(r.indexOf(6)!=-1){console.log("sends tier triggered");let n=tierToValue(tiersStructure.sends,a.value);for(ax of Axis){if(ax.enabled){for(let a of ax.pivots){let e=a.userData.originalPosition[0];let t=e*n;updateObjectDistanceFromAxis(a.userData.name,ax.name,t,dynamicUpdateAnimationSpeeds.objectPosition.speed,dynamicUpdateAnimationSpeeds.objectPosition.curve);l+=`Changed ${ax.name} ${a.userData.name} distance from axis from ${e} to ${t}\n`}}}}if(r.indexOf(7)!=-1){console.log("sends approvals triggered");let e=tierToValue(tiersStructure.approvals,n.value);if(!SCENE.worldPlane.userData.originalScaleX){SCENE.worldPlane.userData.originalScaleX=SCENE.worldPlane.scale.x}let t=SCENE.worldPlane.userData.originalScaleX*e;updateBackgroundGradientScale(t,dynamicUpdateAnimationSpeeds.gradientScale.speed,dynamicUpdateAnimationSpeeds.gradientScale.curve);l+=`Changed gradient scale from ${SCENE.worldPlane.scale.x} to ${t}\n`}if(r.indexOf(8)!=-1){let r=getLoopingObjects().length;let t=getNotLoopingObjects();shuffle(t);console.log(t);let o=randFromRange(spinningObjectsRange);l+=`N spinning objects: ${r} Desired N spinning objects: ${o}\n`;let s=false;for(let e=0;e<500;e++){for(let i of t){let e=i[0];let t=i[1];if(t.userData.name.includes("terrain")){continue}let a=randFromRange(dynamicUpdateAnimationSpeeds.objectRotationSpeed2.speed);let n="Y";if(t.userData.name.includes("cone")){n="Z";a*=conesSpinningSpeedMultiplier}else if(t.userData.name.includes("knot")){a*=knotsSpinningSpeedMultiplier}if(t.children[0].userData.animationLoop==undefined||t.children[0].userData.animationLoop.length==0){addRotationLoop(t.userData.name,e,n,a);l+=`Adding rotation loop to ${e} ${t.userData.name} speed: ${a}\n`;t.userData.spinningAxis=n;t.userData.TS_SPINNING=getCurrentTs()+objectSpinningUpdateTimeout;r++;if(r>=o){s=true;break}break}}if(s){break}}}if(r.indexOf(9)!=-1){if(SCENE.camera.userData.animationQueue&&SCENE.camera.userData.animationQueue.length>0){console.log("Camera is already animating",SCENE.camera.userData.animationQueue)}else{if(!SCENE.camera.userData.originalPositionZ){SCENE.camera.userData.originalPositionZ=SCENE.camera.position.z}SCENE.camera.userData.positionUpdateTimestamp=getCurrentTs();let e=rand(30,cameraZ-5,1);if(rand(0,1,.01)>.5){e=rand(cameraZ+5,150,1)}updateCameraPosition(undefined,undefined,e,dynamicUpdateAnimationSpeeds.cameraPosition.speed,dynamicUpdateAnimationSpeeds.cameraPosition.curve);l+=`Changed camera position to ${e}\n`;SCENE.camera.userData.TS_POSITION=getCurrentTs()+cameraPositionUpdateTimeout}}if(r.indexOf(10)!=-1){if(!SCENE.scene.fog.enabled){if(SCENE.scene.fog.userData.nearTo){console.log("Fog is already animating")}else{SCENE.scene.fog.userData={nearTo:fogNear,farTo:fogFar};SCENE.scene.fog.enabled=true;l+=`Enabled fog\n`;SCENE.scene.fog.userData.TS_ENABLED=getCurrentTs()+fogUpdateTimeout}}else{if(SCENE.scene.fog.userData.nearTo){console.log("Fog is already animating")}else{SCENE.scene.fog.userData={nearTo:250,farTo:260};SCENE.scene.fog.enabled=false;l+=`Disabled fog\n`}}}if(r.indexOf(11)!=-1){let t=pickAxis(true,[],false);for(let e of t.pivots){t.rotationDirectionSwitchTimestamp=getCurrentTs();switchObjectRotationDirection(e.userData.name,t.name,dynamicUpdateAnimationSpeeds.axisRotationDirection.speed,dynamicUpdateAnimationSpeeds.axisRotationDirection.curve);e.userData.TS_ROTATIONDIRECTION=getCurrentTs()+axisRotationDirectionUpdateTimeout}l+=`Changed axis rotation direction ${t.name} \n`}if(r.indexOf(13)!=-1){console.log("sends activity triggered");let a=0;for(let e of Axis){if(e.enabled){a+=e.pivots.map(e=>!e.userData.disabled).length}}let n=getNShapesWithTypes();console.log("nShapesByType:",n);if(!SCENE.originalNumberOfShapes){SCENE.originalNumberOfShapes=a;SCENE.originalNumberOfShapesByType=n}let e=tierToValue(tiersStructure.contract,t.value);for(let t of Object.keys(SCENE.originalNumberOfShapesByType)){if(t=="terrain"||t=="clouds"||t=="knot"){continue}if(SCENE.originalNumberOfShapesByType[t]){var o=SCENE.originalNumberOfShapesByType[t]*e}else{var o=n[t]*e}if(n[t]!=o){l+=`${t} current: ${n[t]} desired: ${o}\n`}if(a<300&&o>n[t]){for(let e=0;e<o-n[t];e++){let e=pickAxisForShape(t);if(!e){console.warn("No axis picked for",t);continue}setTimeout(()=>{addNewShape(e.name,`E_${t}_${generateUUID()}`,t,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);l+=`Added shape ${t} to ${e.name} \n`},randFromRange(addOrRemoveObjectsTieredTimeSpreadRange))}}else if(a>20&&o<n[t]){let e=disappearObjects(Math.abs(n[t]-o),dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,t,addOrRemoveObjectsTieredTimeSpreadRange);l+=`Removed ${e}\n`}else{console.debug("Can't add or remove shapes")}}}if(r.indexOf(17)!=-1){let a={};let n=[];for(let t of Axis){if(t.enabled){for(let e of t.pivots){if(a[e.userData.shapeType]){a[e.userData.shapeType]++}else{a[e.userData.shapeType]=1}if(e.userData.name.includes("update17")&&n.indexOf(e.userData.shapeType)==-1){n.push(e.userData.shapeType)}}}}if(!SCENE.originalNumberOfShapeTypes){SCENE.originalNumberOfShapeTypes=sizeOfMapping(a)}let e=pick([0,1]);if(e==1&&n.length<=2||n.length==0){for(let n of shuffle(Object.keys(extraShapes))){if(!a[n]){let t=pickAxis(true,[],false);let a=extraShapes[n].numberOfShapes;console.log("Adding",a,n,"to",t.name);for(let e=0;e<a;e++){addNewShape(t.name,`E_${n}_update17_${generateUUID()}`,n,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);t.TS_EXTRAOBJECTCLASS=getCurrentTs()+objectClassUpdateTimeout}break}}}else if(e==0&&n.length>0){let e=pick(n);console.log("Removing existing shape type",e);let t=disappearObjectsByType(undefined,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,e);console.log("nDisappeared",t)}}if(r.indexOf(14)!=-1){let t=pick(["triangle","diamond"]);let a=randFromRange(nObjectsLeftOutsideOfNegativeSpace);let n=pick(diamondNegativeSpaceAngles);for(let e of Axis){if(e.clipPlanes==undefined||e.clipPlanes.length==0){createNegativeSpace(e,t,true,a,n);l+=`Added ${t} negative space to ${e.name}\n`;e.TS_NEGATIVESPACE=getCurrentTs()+negativeSpaceUpdateTimeout}else{if(e.removingNegativeSpace||e.creatingNegativeSpace){console.log(`Negative space for ${e.name} already being animated.`)}else{removeNegativeSpace(e);l+=`Removed negative space from ${e.name}\n`}}}}if(r.indexOf(15)!=-1){let e=rand(5,40,1);let t=0;for(ax of Axis){let e=0;for(p of ax.pivots){if(p.userData.shapeType=="knot"){e++}}t+=e;if(!ax.originalNumberOfKnots){ax.originalNumberOfKnots=e}}console.log(`Number of knots ${t} desired number of knots ${e}`);let n=e-t;if(n==0){console.log("Nothing to do")}else{if(n>0){for(let a=0;a<Math.abs(n);a++){let e=pick(extraShapes["knot"].axis);let t=Axis[e-1];addNewShape(t.name,`E_knot_${a}`,"knot",dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed);if(!SCENE.knotUpdateTimestamp){SCENE.knotUpdateTimestamp=getCurrentTs()}t.TS_NUMBEROFKNOTS=getCurrentTs()+numberOfKnotsUpdateTimeout;l+=`Added knot to ${t.name}\n`}}else{disappearObjects(Math.abs(n),dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,"E","knot");l+=`Removed knots\n`}}}if(r.indexOf(16)!=-1){if(extraShapes.knot.originalP==undefined){extraShapes.knot.originalP=extraShapes.knot.p}extraShapes.knot.p=knotsDynamicPRange;if(extraShapes.knot.originalQ==undefined){extraShapes.knot.originalQ=extraShapes.knot.q}extraShapes.knot.q=knotsDynamicQRange;for(let t of Axis){if(!t.addingKnots){for(let e of t.pivots){if(e.userData.name.includes("knot")&&e.userData.name[0]!="E"){if(!pivotIsAppearingOrDisappearing(e)){l+=`Changing q and p of ${t.name} ${e.userData.name}\n`;t.addingKnots=true;disappearPivot(e,dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed,true,undefined,()=>{addNewShape(t.name,`E_knot_${generateUUID()}`,"knot",dynamicUpdateAnimationSpeeds.objectAppearAndDisappear.speed)});t.TS_KNOTSPQ=getCurrentTs()+knotsPQUpdateTimeout;setTimeout(()=>{t.addingKnots=false},6e4)}}}}}}console.log(l)}function getPivotsWithSmallShapes(n){for(let a of Axis){if(a.enabled){for(let t=0;t<a.pivots.length;t++){let e=a.pivots[t];if(e.children[0].scale.x<n&&e.children[0].scale.x!=0){console.log(a.name,t,e.userData.name)}}}}}function processShrinkAndGrow(a){let n=.005;if(a.userData.shapeType=="terrain"||a.userData.shapeType=="smallterrain"){n=.01}if(a.userData.shrinkDown){if(a.userData.shrinkDown<1e-6){a.userData.shrinkDown=1e-6}if(a.userData.shrinkDown>.1){a.userData.shrinkDown=.1}let t=true;for(let e of["x","y","z"]){if(a.children[0].scale[e]>n){a.children[0].scale[e]-=a.userData.shrinkDown;if(a.children[0].scale[e]<n){a.children[0].scale[e]=n}t=false}else{a.children[0].scale[e]=n;a.userData.toBeRemoved=a.userData.toBeRemovedAfterShrink}}if(t){a.userData.shrinkDown=undefined;a.visible=false;if(a.userData.disappearCallback){a.userData.disappearCallback()}}}if(a.userData.growUp){if(a.userData.growUp<1e-6){a.userData.growUp=1e-6}if(a.userData.growUp>.1){a.userData.growUp=.1}let t=true;a.visible=true;for(let e of["x","y","z"]){if(a.children[0].scale[e]<a.children[0].userData.originalScale[e]){a.children[0].scale[e]+=a.userData.growUp;t=false}else{a.children[0].scale[e]=a.children[0].userData.originalScale[e]}}if(t){a.userData.growUp=undefined}}}async function getThreeJS(){for(let t=0;t<NODE_URLS.length;t++){try{var a=await fetch(NODE_URLS[t],{method:"POST",body:JSON.stringify({method:"eth_call",params:[{to:"0x16cc845d144A283D1b0687FBAC8B0601cC47A6C3",data:"0x43920d7d0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001074687265652e6a7320302e3134342e3000000000000000000000000000000000"},"latest"],id:2,jsonrpc:"2.0"})});let e=await a.json();return hexToString(e.result)}catch(e){console.log("Node failed.",NODE_URLS[t])}}}function hexToString(t){if(t.startsWith("0x")){t=t.slice(2)}let a="";for(let e=0;e<t.length;e+=2){const n=parseInt(t.substr(e,2),16);a+=String.fromCharCode(n)}return a}async function dataUpdate(){if(document.hidden){console.log("Tab is not on focus, no data updates");try{SCENE.data.contract.tiers.royalty_received_tier.changed=false;SCENE.data.contract.tiers.contract_activity_tier.changed=false;SCENE.data.contract.tiers.sends_tier.changed=false;SCENE.data.contract.tiers.approvals_tier.changed=false}catch(e){}return}NODE_URLS=shuffle(NODE_URLS);SCENE.data.contractPrev=SCENE.data.contract;SCENE.data.contract=await getContractData();if(getCurrentTs()>contractMintTimestamp+receiptsFetchingOffset){NODE_URLS=shuffle(NODE_URLS);SCENE.data.wallets=await walletActivityUpdates(SCENE.data.contract[SCENE.data.contract.length-1])}else{console.log("Receipts fetching will start at",contractMintTimestamp+receiptsFetchingOffset)}SCENE.data.contract.tiers=SCENE.data.contractPrev.tiers;calculateTiers(SCENE.data.contract);calculateContractDataUpdates();console.debug("Tiers:",SCENE.data.contract.tiers);console.debug("Data updates:",[SCENE.data.contractUpdates.approvalCount,SCENE.data.contractUpdates.transferCount,SCENE.data.contractUpdates.holderCount,SCENE.data.contractUpdates.royalty]);if(!LIVE_MODE){SCENE.data.contract=randomContractData();calculateContractDataUpdates();SCENE.data.contract.tiers={royalty_received_tier:{changed:pick([true,false]),value:rand(-3,3,1)},contract_activity_tier:{changed:pick([true,false]),value:rand(-3,3,1)},sends_tier:{changed:pick([true,false]),value:rand(-3,3,1)},approvals_tier:{changed:pick([true,false]),value:rand(-3,3,1)}};console.debug("Random Tiers:",SCENE.data.contract.tiers);console.debug("Random data updates:",[SCENE.data.contractUpdates.approvalCount,SCENE.data.contractUpdates.transferCount,SCENE.data.contractUpdates.holderCount,SCENE.data.contractUpdates.royalty])}}function init(){SCENE={data:{wallet:{},contract:{}},specialObjects:{},updateStartTimesAndValues:{}};if(tokenHash){populatePalette();populateAbstractMaterials();populateAxisExtraShapes();overwriteAxis();logDebugMessage()}SCENE.camera=makeCamera();SCENE.scene=makeScene();SCENE.renderer=makeRenderer();for(let i of Axis){i.mainPivot=new THREE.Object3D;i.mainPivot.name=i.name;var a=[];for(let e in i.coneTypes){i.coneTypes[e][e]=true;a.push(i.coneTypes[e])}shuffle(a);i.axisArrayConeTypes=a;if(i.enableNegativeSpace){createNegativeSpace(i,undefined,true)}i.pivots=[];let n=i.growShapes.onStartup?i.growShapes.speed:undefined;for(let a in i.extraShapes){let t=i.extraShapes[a];for(let e=0;e<t.numberOfShapes;e++){if(t.cone){addConeToAxis(i,`cone${e}`,t,n,a)}else{addExtraShapeToAxis(i,`${a}${e}`,a,t,n)}}}let e=meanPositionOfPivots(i.pivots);let t=meanRotationOfPivots(i.pivots);i.centraRodPosition=e;i.centralRodRotation=t;if(i.addCentralRod){i.rodMaterial=new THREE.MeshBasicMaterial({color:i.centralRodColor,side:THREE.FrontSide,wireframe:false});const s=new THREE.BoxGeometry(i.centralRodWidth,i.centralRodLength,i.centralRodWidth);i.rod=new THREE.Mesh(s,i.rodMaterial);i.rod.position.set(e[0],e[1],e[2]);i.rod.rotation.z=t[2];i.mainPivot.add(i.rod)}SCENE.scene.add(i.mainPivot);if(!i.enabled){setAxisInvisibleAndDisabled(i)}}for(let e of Lights){makeLight(e);SCENE.scene.add(e.light)}if(enableWorldGradient){makeWorldPlane()}SCENE.renderer.render(SCENE.scene,SCENE.camera);if(enableShadows){SCENE.renderer.shadowMap.enabled=true;SCENE.renderer.shadowMap.type=THREE.PCFShadowMap}let n=new THREE.Clock;let i=0;let r=1/animationFPS;SCENE.cameraMovementSpeed={x:0,y:0,z:0};const o=e=>{requestAnimationFrame(o);i+=n.getDelta();animateFog();for(let a of Axis){if(a.mainPivot.userData.animationQueue&&a.mainPivot.userData.animationQueue.length>0){processAnimationQueue(a.mainPivot)}for(let t of a.pivots){processShrinkAndGrow(t);t.rotateY(THREE.MathUtils.degToRad(t.userData.rotationSpeed*i));if(t.userData.animationQueue&&t.userData.animationQueue.length>0){processAnimationQueue(t)}if(t.userData.animationLoop){processAnimationLoop(t)}for(let e of t.children){if(e.userData.animationQueue&&e.userData.animationQueue.length>0){processAnimationQueue(e)}if(e.userData.animationLoop){processAnimationLoop(e)}}}if(a.enableNegativeSpaceAnimation){animateAxisNegativeSpace(a,i)}try{if(a.clipPlanes){for(let e of a.clipPlanes){if(e.userData){if(e.userData.desiredConstant>e.constant){e.constant+=negativeSpaceAnimationSpeed}else if(e.userData.desiredConstant<e.constant){e.constant-=negativeSpaceAnimationSpeed}}}}}catch(t){console.error("Animating negative space failed")}}if(SCENE.worldPlane.userData.animationQueue&&SCENE.worldPlane.userData.animationQueue.length>0){processAnimationQueue(SCENE.worldPlane)}if(SCENE.camera.userData.animationQueue&&SCENE.camera.userData.animationQueue.length>0){processAnimationQueue(SCENE.camera)}if(enableWorldGradientAnimation){animateWorldPlane()}if(enableFog){processAnimationQueue(SCENE.scene.fog)}if(SCENE.cameraMovementSpeed.y!=0){SCENE.camera.position.y+=SCENE.cameraMovementSpeed.y;SCENE.cameraMovementSpeed.y*=.98}if(SCENE.cameraMovementSpeed.x!=0){SCENE.camera.position.x+=SCENE.cameraMovementSpeed.x;SCENE.cameraMovementSpeed.x*=.98}if(SCENE.cameraMovementSpeed.z!=0){SCENE.camera.position.z+=SCENE.cameraMovementSpeed.z;SCENE.cameraMovementSpeed.z*=.98}SCENE.renderer.render(SCENE.scene,SCENE.camera);i=i%r};requestAnimationFrame(o);function e(){let e=window.innerWidth/window.innerHeight;SCENE.camera.aspect=e;SCENE.renderer.setSize(window.innerWidth,window.innerHeight);SCENE.camera.updateProjectionMatrix()}window.addEventListener("resize",e,false);e();document.addEventListener("keydown",function(e){if(e.key==="o"){if(SCENE.camera.zoom>.6){SCENE.camera.zoom-=.003;SCENE.camera.updateProjectionMatrix()}}if(e.key==="i"){if(SCENE.camera.zoom<2.5){SCENE.camera.zoom+=.003;SCENE.camera.updateProjectionMatrix()}}})}INITIALUPDATE=true;if(LIVE_MODE){getThreeJS().then(t=>{eval(t.slice(156,t.length-22));initImprovedNoise();initOBJLoader();init();setTimeout(2e3,dataUpdate());setInterval(dataUpdate,12e3);setInterval(updateScene,12e3)})}else{initImprovedNoise();initOBJLoader();init();dataUpdate();setInterval(dataUpdate,12e3);setInterval(updateScene,12e3)}window.onkeydown=function(e){if(e.keyCode===77){document.querySelector("body").insertAdjacentHTML("afterend",`<div id="prompt-container" class="prompt-container"><p>Change node URL:</p><input id="prompt" class="prompt" value="${NODE_URLS[0]}"/></div>`)}else if(e.keyCode===13){p=document.getElementById("prompt");NODE_URLS=[p.value];console.log(NODE_URLS);pc=document.getElementById("prompt-container");pc.remove()}else if(e.keyCode===27){pc=document.getElementById("prompt-container");pc.remove()}};function hashString(t){let a=5381;for(let e=0;e<t.length;e++){a=a*33^t.charCodeAt(e)}return a>>>0}function rand(t,a,e=.001){if(t==a){return t}if(t>a){let e=t;t=a;a=e}const n=randomNumberGenerator.random();const i=(a-t)/e+e;const r=Math.floor(n*i)*e;return t+r}function randS(t,a,e=.001){if(t==a){return t}if(t>a){let e=t;t=a;a=e}const n=randomNumberGeneratorSeeded.random();const i=(a-t)/e+e;const r=Math.floor(n*i)*e;return t+r}function randFromRange(e){return rand(e[0],e[1],e[2])}function randFromRangeS(e){let t=randS(e[0],e[1],e[2]);return[t,t,1]}function randFromRangeS2(e){return randS(e[0],e[1],e[2])}function shuffle(t){for(let e=t.length-1;e>0;e--){const a=Math.floor(randomNumberGenerator.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t}function shuffleS(t){for(let e=t.length-1;e>0;e--){const a=Math.floor(randS(0,1,.01)*e);[t[e],t[a]]=[t[a],t[e]]}return t}function pick(e){return e[rand(0,e.length-1,1)]}function pickS(e){return e[randS(0,e.length-1,1)]}function pickS2(e){let t=JSON.parse(JSON.stringify(e));shuffleS(t);if(t.length==1){let e=t.pop();return[e,e]}v1=t.pop();v2=t.pop();v3=v2;while(v1==v2){if(t.length==0){v2=v3;break}v2=t.pop()}return[v1,v2]}function numberOfShapesMinMax(e){return Array.isArray(e)?randFromRangeS(e)[0]:e}function pickFromProbabilityArrayS(e){let t=JSON.parse(JSON.stringify(e));shuffleS(t);let a=0;let n=-1;let i=null;let r=randS(0,1,.01);for(let e=0;e<t.length;e++){a+=t[e][0];if(r<a){return t[e][1]}else if(t[e][0]>n){n=t[e][0];i=t[e]}}return i[1]}function pickFromProbabilityMapS(e){let t=JSON.parse(JSON.stringify(e));shuffleS(t);let a=0;let n=-1;let i=null;let r=randS(0,1,.01);for(let e=0;e<t.length;e++){a+=t[e].probability;if(r<a){return t[e]}else if(t[e].probability>n){n=t[e].probability;i=t[e]}}return i}function smallerRange(e,t){e=randFromRangeS(e);return[e[0]-t,e[0]+t,e[2]]}function overwriteAxis(){let e=randFromRangeS(hashOverwrites.axisAngle)[0];let t=randFromRangeS(hashOverwrites.axisAngle)[0];let n=shuffleS([[e-2,e+2,1],[e-2,e+2,1],[e-2,e+2,1],[t-2,t+2,1],[t-2,t+2,1],[t-2,t+2,1],[t-2,t+2,1]]);for(let a=0;a<Axis.length;a++){let e=Axis[a];let t=n.pop();e.name=`axis${a+1}`;e.axisAngle=t;e.originalAxisAngle=t;e.axisExtremeAngle=undefined;e.extremeAngleEnabledTimestamp=undefined;e.axisX=smallerRange(hashOverwrites.axisX,5);e.axisY=smallerRange(hashOverwrites.axisY,5);e.axisZ=smallerRange(hashOverwrites.axisZ,5)}}function populatePalette(){if(traitsPalette){SCENE.palette=palettes[traitsPalette[0]]}else{palettes=shuffleS(palettes);SCENE.palette=pickFromProbabilityMapS(palettes)}worldGradientColors=[[SCENE.palette.gradient[2],SCENE.palette.gradient[0]],[SCENE.palette.gradient[3],SCENE.palette.gradient[1]]];fogColor=pickS(SCENE.palette.colors.filter(e=>{return e!=SCENE.palette.gradient[0]&&e!=SCENE.palette.gradient[1]}));console.log(fogColor)}function populateAxisExtraShapes(){let t=Object.keys(materialTemplates);let a=-1;for(shapeType in extraShapes){a++;shapeParams=extraShapes[shapeType];shapeParams.originalNumberOfShapes=shapeParams.numberOfShapes;shapeParams.numberOfShapes=randS(shapeParams.numberOfShapes[0],shapeParams.numberOfShapes[1]||shapeParams.numberOfShapes[0],1);shapeParams.material=pickFromProbabilityArrayS(shapeParams.material);if(traitsObjects){for(let e=0;e<traitsObjects.length;e+=3){if(traitsObjects[e]==a){shapeParams.axisToBeAddedTo=[pick(shapeParams.axis)];shapeParams.material=t[traitsObjects[e+1]]}}}else{for(let e=0;e<Axis.length;e++){shapeParams.axisToBeAddedTo=[pick(shapeParams.axis)]}}if(shapeParams.extraAxis&&shapeParams.extraAxis.length>0){if(!shapeParams.axisToBeAddedTo){shapeParams.axisToBeAddedTo=[pick(shapeParams.extraAxis)]}else{shapeParams.axisToBeAddedTo.push(pick(shapeParams.extraAxis))}}if(shapeParams.secondColor){let e=pickS(SCENE.palette.colors);if(Array.isArray(e)){e=e[0]}shapeParams.secondColor=e}}for(shapeType in extraShapes){if(shapeType=="knot"){shapeParams=extraShapes[shapeType];if(Array.isArray(shapeParams.material)){shapeParams.material=pickFromProbabilityArrayS(shapeParams.material)}}}for(let e=0;e<Axis.length;e++){Axis[e].extraShapes={};for(shapeType in extraShapes){shapeParams=JSON.parse(JSON.stringify(extraShapes[shapeType]));if(shapeParams.axisToBeAddedTo&&shapeParams.axisToBeAddedTo.indexOf(e+1)>-1){if(!traitsObjects&&randS(0,1,.01)<1-shapeParams.probability){continue}Axis[e].extraShapes[shapeType]=shapeParams}}}}function populateAbstractMaterials(){for(let u in materialTemplates){let t=materialTemplates[u];t={color:t[0],wireframe:t[2],shininess:t[1],enableTexture:t[3],textureColorVariant:pickS(t[4]),textureSize:t[13],textureNoiseSize:t[14],textureBase:t[11],textureMultiplier:t[12],textureBumpAmount:t[16],enableTextureBump:t[15],textureOffset:t[10],textureScale:t[8],textureRecolor:t[7],textureRotation:t[9],useTextureTransparency:t[6],textureBumpVariant:t[5]};let e=pickS2(SCENE.palette.colors);let a=e[0];let n=e[1];t.color=a;t.textureRecolor=n;let i=[undefined,undefined];let r=t.color;let o=false;if(typeof t.wireframe=="boolean"){o=t.wireframe}else{o=randS(0,1,.01)>1-t.wireframe;console.log(t.wireframe,o)}let s=t.shininess;let l=undefined;if(typeof t.enableTexture=="number"){t.enableTexture=randS(0,1,.001)>1-t.enableTexture}if(t.enableTexture){if(["simple","perlin3","simplex3"].indexOf(t.textureColorVariant)>=0){let e=makePerlinTexture(t.textureSize[0],t.textureSize[1],t.textureNoiseSize[0],t.textureNoiseSize[1],t.textureBase,t.textureMultiplier,true,t.textureBumpAmount,t.textureColorVariant);i[0]=e[0];if(t.enableTextureBump){i[1]=e[1]}}else if(t.textureColorVariant in base64Textures){let e=loadTextureRecolor(t.textureColorVariant,t.textureOffset[0],t.textureOffset[1],t.textureScale[0],t.textureScale[1],t.textureRecolor,r,t.textureRotation);if(t.useTextureTransparency){l=loadTextureRecolor(t.textureColorVariant,t.textureOffset[0],t.textureOffset[1],t.textureScale[0],t.textureScale[1],"#FFFFFF","#000000",t.textureRotation)}i[0]=e;if(t.enableTextureBump){if(t.textureColorVariant==t.textureBumpVariant){i[1]=e}else{let e=makePerlinTexture(t.textureSize[0],t.textureSize[1],t.textureNoiseSize[0],t.textureNoiseSize[1],t.textureBase,t.textureMultiplier,true,t.textureBumpAmount,t.textureColorVariant);i[1]=e[0]}}}}let c={type:"phong",color:r,side:THREE.DoubleSide,wireframe:o,shininess:s,map:i[0],bumpMap:i[1],alphaMap:l};let d=makeMaterial(c);d.userData.name=u;materialTemplates[u]=d}}function vertexIndexSequence(i){i-=1;let r=[];for(let n=0;n<i;n++){let e=n;let t=n+1;let a=i-n;if(t==a){t++}r=r.concat(e,t,a)}return r}function makeExtrudeShapeMesh(e,t,a,n){function i(t){let a=new THREE.Shape;for(let e=0;e<t.length;e++){if(e==0){a.moveTo(t[e][0],t[e][1])}else{a.lineTo(t[e][0],t[e][1])}}return a}let r=i(e);if(t.length>0){let e=i(t);r.holes.push(e)}let o=new THREE.ExtrudeGeometry(r,a);let s=new THREE.Mesh(o,n);return s}function makeFrame(e,t,a,n,i,r,o,s){let l=[[t,a],[t,-a],[-t,-a],[-t,a]];let c={steps:2,depth:i,bevelEnabled:false};let d=[];for(let a of l){let e=a[0]<0?a[0]+n:a[0]-n;let t=a[1]<0?a[1]+n:a[1]-n;d.push([e,t])}let u=makeExtrudeShapeMesh(l,d,c,e);if(o){u.position.set(o[0],o[1],o[2])}if(r){u.scale.set(r[0],r[1],r[2])}if(s){u.rotation.set(THREE.MathUtils.degToRad(s[0]),THREE.MathUtils.degToRad(s[1]),THREE.MathUtils.degToRad(s[2]))}return u}function makeRectangle(e,t,a,n,i,r,o){let s=[[t,a],[t,-a],[-t,-a],[-t,a]];let l={steps:2,depth:n,bevelEnabled:false};let c=makeExtrudeShapeMesh(s,[],l,e);if(r){c.position.set(r[0],r[1],r[2])}if(i){c.scale.set(i[0],i[1],i[2])}if(o){c.rotation.set(THREE.MathUtils.degToRad(o[0]),THREE.MathUtils.degToRad(o[1]),THREE.MathUtils.degToRad(o[2]))}return c}function makeArrow(e,t,a,n,i,r,o,s,l=0){if(l==0){var c=[[4.23,.1],[.65,8.65],[-3.48,-.71],[-.4,.84],[-.97,-6.59],[.73,-6.52],[1.02,1.08]]}else if(l==1){var c=[[-4-.13,0-1],[.65,8.65],[-3.48,-.71],[-.4,-.84],[-.07,-.09],[.73,-.52],[1.02,1.08]]}else if(l==2){var c=[[-4-.13,0-1],[.65,1.55,8.65,3.56,.22],[-3.48,-.71],[-.4,-.84],[-.07,-.09],[.73,-.52],[1.02,1.08]]}else if(l==3){var c=[[-14-.13,10-1],[.65,-1.55,8.65,-3.56,.22],[-13.48,10.71],[-20.4,-.84],[-.07,-.09],[2.73,-.52],[1.02,1.08]]}let d={steps:2,depth:t,bevelEnabled:true,bevelThickness:a,bevelSize:n,bevelOffset:0,bevelSegments:i};let u=makeExtrudeShapeMesh(c,[],d,e);if(o){u.position.set(o[0],o[1],o[2])}if(r){u.scale.set(r[0],r[1],r[2])}if(s){u.rotation.set(THREE.MathUtils.degToRad(s[0]),THREE.MathUtils.degToRad(s[1]),THREE.MathUtils.degToRad(s[2]))}return u}function makeKnot(e,t,a,n,i,r,o,s,l,c){const d=new THREE.TorusKnotGeometry(t,a,n,i,r,o);d.computeVertexNormals();const u=new THREE.Mesh(d,e);if(l){u.position.set(l[0],l[1],l[2])}if(s){u.scale.set(s[0],s[1],s[2])}if(c){u.rotation.set(THREE.MathUtils.degToRad(c[0]),THREE.MathUtils.degToRad(c[1]),THREE.MathUtils.degToRad(c[2]))}return u}function makeMaterial(e={type:undefined,color:undefined,side:undefined,wireframe:undefined,shininess:undefined,map:undefined,bumpMap:undefined,alphaMap:undefined}){let t={color:e.color?e.color:"#FFFFFF",side:e.side,wireframe:e.wireframe,shininess:e.shininess};if(e.map){t.map=e.map;if(e.alphaMap){t.alphaMap=e.alphaMap;t.alphaTest=.8;t.premultipliedAlpha=true}}if(e.bumpMap){t.bumpMap=e.bumpMap}let a=new THREE.MeshPhongMaterial(t);a.userData.used=false;return a}function loadTextureRecolor(e,t,a,n,i,r=undefined,o=undefined,s=undefined){var l=document.createElement("canvas");l.width=128;l.height=128;var c=l.getContext("2d");var d=new THREE.Texture(l);var u=new Image;u.src=`data:image/png;base64,${base64Textures[e]}`;u.onload=function(){c.globalCompositeOperation="copy";c.drawImage(u,0,0,l.width,l.height);if(r){c.globalCompositeOperation="source-in";c.fillStyle=r;c.fillRect(0,0,l.width,l.height)}c.globalCompositeOperation="destination-atop";c.fillStyle=o;c.fillRect(0,0,l.width,l.height);d.wrapS=THREE.RepeatWrapping;d.wrapT=THREE.RepeatWrapping;if(t&&a){d.offset.set(t,a)}if(n&&i){d.repeat.set(n,i)}if(s){d.rotation=THREE.MathUtils.degToRad(s)}d.needsUpdate=true};return d}function generateHeight(t,e){let a=Math.PI/4;window.Math.random=function(){const e=Math.sin(a++)*1e4;return e-Math.floor(e)};const n=t*e,i=new Uint8Array(n);const r=new THREE.ImprovedNoise,o=Math.random()*100;let s=1;for(let e=0;e<4;e++){for(let e=0;e<n;e++){const l=e%t,c=~~(e/t);i[e]+=Math.abs(r.noise(l/s,c/s,o)*s*1.75)}s*=5}return i}function makeTerrain(e,t,n,i,a,r,o,s=0,l,c){const d=t,u=n;if(s==0){const h=generateHeight(d,u);var p=new THREE.PlaneGeometry(t,n,d-1,u-1);const E=p.attributes.position.array;p.rotateX(-Math.PI/2);for(let e=0,t=0,a=E.length;e<a;e++,t+=3){E[t+1]=h[e]*i}}else if(s==1){var p=new THREE.BoxGeometry(t,n,c,d-1,u-1,1);p.rotateX(-Math.PI/2);const E=p.attributes.position.array;let a={};for(let t=0;t<E.length-3;t++){let e=`${E[t]}_${E[t+1]}_${E[t+2]}`;if(a[e]){a[e].push(t)}else{a[e]=[t]}}let i=[];for(let e of Object.keys(a)){if(a[e].length>1){i.push(a[e])}}for(let e=0,n=0,t=E.length;e<t;e++,n+=3){let e=false;let a=randFromRange(l);for(let t=0;t<i.length;t++){if(i[t]&&i[t].indexOf(n)>-1){for(let e of i[t]){E[e+1]+=a}e=true}}if(!e){E[n+1]+=randFromRange(l)}}}let f=new THREE.Mesh(p,e);let m=i*100;if(r){f.position.set(r[0]-d/10,r[1]-m,r[2])}if(a){f.scale.set(a[0],a[1],a[2])}if(o){f.rotation.set(THREE.MathUtils.degToRad(o[0]),THREE.MathUtils.degToRad(o[1]),THREE.MathUtils.degToRad(o[2]))}return f}function makeCloud(t,a,n,i,r,o,e,s,l){let c=new THREE.Group;const d=new THREE.SphereGeometry(1,16,16);for(let e=0;e<r;e++){const u=new THREE.Mesh(d,t);const p=Math.random()*a;const f=Math.random()*n;const m=Math.random()*i;u.position.set(p,f,m);let e=randFromRange(o);u.scale.set(e,e,e);c.add(u)}if(s){c.position.set(s[0],s[1],s[2])}if(e){c.scale.set(e[0],e[1],e[2])}if(l){c.rotation.set(THREE.MathUtils.degToRad(l[0]),THREE.MathUtils.degToRad(l[1]),THREE.MathUtils.degToRad(l[2]))}return c}function makeAnimationForQueue(e,t,a,n,i,r=.3){i=i<0?i*-1:i;let o={attribute:e,from:t,current:t,to:a,"final":n,speed:i,counter:0,curve:r};if(e=="color"){t=typeof t==="string"?t:"#"+t.getHex().toString(16);a=Array.isArray(a)?a:[a];o.colorInterpolator=new ColorInterpolator([t].concat(a),i)}return o}function processAnimationQueue(t){if(t.userData.animationQueue==undefined||t.userData.animationQueue.length==0){return}if(!t.userData.animationQueue[0].direction){if(Array.isArray(t.userData.animationQueue[0].from)){t.userData.animationQueue[0].direction=[];for(let e=0;e<t.userData.animationQueue[0].from.length;e++){t.userData.animationQueue[0].direction.push(t.userData.animationQueue[0].from[e]>t.userData.animationQueue[0].to[e]?-1:1)}}else{t.userData.animationQueue[0].direction=t.userData.animationQueue[0].from>t.userData.animationQueue[0].to?-1:1}}let a=t.userData.animationQueue[0];if(a.counter>1e4){t.userData.animationQueue.splice(0,1);return}else{a.counter++}if(a.attribute=="color"){if(t.color){let e=new THREE.Color(a.colorInterpolator.nextColor());t.color=e;if(a.colorInterpolator.looped){t.userData.animationQueue.splice(0,1);return}}else{console.error("Shape has no color attribute")}return}if(Array.isArray(a.from)){for(let e=0;e<a.from.length;e++){if(a.direction[e]==-1&&a.current[e]<=a.to[e]||a.direction[e]==1&&a.current[e]>=a.to[e]){t.userData.animationQueue.splice(0,1);return}if(a.from[e]>a.to[e]){a.current[e]-=a.speed}else{a.current[e]+=a.speed}}}else{if(a.attribute=="scale"){a.current=Math.max(t.scale.x,t.scale.y,t.scale.z)}else if(a.attribute=="rotationSpeed"){a.current=t.userData.rotationSpeed}else if(a.attribute=="distance"){a.current=t.position.x}else if(a.attribute=="x"){a.current=t.position.x}else if(a.attribute=="y"){a.current=t.position.y}else if(a.attribute=="z"){a.current=t.position.z}else if(a.attribute=="near-far"){a.current[0]=t.near;a.current[1]=t.far}else if(a.attribute=="angleX"){a.current=t.rotation.x}else if(a.attribute=="angleY"){a.current=t.rotation.y}else if(a.attribute=="angleZ"){a.current=t.rotation.z}if(a.direction==-1&&a.current<=a.to||a.direction==1&&a.current>=a.to){t.userData.animationQueue.splice(0,1);return}if(a.from>=a.to){a.current-=a.speed}else{a.current+=a.speed}}if(t.userData.name=="camera"){a.current=Number(a.current.toFixed(5))}if(a.attribute=="scale"){if(Array.isArray(a.from)){t.scale.set(a.current[0],a.current[1],a.current[2])}else{t.scale.set(a.current,a.current,a.current)}if(Array.isArray(t.material)){for(let e=0;e<t.material.length;e++){if(t.material[e].map){t.material[e].map.needsUpdate=true}}}else{if(t.material&&t.material.map){t.material.map.needsUpdate=true}}}else if(a.attribute=="rotationSpeed"){t.userData.rotationSpeed=a.current}else if(a.attribute=="distance"){t.position.x=a.current}else if(a.attribute=="x"){t.position.x=a.current}else if(a.attribute=="y"){t.position.y=a.current}else if(a.attribute=="z"){t.position.z=a.current}else if(a.attribute=="near-far"){t.near=a.current[0];t.far=a.current[1]}else if(a.attribute=="angleX"){t.rotation.x=a.current}else if(a.attribute=="angleY"){t.rotation.y=a.current}else if(a.attribute=="angleZ"){t.rotation.z=a.current}}function processAnimationLoop(a){if(a.userData.animationLoop.length==0){return}for(let t of a.userData.animationLoop){if(t.attribute=="color"){if(a.color){let e=new THREE.Color(t.colorInterpolator.nextColor());a.color=e;if(t.colorInterpolator.looped){a.userData.animationQueue.splice(0,1);return}}else{console.error("Shape has no color attribute")}return}if(t.attribute=="scale"){t.current=Math.max(a.scale.x,a.scale.y,a.scale.z)}else if(t.attribute=="rotationSpeed"){t.current=a.userData.rotationSpeed}else if(t.attribute=="distance"){t.current=a.position.x}else if(t.attribute=="x"){t.current=a.position.x}else if(t.attribute=="y"){t.current=a.position.y}else if(t.attribute=="z"){t.current=a.position.z}else if(t.attribute=="near-far"){t.current[0]=a.near;t.current[1]=a.far}else if(t.attribute=="angleX"){t.current=a.rotation.x}else if(t.attribute=="angleY"){t.current=a.rotation.y}else if(t.attribute=="angleZ"){t.current=a.rotation.z}if(t.from>=t.to){t.current-=t.speed}else{t.current+=t.speed}if(t.attribute=="scale"){a.scale.set(t.current,t.current,t.current);if(Array.isArray(a.material)){for(let e=0;e<a.material.length;e++){if(a.material[e].map){a.material[e].map.needsUpdate=true}}}else{if(a.material.map){a.material.map.needsUpdate=true}}}else if(t.attribute=="rotationSpeed"){a.userData.rotationSpeed=t.current}else if(t.attribute=="distance"){a.position.x=t.current}else if(t.attribute=="x"){a.position.x=t.current}else if(t.attribute=="y"){a.position.y=t.current}else if(t.attribute=="z"){a.position.z=t.current}else if(t.attribute=="near-far"){a.near=t.current[0];a.far=t.current[1]}else if(t.attribute=="angleX"){a.rotation.x=t.current}else if(t.attribute=="angleY"){a.rotation.y=t.current}else if(t.attribute=="angleZ"){a.rotation.z=t.current}}}function interpolateColors(e,t,n){const a=e=>[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)];const i=e=>"#"+e.map(e=>Math.round(e).toString(16).padStart(2,"0")).join("");const r=a(e);const o=a(t);const s=r.map((e,t)=>{const a=o[t];return Math.round(e+(a-e)*n)});return i(s)}class ColorInterpolator{constructor(e,t){this.colorsArray=e;this.activePairIndex=[0,1];this.speed=t;this.state=0;this.looped=false}nextColor(){let e=interpolateColors(this.colorsArray[this.activePairIndex[0]],this.colorsArray[this.activePairIndex[1]],this.state);this.state+=this.speed;if(this.state>=1){this.state=0;if(this.activePairIndex[1]>=this.colorsArray.length){this.activePairIndex=this.activePairIndex.map(e=>e+1)}else{this.activePairIndex=[0,1];this.looped=true}}return e}}function createConeGeometry(e,t,o,s,l,a){if(!l){l={}}const n=new THREE.BufferGeometry;let c=[];let i=[];const d=0;const u=e;for(let r=0;r<=s;r++){const E=r/s*t;const g=u+E/t*(d-u);for(let i=0;i<=o;i++){let t=E;let e=i/o*Math.PI*2;let a=g*Math.cos(e);let n=g*Math.sin(e);if(l.curveBaseCone){let e=(s-r)*l.baseCurveFactor;t-=Math.abs(Math.pow(a,2))*e}c.push(a,t,n)}}for(let t=0;t<s;t++){for(let e=0;e<o;e++){const S=t*(o+1)+e;const T=S+o+1;if(e==0){var r=S;var p=T}if(e<o-1){i.push(S,T,S+1);i.push(T,T+1,S+1)}else{i.push(S,T,r);i.push(T,p,r)}}}let f=0;let m=100;let h=0;for(let e=2;e<o*3;e+=3){h++;if(c[e]<f){f=h;m=c[e]}}c.indexOf(Math.min(c.slice(0,o)));if(!a){c=c.slice(0,o*3).concat(c);i=i.map(e=>e+o);let t=Math.abs(o/2);if(l.curveBaseCone){i=i.concat(vertexIndexSequence(o))}else{for(let e=0;e<t;e+=1){i.push(e,e+1,t);i.push(e+t,e+t+1,t)}}}n.setAttribute("position",new THREE.Float32BufferAttribute(c,3));n.deleteAttribute("normal");n.deleteAttribute("uv");n.setIndex(i);n.computeVertexNormals();return n}function makeCone(e,t,a,n,i,r,o,s,l,c){const d=createConeGeometry(t,a,n,i,c,r);const u=new THREE.ConeGeometry(t,a,n,i);d.setAttribute("uv",u.getAttribute("uv"));d.uvsNeedUpdate=true;d.normalsNeedUpdate=true;const p=new THREE.Mesh(d,e);if(s){p.position.set(s[0],s[1],s[2])}if(o){p.scale.set(o[0],o[1],o[2])}if(l){p.rotation.set(THREE.MathUtils.degToRad(l[0]*2),THREE.MathUtils.degToRad(l[1]),THREE.MathUtils.degToRad(l[2]))}if(enableShadows){p.castShadow=true;p.receiveShadow=true}p.userData.material=e;return p}function meanPositionOfPivots(e){let t=e.map(e=>e.position.x);t=t.reduce((e,t)=>e+t,0)/t.length;let a=e.map(e=>e.position.y);a=a.reduce((e,t)=>e+t,0)/a.length;let n=e.map(e=>e.position.z);n=n.reduce((e,t)=>e+t,0)/n.length;return[t,a,n]}function meanRotationOfPivots(e){let t=e.map(e=>e.rotation.x);t=t.reduce((e,t)=>e+t,0)/t.length;let a=e.map(e=>e.rotation.y);a=a.reduce((e,t)=>e+t,0)/a.length;let n=e.map(e=>e.rotation.z);n=n.reduce((e,t)=>e+t,0)/n.length;return[t,a,n]}function createNegativeSpace(a,e=undefined,t=true,n=0,i=0){a.creatingNegativeSpace=true;setTimeout(()=>{a.creatingNegativeSpace=false},3e4);let r=randFromRange(a.negativeSpaceX);let o=randFromRange(a.negativeSpaceY);let s=randFromRange(a.negativeSpaceZ);let l=randFromRange(a.negativeSpaceSizeX);let c=randFromRange(a.negativeSpaceSizeY);let d=randFromRange(a.negativeSpaceSizeZ);if(e==undefined){e=pick(a.negativeSpaceType)}let u=undefined;if(e=="triangle"){u=[new THREE.Plane(new THREE.Vector3(1,.5,0),0),new THREE.Plane(new THREE.Vector3(-1,.5,0),0),new THREE.Plane(new THREE.Vector3(0,-1,0),0),new THREE.Plane(new THREE.Vector3(0,0,-1),0),new THREE.Plane(new THREE.Vector3(0,0,1),0)];u[0].translate(new THREE.Vector3(l+r,0,0));u[1].translate(new THREE.Vector3(-l+r,0,0));u[2].translate(new THREE.Vector3(0,-c+o,0));u[3].translate(new THREE.Vector3(0,0,-d+s));u[4].translate(new THREE.Vector3(0,0,d+s))}else if(e=="triangle_flip"){u=[new THREE.Plane(new THREE.Vector3(1,-.5,0),0),new THREE.Plane(new THREE.Vector3(-1,-.5,0),0),new THREE.Plane(new THREE.Vector3(0,1,0),0),new THREE.Plane(new THREE.Vector3(0,0,-1),0),new THREE.Plane(new THREE.Vector3(0,0,1),0)];u[0].translate(new THREE.Vector3(l+r,0,0));u[1].translate(new THREE.Vector3(-l+r,0,0));u[2].translate(new THREE.Vector3(0,c+o,0));u[3].translate(new THREE.Vector3(0,0,-d+s));u[4].translate(new THREE.Vector3(0,0,d+s))}else if(e=="diamond"){u=[new THREE.Plane(new THREE.Vector3(1,-.5,0),0),new THREE.Plane(new THREE.Vector3(-1,.5,0),0),new THREE.Plane(new THREE.Vector3(.5,-1,0),0),new THREE.Plane(new THREE.Vector3(-.5,1,0),0),new THREE.Plane(new THREE.Vector3(0,0,-1),0),new THREE.Plane(new THREE.Vector3(0,0,1),0)];u[0].translate(new THREE.Vector3(l+r,0,0));u[1].translate(new THREE.Vector3(-l+r,0,0));u[2].translate(new THREE.Vector3(0,-c+o,0));u[3].translate(new THREE.Vector3(0,c+o,0));u[4].translate(new THREE.Vector3(0,0,-d+s));u[5].translate(new THREE.Vector3(0,0,d+s));var p=new THREE.Quaternion;p.setFromAxisAngle(new THREE.Vector3(0,0,1),THREE.MathUtils.degToRad(i));u[0].normal.applyQuaternion(p);u[1].normal.applyQuaternion(p);u[2].normal.applyQuaternion(p);u[3].normal.applyQuaternion(p)}let f=e=="triangle"?3:4;for(let e=0;e<f;e++){u[e].userData={originalConstant:u[e].constant,currentConstrain:t?5:u[e].constant,desiredConstant:u[e].constant};if(t){u[e].constant=5}}a.clipPlanes=u;nShapesLeftOutside=0;if(a.pivots){for(let e of a.pivots){if(nShapesLeftOutside<n&&rand(0,1,.01)>.5){nShapesLeftOutside++;continue}for(let t of e.children){if(t.material){t.material.clippingPlanes=a.clipPlanes;t.material.clipIntersection=true}for(let e of t.children){if(e.material){e.material.clippingPlanes=a.clipPlanes;e.material.clipIntersection=true}}}}}console.log(nShapesLeftOutside,"objects left outside of negative space on axis",a.name)}function removeNegativeSpace(t){t.removingNegativeSpace=true;for(let e=0;e<t.clipPlanes.length;e++){if(t.clipPlanes[e].userData){t.clipPlanes[e].userData.desiredConstant=5}}setTimeout(()=>{if(t.pivots){for(let e of t.pivots){for(let t of e.children){if(t.material){t.material.clippingPlanes=[];t.material.needsUpdate=true}for(let e of t.children){if(e.material){e.material.clippingPlanes=[];e.material.needsUpdate=true}}}}}for(let e=0;e<t.clipPlanes.length;e++){SCENE.scene.remove(t.clipPlanes[e])}t.clipPlanes=undefined;delete t.clipPlanes;t.removingNegativeSpace=false},2e4)}function initOBJLoader(){const _=/^[og]\s*(.+)?/;const F=/^mtllib /;const j=/^usemtl /;const I=/^usemap /;const L=/\s+/;const r=new THREE.Vector3;const o=new THREE.Vector3;const s=new THREE.Vector3;const l=new THREE.Vector3;const c=new THREE.Vector3;const Q=new THREE.Color;function z(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===false){this.object.name=e;this.object.fromDeclaration=t!==false;return}const a=this.object&&typeof this.object.currentMaterial==="function"?this.object.currentMaterial():undefined;if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}this.object={name:e||"",fromDeclaration:t!==false,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:false},materials:[],smooth:true,startMaterial:function(e,t){const a=this._finalize(false);if(a&&(a.inherited||a.groupCount<=0)){this.materials.splice(a.index,1)}const n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:a!==undefined?a.smooth:this.smooth,groupStart:a!==undefined?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:false,clone:function(e){const t={index:typeof e==="number"?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:false};t.clone=this.clone.bind(t);return t}};this.materials.push(n);return n},currentMaterial:function(){if(this.materials.length>0){return this.materials[this.materials.length-1]}return undefined},_finalize:function(e){const t=this.currentMaterial();if(t&&t.groupEnd===-1){t.groupEnd=this.geometry.vertices.length/3;t.groupCount=t.groupEnd-t.groupStart;t.inherited=false}if(e&&this.materials.length>1){for(let e=this.materials.length-1;e>=0;e--){if(this.materials[e].groupCount<=0){this.materials.splice(e,1)}}}if(e&&this.materials.length===0){this.materials.push({name:"",smooth:this.smooth})}return t}};if(a&&a.name&&typeof a.clone==="function"){const n=a.clone(0);n.inherited=true;this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}},parseVertexIndex:function(e,t){const a=parseInt(e,10);return(a>=0?a-1:a+t/3)*3},parseNormalIndex:function(e,t){const a=parseInt(e,10);return(a>=0?a-1:a+t/3)*3},parseUVIndex:function(e,t){const a=parseInt(e,10);return(a>=0?a-1:a+t/2)*2},addVertex:function(e,t,a){const n=this.vertices;const i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]);i.push(n[t+0],n[t+1],n[t+2]);i.push(n[a+0],n[a+1],n[a+2])},addVertexPoint:function(e){const t=this.vertices;const a=this.object.geometry.vertices;a.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;const a=this.object.geometry.vertices;a.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,a){const n=this.normals;const i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]);i.push(n[t+0],n[t+1],n[t+2]);i.push(n[a+0],n[a+1],n[a+2])},addFaceNormal:function(e,t,a){const n=this.vertices;const i=this.object.geometry.normals;r.fromArray(n,e);o.fromArray(n,t);s.fromArray(n,a);c.subVectors(s,o);l.subVectors(r,o);c.cross(l);c.normalize();i.push(c.x,c.y,c.z);i.push(c.x,c.y,c.z);i.push(c.x,c.y,c.z)},addColor:function(e,t,a){const n=this.colors;const i=this.object.geometry.colors;if(n[e]!==undefined)i.push(n[e+0],n[e+1],n[e+2]);if(n[t]!==undefined)i.push(n[t+0],n[t+1],n[t+2]);if(n[a]!==undefined)i.push(n[a+0],n[a+1],n[a+2])},addUV:function(e,t,a){const n=this.uvs;const i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]);i.push(n[t+0],n[t+1]);i.push(n[a+0],n[a+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0);e.push(0,0);e.push(0,0)},addUVLine:function(e){const t=this.uvs;const a=this.object.geometry.uvs;a.push(t[e+0],t[e+1])},addFace:function(e,t,a,n,i,r,o,s,l){const c=this.vertices.length;let d=this.parseVertexIndex(e,c);let u=this.parseVertexIndex(t,c);let p=this.parseVertexIndex(a,c);this.addVertex(d,u,p);this.addColor(d,u,p);if(o!==undefined&&o!==""){const f=this.normals.length;d=this.parseNormalIndex(o,f);u=this.parseNormalIndex(s,f);p=this.parseNormalIndex(l,f);this.addNormal(d,u,p)}else{this.addFaceNormal(d,u,p)}if(n!==undefined&&n!==""){const m=this.uvs.length;d=this.parseUVIndex(n,m);u=this.parseUVIndex(i,m);p=this.parseUVIndex(r,m);this.addUV(d,u,p);this.object.geometry.hasUVIndices=true}else{this.addDefaultUV()}},addPointGeometry:function(a){this.object.geometry.type="Points";const n=this.vertices.length;for(let e=0,t=a.length;e<t;e++){const i=this.parseVertexIndex(a[e],n);this.addVertexPoint(i);this.addColor(i)}},addLineGeometry:function(a,n){this.object.geometry.type="Line";const i=this.vertices.length;const r=this.uvs.length;for(let e=0,t=a.length;e<t;e++){this.addVertexLine(this.parseVertexIndex(a[e],i))}for(let e=0,t=n.length;e<t;e++){this.addUVLine(this.parseUVIndex(n[e],r))}}};e.startObject("",false);return e}class e extends THREE.Loader{constructor(e){super(e);this.materials=null}load(a,n,e,i){const r=this;const t=new THREE.FileLoader(this.manager);t.setPath(this.path);t.setRequestHeader(this.requestHeader);t.setWithCredentials(this.withCredentials);t.load(a,function(e){try{n(r.parse(e))}catch(t){if(i){i(t)}else{console.error(t)}r.manager.itemError(a)}},e,i)}setMaterials(e){this.materials=e;return this}parse(e){const n=new z;if(e.indexOf("\r\n")!==-1){e=e.replace(/\r\n/g,"\n")}if(e.indexOf("\\\n")!==-1){e=e.replace(/\\\n/g,"")}const a=e.split("\n");let i=[];for(let e=0,t=a.length;e<t;e++){const o=a[e].trimStart();if(o.length===0)continue;const s=o.charAt(0);if(s==="#")continue;if(s==="v"){const l=o.split(L);switch(l[0]){case"v":n.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));if(l.length>=7){Q.setRGB(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6])).convertSRGBToLinear();n.colors.push(Q.r,Q.g,Q.b)}else{n.colors.push(undefined,undefined,undefined)}break;case"vn":n.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":n.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(s==="f"){const c=o.slice(1).trim();const d=c.split(L);const u=[];for(let e=0,t=d.length;e<t;e++){const f=d[e];if(f.length>0){const m=f.split("/");u.push(m)}}const p=u[0];for(let e=1,t=u.length-1;e<t;e++){const h=u[e];const E=u[e+1];n.addFace(p[0],h[0],E[0],p[1],h[1],E[1],p[2],h[2],E[2])}}else if(s==="l"){const g=o.substring(1).trim().split(" ");let a=[];const S=[];if(o.indexOf("/")===-1){a=g}else{for(let e=0,t=g.length;e<t;e++){const T=g[e].split("/");if(T[0]!=="")a.push(T[0]);if(T[1]!=="")S.push(T[1])}}n.addLineGeometry(a,S)}else if(s==="p"){const c=o.slice(1).trim();const v=c.split(" ");n.addPointGeometry(v)}else if((i=_.exec(o))!==null){const x=(" "+i[0].slice(1).trim()).slice(1);n.startObject(x)}else if(j.test(o)){n.object.startMaterial(o.substring(7).trim(),n.materialLibraries)}else if(F.test(o)){n.materialLibraries.push(o.substring(7).trim())}else if(I.test(o)){console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.')}else if(s==="s"){i=o.split(" ");if(i.length>1){const A=i[1].trim().toLowerCase();n.object.smooth=A!=="0"&&A!=="off"}else{n.object.smooth=true}const D=n.object.currentMaterial();if(D)D.smooth=n.object.smooth}else{if(o==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+o+'"')}}n.finalize();const r=new THREE.Group;r.materialLibraries=[].concat(n.materialLibraries);const t=!(n.objects.length===1&&n.objects[0].geometry.vertices.length===0);if(t===true){for(let t=0,e=n.objects.length;t<e;t++){const R=n.objects[t];const b=R.geometry;const N=R.materials;const C=b.type==="Line";const y=b.type==="Points";let a=false;if(b.vertices.length===0)continue;const w=new THREE.BufferGeometry;w.setAttribute("position",new THREE.Float32BufferAttribute(b.vertices,3));if(b.normals.length>0){w.setAttribute("normal",new THREE.Float32BufferAttribute(b.normals,3))}if(b.colors.length>0){a=true;w.setAttribute("color",new THREE.Float32BufferAttribute(b.colors,3))}if(b.hasUVIndices===true){w.setAttribute("uv",new THREE.Float32BufferAttribute(b.uvs,2))}const P=[];for(let t=0,e=N.length;t<e;t++){const M=N[t];const O=M.name+"_"+M.smooth+"_"+a;let e=n.materials[O];if(this.materials!==null){e=this.materials.create(M.name);if(C&&e&&!(e instanceof THREE.LineBasicMaterial)){const U=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(U,e);U.color.copy(e.color);e=U}else if(y&&e&&!(e instanceof THREE.PointsMaterial)){const k=new THREE.PointsMaterial({size:10,sizeAttenuation:false});THREE.Material.prototype.copy.call(k,e);k.color.copy(e.color);k.map=e.map;e=k}}if(e===undefined){if(C){e=new THREE.LineBasicMaterial}else if(y){e=new THREE.PointsMaterial({size:1,sizeAttenuation:false})}else{e=new THREE.MeshPhongMaterial({color:"#000000"})}e.name=M.name;e.flatShading=M.smooth?false:true;e.vertexColors=a;n.materials[O]=e}P.push(e)}let e;if(P.length>1){for(let e=0,t=N.length;e<t;e++){const M=N[e];w.addGroup(M.groupStart,M.groupCount,e)}if(C){e=new THREE.LineSegments(w,P)}else if(y){e=new THREE.Points(w,P)}else{e=new THREE.Mesh(w,P)}}else{if(C){e=new THREE.LineSegments(w,P[0])}else if(y){e=new THREE.Points(w,P[0])}else{e=new THREE.Mesh(w,P[0])}}e.name=R.name;r.add(e)}}else{if(n.vertices.length>0){const D=new THREE.PointsMaterial({size:1,sizeAttenuation:false});const w=new THREE.BufferGeometry;w.setAttribute("position",new THREE.Float32BufferAttribute(n.vertices,3));if(n.colors.length>0&&n.colors[0]!==undefined){w.setAttribute("color",new THREE.Float32BufferAttribute(n.colors,3));D.vertexColors=true}const H=new THREE.Points(w,D);r.add(H)}}return r}}THREE.OBJLoader=e}function initImprovedNoise(){const x=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let e=0;e<256;e++){x[256+e]=x[e]}function D(e){return e*e*e*(e*(e*6-15)+10)}function A(e,t,a){return t+e*(a-t)}function R(e,t,a,n){const i=e&15;const r=i<8?t:a,o=i<4?a:i==12||i==14?t:n;return((i&1)==0?r:-r)+((i&2)==0?o:-o)}class e{noise(e,t,a){const n=Math.floor(e),i=Math.floor(t),r=Math.floor(a);const o=n&255,s=i&255,l=r&255;e-=n;t-=i;a-=r;const c=e-1,d=t-1,u=a-1;const p=D(e),f=D(t),m=D(a);const h=x[o]+s,E=x[h]+l,g=x[h+1]+l,S=x[o+1]+s,T=x[S]+l,v=x[S+1]+l;return A(m,A(f,A(p,R(x[E],e,t,a),R(x[T],c,t,a)),A(p,R(x[g],e,d,a),R(x[v],c,d,a))),A(f,A(p,R(x[E+1],e,t,u),R(x[T+1],c,t,u)),A(p,R(x[g+1],e,d,u),R(x[v+1],c,d,u))))}}THREE.ImprovedNoise=e}function stringToHexadecimal(t){let a="";for(let e=0;e<t.length;e++){const n=t.charCodeAt(e).toString(16);a+=("00"+n).slice(-2)}return a}async function callProvider(e){callPayload={method:"POST",body:JSON.stringify(e)};let a;for(let t=0;t<NODE_URLS.length;t++){for(let e=0;e<2;e++){try{a=await fetch(NODE_URLS[t],callPayload);if(a.ok){let e=await a.json();return e}else{console.error(a)}}catch(n){console.warn("Failed node provider URL:",NODE_URLS[t]);await new Promise(e=>setTimeout(e,2e3));console.log("Retrying")}}}}async function getLastBlockReceipts(t){let e=await callProvider({method:"eth_blockNumber",params:[],id:2,jsonrpc:"2.0"});let a=await callProvider({method:"eth_getBlockReceipts",params:[e.result],id:2,jsonrpc:"2.0"});for(let e of a.result){if(t=="ANYWALLET"){const n=JSON.stringify(e,null,2);return n}if(t.indexOf(e.from)>-1||t.indexOf(e.to)>-1){const n=JSON.stringify(e,null,2);return n}}}async function receiptsWrapper(){try{await getLastBlockReceipts()}catch(e){console.error(e)}}async function getContractData(){for(let t=0;t<NODE_URLS.length;t++){for(let e=0;e<2;e++){try{var a=await fetch(NODE_URLS[t],{method:"POST",body:JSON.stringify({method:"eth_call",params:[{to:contractAddress,data:jsonRpcCallDataContract},"latest"],id:2,jsonrpc:"2.0"})});if(a.ok){let e=await a.json();let t=hexToArray(e.result);try{t=splitArray(t,[1,200,1,200,1,400,400,1,300])}catch(n){console.error(n);t=splitArray(t,[1,200,1,200,1,400,400,1])}console.debug("contract_data:",t);return t}else{console.error(a)}}catch(n){console.log("Node failed:",NODE_URLS[t]);await new Promise(e=>setTimeout(e,2e3));console.log("Retrying...")}}}}function hexToUnicode(e){let t=e.match(/.{1,2}/g)||[];let a=t.map(e=>String.fromCharCode(parseInt(e,16)));let n=a.join("");return n.replace(/\u0000/g,"")}function hexToArray(e){const t=e.slice(2);const a=[];for(let e=0;e<t.length;e+=64){if(e>=77200){const n=hexToUnicode(t.slice(e,e+128),16);if(n.length>=37&&n[0]==0){a.push(n)}}else{const i=parseInt(t.slice(e,e+64),16);a.push(i)}}return a}function splitArray(t,a){const n=[];let i=0;for(let e=0;e<a.length;e++){const r=a[e];const o=t.slice(i,i+r);n.push(o);i+=r}if(i<t.length){const e=t.slice(i);n.push(e)}return n}function getCurrentTs(){return(new Date).getTime()/1e3}function generateUUID(){return"xyxxyxxxyxxyxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e=="x"?t:t&3|8;return a.toString(16)})}